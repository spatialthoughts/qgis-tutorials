<!DOCTYPE html>

<html lang="sl" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Creating an Animated Cartogram (QGIS3) &#8212; QGIS Tutorials and Tips</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/bootstrap-sphinx.css?v=0bf093e7" />
    <script src="../../_static/documentation_options.js?v=d40e29de"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/translations.js?v=82705e9b"></script>
    <link rel="search" title="Išči" href="../../search.html" />
    <link rel="next" title="Osnove vizualizacije in usmerjanja omrežja (QGIS3)" href="basic_network_analysis.html" />
    <link rel="prev" title="Styling Contours in 3D (QGIS3)" href="contour_3d_styling.html" />

<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../../_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>


<!-- Cookie Notice -->
<!-- Script from https://github.com/AOEpeople/cookie-notice -->
<script type="text/javascript" src="../../_static/cookie.notice.min.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-B1WQ7B80XJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-B1WQ7B80XJ');
</script>


  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          QGIS Tutorials and Tips</a>
        <span class="navbar-text navbar-version pull-left"><b>v1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Tutorials List <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Uvod</a></li>
<li class="toctree-l1"><a class="reference internal" href="making_a_map.html">Ustvarjanje karte (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="working_with_attributes.html">Delo z atributi (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="importing_spreadsheets_csv.html">Uvoz podatkov preglednic ali datotek CSV (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic_vector_styling.html">Osnovno oblikovanje vektorskih slojev (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="calculating_line_lengths.html">Izračunavanje dolžin in statistike linij (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="raster_styling_and_analysis.html">Osnovne analize in prikazi rastrov (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="raster_mosaicing_and_clipping.html">Mozaičenje in obrezovanje rastrov (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="working_with_terrain.html">Delo s podatki o reliefu (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="working_with_wms.html">Delo s podatki prek vmesnika WMS (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="working_with_projections.html">Delo s projekcijami (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="georeferencing_basics.html">Georeferenciranje skeniranih topografskih kart (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced_georeferencing.html">Georeferencing Aerial Imagery (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="digitizing_basics.html">Digitalizacija podatkov (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="performing_table_joins.html">Združevanje tabel (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="performing_spatial_joins.html">Prostorsko združevanje podatkov (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="performing_spatial_queries.html">Izvajanje prostorskih poizvedb (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="nearest_neighbor_analysis.html">Analiza najbližjih sosedov (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="sampling_raster_data.html">Vzorčenje rastrskih podatkov z uporabo točk ali poligonov (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="calculating_raster_area.html">Izračun površine rastra (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="creating_heatmaps.html">Ustvarjanje kart zgostitev (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="animating_time_series.html">Prikazovanje podatkov časovnih vrst (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="handling_invalid_geometries.html">Ravnanje z neveljavnimi geometrijami (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced_raster_analysis.html">Advanced Raster Analysis (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="interpolating_point_data.html">Interpolating Point Data (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="batch_processing.html">Batch Processing using Processing Framework (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="processing_graphical_modeler.html">Avtomatizacija zapletenih delovnih postopkov z orodjem Processing Modeler (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="automating_map_creation.html">Avtomatizacija ustvarjanja zemljevidov s programom Print Layout Atlas (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="multi_criteria_overlay.html">Analiza prekrivanja po več kriterijih (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="vector_styling_expressions.html">Basic Filtering and Styling with Expressions (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="block_world_styling.html">Creating a Block World Map (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="river_styling_expressions.html">Styling a River Network with Expressions (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="contour_3d_styling.html">Styling Contours in 3D (QGIS3)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Creating an Animated Cartogram (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic_network_analysis.html">Osnove vizualizacije in usmerjanja omrežja (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="origin_destination_matrix.html">Iskanje najbližjega objekta z matriko izvor-destinacija (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="service_area_analysis.html">Analiza storitvenih območij z uporabo storitve Openrouteservice (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="travel_time_analysis.html">Analiza potovalnega časa z gibanjem Uberja (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="areal_mean_rainfall.html">Calculating Areal Mean Rainfall (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="colorized_river_basin_map.html">Creating a Colorized River Basin Map (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="creating_landuse_map.html">Creating a Landuse Map (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="calculating_intersection_density.html">Calculating Street Intersection Density (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="landuse_buffer.html">Determining Landuse Buffer Zones (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="solidwaste_mapping.html">Mapping Waste Disposal Volumes (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started_with_pyqgis.html">Getting Started With Python Programming (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="processing_algorithms_pyqgis.html">Running Processing Algorithms via Python (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom_python_functions.html">Using Custom Python Expression Functions (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="processing_python_scripts.html">Writing Python Scripts for Processing Framework (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="building_a_python_plugin.html">Building a Python Plugin (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="processing_python_plugin.html">Building a Processing Plugin (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../running_qgis_jobs.html">Running and Scheduling QGIS Processing Jobs</a></li>
<li class="toctree-l1"><a class="reference internal" href="web_mapping_with_qgis2web.html">Web Mapping with QGIS2Web (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../creating_basemaps_with_qtiles.html">Creating Basemaps with QTiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="using_plugins.html">Uporaba vtičnikov (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../downloading_osm_data.html">Iskanje in prenos podatkov OpenStreetMap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../learning_resources.html">Učni viri QGIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../credits.html">Data Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../batch_processing.html">Batch Processing using Processing Framework (QGIS2)</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="contour_3d_styling.html" title="Previous Chapter: Styling Contours in 3D (QGIS3)"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Styling Conto...</span>
    </a>
  </li>
  <li>
    <a href="basic_network_analysis.html" title="Next Chapter: Osnove vizualizacije in usmerjanja omrežja (QGIS3)"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Osnove vizual... &raquo;</span>
    </a>
  </li>
              
            
            

            

            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><h4>Author</h4>
<p>Ujaval Gandhi</p>
<a href="https://twitter.com/intent/follow?screen_name=spatialthoughts" class="twitter-follow-button" data-show-count="false">Follow @spatialthoughts</a>
<hr>
<p>Want to learn QGIS in a structured way? Check out <a href="https://spatialthoughts.com/" target="_blank">Spatial Thoughts</a> for more learning materials and instructor-led online programs with QGIS.org certification.</p>

<hr>
<p>These tutorials are also available in many other languages. Please see <a href="https://www.qgistutorials.com/en/docs/introduction.html#translations" target="_blank">translations</a> page.
</p>
        </div>
      </div>
    <div class="body col-md-9 content" role="main">
      

  <section id="creating-an-animated-cartogram-qgis3">
<h1>Creating an Animated Cartogram (QGIS3)<a class="headerlink" href="#creating-an-animated-cartogram-qgis3" title="Link to this heading">¶</a></h1>
<p>Cartogram is a type of map visualization where the shape of each feature is distorted in proportion to a variable. Cartograms makes it easy to see large variations in the data easily. The simplest method to create a cartogram is by scaling the size of each region according to a variable. This method retains the original shape of the polygon and only changes the size. These are known as <a class="reference external" href="https://en.wikipedia.org/wiki/Cartogram#Non-contiguous_isomorphic_cartograms">Non-contiguous isomorphic cartograms</a>. In this tutorial, we will learn how to use QGIS expressions to create a cartogram and use the Temporal Controller to create an animation that gradually transforms the features to the target size.</p>
<p>This tutorial is inspired by <a class="reference external" href="https://x.com/kgjenkins/status/1495986986250813442?cxt=HHwWhICygZ2P6MIpAAAA">Keith Jenkins’s Demo</a> and builds on <a class="reference external" href="https://www.youtube.com/watch?v=qxKD6wcFUcE">Hans van der Kwast’s excellent cartogram tutorial</a>.</p>
<section id="overview-of-the-task">
<h2>Overview of the task<a class="headerlink" href="#overview-of-the-task" title="Link to this heading">¶</a></h2>
<p>We will take a layer of states in the US and create an animated cartogram by scaling each state by population. The resulting map will have each state sized according to its population.</p>
<blockquote>
<div><img alt="../../_images/output.gif" class="align-center" src="../../_images/output.gif" />
</div></blockquote>
</section>
<section id="get-the-data">
<h2>Get the data<a class="headerlink" href="#get-the-data" title="Link to this heading">¶</a></h2>
<p><a class="reference external" href="https://www.census.gov/">United States Census Bureau</a> provides cartographic boundary files along with demographic datasets. We will download the data and process them to create a data layer suitable for our task.</p>
<ol class="arabic simple">
<li><p>Visit the <a class="reference external" href="https://www.census.gov/geographies/mapping-files/time-series/geo/carto-boundary-file.html">Cartographic Boundary Files - Shapefile</a> data page on the US Census Bureau website. Scroll down and download the States shapefile <code class="docutils literal notranslate"><span class="pre">cb_2018_us_state_20m.zip</span></code>. This has the state polygons we need for the visualization.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/data19.png" class="align-center" src="../../_images/data19.png" />
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>The state polygons do not have any demographic data. This data needs to be downloaded separately and joined with the shapefile for use in a GIS. Visit the <a class="reference external" href="https://www.census.gov/data/tables/time-series/demo/popest/2020s-state-total.html">State Population Totals and Components of Change: 2020-2023</a> page and download the <em>Annual Population Estimates, Estimated Components of Resident Population Change, and Rates of the Components of Resident Population Change for the United States, States, District of Columbia, and Puerto Rico: April 1, 2020 to July 1, 2023</em> dataset which will be downloaded as <code class="docutils literal notranslate"><span class="pre">NST-EST2023-ALLDATA.csv</span></code>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/data23.png" class="align-center" src="../../_images/data23.png" />
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>Open QGIS. Locate the <code class="docutils literal notranslate"><span class="pre">cb_2018_us_state_20m.zip</span></code> file in the QGIS <span class="guilabel">Browser</span> and expand it. Drag and drop the <code class="docutils literal notranslate"><span class="pre">cb_2018_us_state_20m.shp</span></code> layer to the canvas.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/data33.png" class="align-center" src="../../_images/data33.png" />
</div></blockquote>
<ol class="arabic simple" start="4">
<li><p>A new layer <code class="docutils literal notranslate"><span class="pre">cb_2018_us_state_20m</span></code> will be added to the <span class="guilabel">Layers</span> panel. Next, we will load the CSV file. Click the <span class="guilabel">Open Data Source Manager</span> button.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/data43.png" class="align-center" src="../../_images/data43.png" />
</div></blockquote>
<ol class="arabic simple" start="5">
<li><p>Switch to the <span class="guilabel">Delimited Text</span> tab. Click <span class="guilabel">…</span> next to <span class="guilabel">File name</span> and browse to the downloaded <code class="docutils literal notranslate"><span class="pre">NST-EST2023-ALLDATA.csv</span></code> file. Expand the <span class="guilabel">Geometry Definition</span> section and select <code class="docutils literal notranslate"><span class="pre">No</span> <span class="pre">geometry</span> <span class="pre">(attribute</span> <span class="pre">only</span> <span class="pre">table)</span></code>. Click <span class="guilabel">Add</span>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/data53.png" class="align-center" src="../../_images/data53.png" />
</div></blockquote>
<ol class="arabic simple" start="6">
<li><p>A new layer <code class="docutils literal notranslate"><span class="pre">NST-EST2023-ALLDATA</span></code> will be added to the <span class="guilabel">Layers</span> panel. Right-click and select <span class="guilabel">Open Attribute Table</span>. This table as the population counts in the <code class="docutils literal notranslate"><span class="pre">POPESTIMATE2023</span></code> column. Each state has a unique id in the <code class="docutils literal notranslate"><span class="pre">STATE</span></code> column that we will use to join this table with the polygon layer.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/data63.png" class="align-center" src="../../_images/data63.png" />
</div></blockquote>
<ol class="arabic simple" start="7">
<li><p>Right-click the <code class="docutils literal notranslate"><span class="pre">cb_2018_us_state_20m</span></code> layer and select <span class="guilabel">Open Attribute Table</span>. The state ids are contained in the <code class="docutils literal notranslate"><span class="pre">GEOID</span></code> column. White the numbers are the same, they are formatted as a 2-digit 0-padded number. To match these with the <code class="docutils literal notranslate"><span class="pre">STATE</span></code> column from our population table, we need a similarly formatted numbers. Select the <code class="docutils literal notranslate"><span class="pre">NST-EST2023-ALLDATA</span></code>. Go to <span class="menuselection">Processing ‣ Toolbox</span>. Search and locate the <span class="menuselection">Vector table ‣ Field calculator</span> algorithm. Double-click to open it.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/data73.png" class="align-center" src="../../_images/data73.png" />
</div></blockquote>
<ol class="arabic simple" start="8">
<li><p>In the <span class="guilabel">Field calculator</span> dialog, select <code class="docutils literal notranslate"><span class="pre">NST-EST2023-ALLDATA</span></code> as the <span class="guilabel">Input layer</span>. Enter <code class="docutils literal notranslate"><span class="pre">GEOID</span></code> as the <span class="guilabel">Field name</span> and set the <span class="guilabel">Result field type</span> to <code class="docutils literal notranslate"><span class="pre">Text</span> <span class="pre">(string)</span></code>. We will now take the numbers from the <code class="docutils literal notranslate"><span class="pre">STATE</span></code> field and use the <code class="docutils literal notranslate"><span class="pre">lpad()</span></code> function to create a 2-digit 0-padded string. Enter the following expression and click <span class="guilabel">Run</span>.</p></li>
</ol>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>lpad(&quot;STATE&quot;, 2, &#39;0&#39;)
</pre></div>
</div>
<img alt="../../_images/data82.png" class="align-center" src="../../_images/data82.png" />
</div></blockquote>
<ol class="arabic simple" start="9">
<li><p>A new layer <code class="docutils literal notranslate"><span class="pre">Calculated</span></code> will be added to the <span class="guilabel">Layers</span> panel. Right-click and select <span class="guilabel">Open Attribute Table</span>. Note that the newly created <code class="docutils literal notranslate"><span class="pre">GEOID</span></code> column has correctly formatted identifiers. We can now use this field to join this table with the states layer. Search and locate the <span class="menuselection">Vector general ‣ Join attributes by field value</span> algorithm. Double-click to open it.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/data92.png" class="align-center" src="../../_images/data92.png" />
</div></blockquote>
<ol class="arabic simple" start="10">
<li><p>In the <span class="guilabel">Join attributes by field value</span> dialog, select <code class="docutils literal notranslate"><span class="pre">cb_2018_us_state_20m</span></code> as the <span class="guilabel">Input layer</span>. Select <code class="docutils literal notranslate"><span class="pre">GEOID</span></code> as the <span class="guilabel">Table field</span>. For <span class="guilabel">Input layer 2</span>, select our table <code class="docutils literal notranslate"><span class="pre">Calculated</span></code> and <span class="guilabel">Table field 2</span> select <code class="docutils literal notranslate"><span class="pre">GEOID</span></code>. The table has many columns but we only need the population for the latest year. Click the <span class="guilabel">…</span> button for <span class="guilabel">Layer 2 fields to copy</span> and select only the <code class="docutils literal notranslate"><span class="pre">POPESTIMATE2023</span></code> field. Leave other options to their default value and click <span class="guilabel">Run</span>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/data102.png" class="align-center" src="../../_images/data102.png" />
</div></blockquote>
<ol class="arabic simple" start="11">
<li><p>A new layer <code class="docutils literal notranslate"><span class="pre">Joined</span> <span class="pre">layer</span></code> will be added to the <span class="guilabel">Layers</span> panel. Before using this layer for our cartogram, let’s reproject it to a projected CRS. Search and locate the <span class="menuselection">Vector general ‣ Reproject layer</span> algorithm. Double-click to open it.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/data114.png" class="align-center" src="../../_images/data114.png" />
</div></blockquote>
<ol class="arabic simple" start="12">
<li><p>In the <span class="guilabel">Reproject layer</span> dialog, select <code class="docutils literal notranslate"><span class="pre">Joined</span> <span class="pre">layer</span></code> as the <span class="guilabel">Input layer</span>. For the <span class="guilabel">Target CRS</span>, click the <span class="guilabel">Select CRS</span> button. Search for the <code class="docutils literal notranslate"><span class="pre">North_America_Albers_Equal_Area_Conic</span></code> CRS and select it. This is our final layer so we will save it to disk. Click the <span class="guilabel">…</span> button next to <span class="guilabel">Reprojected</span> and select <span class="guilabel">Save to File..</span>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/data123.png" class="align-center" src="../../_images/data123.png" />
</div></blockquote>
<ol class="arabic simple" start="13">
<li><p>Enter the name of the layer as <code class="docutils literal notranslate"><span class="pre">us_states_with_population.gpkg</span></code> and select <span class="guilabel">Save</span>. Click <span class="guilabel">Run</span> to create the GeoPackage file with the reprojected data.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/data132.png" class="align-center" src="../../_images/data132.png" />
</div></blockquote>
<p>We will use this layer in the next section. For convenience, you may directly download a copy of the above layer from below:</p>
<p><a class="reference external" href="https://www.qgistutorials.com/downloads/us_states_with_population.gpkg">us_states_with_population.gpkg</a></p>
<p>Data Source <a class="reference internal" href="../credits.html#uscensus" id="id1"><span>[USCENSUS]</span></a></p>
</section>
<section id="procedure">
<h2>Procedure<a class="headerlink" href="#procedure" title="Link to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>Start a new QGIS project. Locate the <code class="docutils literal notranslate"><span class="pre">us_states_with_population.gpkg</span></code> file in the <span class="guilabel">Browser</span> and expand it. Drag and drop the <code class="docutils literal notranslate"><span class="pre">us_states_with_population</span></code> layer to the empty canvas.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/140.png" class="align-center" src="../../_images/140.png" />
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>A new layer <code class="docutils literal notranslate"><span class="pre">us_states_with_population</span></code> will be added to the <span class="guilabel">Layers</span> panel. Right-click and select <span class="guilabel">Open Attribute Table</span>. For our cartogram, we want to use the population values in the <code class="docutils literal notranslate"><span class="pre">POPESTIMATE2023</span></code>. Close the attribute table.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/227.png" class="align-center" src="../../_images/227.png" />
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>Click the <span class="guilabel">Open the layer styling panel</span> button in the <span class="guilabel">Layers</span> panel. Select <span class="guilabel">Simple Fill</span> and open the drop-down selector for <span class="guilabel">Symbol layer type</span>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/319.png" class="align-center" src="../../_images/319.png" />
</div></blockquote>
<ol class="arabic simple" start="4">
<li><p>Set the <span class="guilabel">Symbol layer type</span> to <code class="docutils literal notranslate"><span class="pre">Outline:</span> <span class="pre">Simple</span> <span class="pre">Line</span></code> and select a <span class="guilabel">Color</span> of your choice. This symbol layer will act as a reference for our map when we resize the polygons. Click the :guilabel:` + Add Symbol layer` button.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/48.png" class="align-center" src="../../_images/48.png" />
</div></blockquote>
<ol class="arabic simple" start="5">
<li><p>A new symbol layer <span class="guilabel">Simple Fill</span> will be added. Set the <span class="guilabel">Fill color</span> to the same color as the lines. Open the drop-down selector for <span class="guilabel">Symbol layer type</span>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/58.png" class="align-center" src="../../_images/58.png" />
</div></blockquote>
<ol class="arabic simple" start="6">
<li><p>Select <code class="docutils literal notranslate"><span class="pre">Geometry</span> <span class="pre">Generator</span></code> as the <span class="guilabel">Symbol layer type</span>. Geometry generator allows us to modify the geometry for rendering using expressions. Click the <span class="guilabel">Expression Builder</span> button.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/68.png" class="align-center" src="../../_images/68.png" />
</div></blockquote>
<ol class="arabic simple" start="7">
<li><p>We will use the <cite>scale()</cite> function which resizes the given geometry by X- and Y-scaling factors.  For our cartogram, we want to resize each polygon by the ratio of its population to the highest population. Enter the following expression to apply this scaling and click <span class="guilabel">OK</span>.</p></li>
</ol>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>scale(@geometry,
&quot;POPESTIMATE2023&quot; / maximum( &quot;POPESTIMATE2023&quot;),
&quot;POPESTIMATE2023&quot; / maximum( &quot;POPESTIMATE2023&quot;)
)
</pre></div>
</div>
<img alt="../../_images/78.png" class="align-center" src="../../_images/78.png" />
</div></blockquote>
<ol class="arabic simple" start="8">
<li><p>You will see the state polygons are now sized by the proportion of each state’s population to the highest population. Many large states with small population are now much smaller than their original size. You will notice that polygons with irregular shapes are off-center after being scaled. This is because the anchor point of the scaling is the centroid of the geometry’s bounding box - which often falls outside of the actual polygon. Let’s update our expression to fix this. Click the <span class="guilabel">Expression Builder</span> button.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/88.png" class="align-center" src="../../_images/88.png" />
</div></blockquote>
<ol class="arabic simple" start="9">
<li><p>The <cite>scale()</cite> function takes an optional parameter to specify the scaling center point. We will use the <cite>pole_of_inaccessibility()</cite> function to find a representative anchor point for each polygon. This is similar to a centroid, but it is guaranteed to be inside of the polygon whereas centroid can fall outside for certain shapes. Update the expression as shown below and click <span class="guilabel">OK</span>.</p></li>
</ol>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>scale(@geometry,
&quot;POPESTIMATE2023&quot; / maximum( &quot;POPESTIMATE2023&quot;),
&quot;POPESTIMATE2023&quot; / maximum( &quot;POPESTIMATE2023&quot;),
pole_of_inaccessibility(geometry_n(@geometry,@element), 100)
)
</pre></div>
</div>
<img alt="../../_images/98.png" class="align-center" src="../../_images/98.png" />
</div></blockquote>
<ol class="arabic simple" start="10">
<li><p>Now the scaled polygons will have much better placement. We see another problem. Many features in the layer are <strong>Multipolygons</strong>, i.e. they have more than one parts. Such features have 2 or more polygons that are part of the same geometry. With our current expression, both are scaled with same anchor point computed from the combined geometry. This is not ideal. For example, a large feature with multiple islands should be scaled such that each island is scaled with its own center point. To fix this, we update our expression to iterate over each part of the geometry and scale it with its own center. Click the <span class="guilabel">Expression Builder</span> button.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/1012.png" class="align-center" src="../../_images/1012.png" />
</div></blockquote>
<ol class="arabic simple" start="11">
<li><p>Here we use the <cite>array_foreach()</cite> function to iterate over each part of the geometry and generate the scaled versions of them. Finally <cite>collect_geometries()</cite> function combines each scaled part into a single multi-polygon geometry. Update the expression as shown below and click <span class="guilabel">OK</span>.</p></li>
</ol>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>collect_geometries(
    array_foreach(generate_series(1, @geometry_part_count),
            scale(geometry_n(@geometry,@element),
                    &quot;POPESTIMATE2023&quot; / maximum( &quot;POPESTIMATE2023&quot;),
                    &quot;POPESTIMATE2023&quot; / maximum( &quot;POPESTIMATE2023&quot;),
pole_of_inaccessibility(geometry_n(@geometry,@element), 100)
            )
    )
)
</pre></div>
</div>
<img alt="../../_images/1115.png" class="align-center" src="../../_images/1115.png" />
</div></blockquote>
<ol class="arabic simple" start="12">
<li><p>The result is much better. Select the <span class="guilabel">Simple Fill</span> symbol layer and change the <span class="guilabel">Stroke color</span> to a darker shade of the fill color.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/1213.png" class="align-center" src="../../_images/1213.png" />
</div></blockquote>
<ol class="arabic simple" start="13">
<li><p>Our cartogram is ready. This map shows the concentration of population in the US to a handful of states and striking absense of population in states west of the Mississippi river. We can make an improved visualization by creating an animation that slowly transforms the original rendering to the final size. Click the <span class="guilabel">Temporal Control Panel</span> button with the Clock icon in the <span class="guilabel">Map Navigation Toolbar</span>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/1311.png" class="align-center" src="../../_images/1311.png" />
</div></blockquote>
<ol class="arabic simple" start="14">
<li><p>Select the <span class="guilabel">Animated temporal navigation</span> button. The default <span class="guilabel">Animation range</span> will be populated with a 24-hour window in the increment of 1-hour. This is fine for our use case as we will get 24-frames of animation. You can adjust this if you want a slower/faster animation.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/1410.png" class="align-center" src="../../_images/1410.png" />
</div></blockquote>
<ol class="arabic simple" start="15">
<li><p>Right-click the <code class="docutils literal notranslate"><span class="pre">us_states_with_population</span></code> layer and select <span class="guilabel">Properties</span>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/1510.png" class="align-center" src="../../_images/1510.png" />
</div></blockquote>
<ol class="arabic simple" start="16">
<li><p>Select <span class="guilabel">Temporal</span> tab and enable the <span class="guilabel">Dynamic Temporal Control</span>. This layer will be updated using expression so we don’t need to configure it here. Just select <code class="docutils literal notranslate"><span class="pre">Redraw</span> <span class="pre">Layer</span> <span class="pre">Only</span></code> so that the layer is refreshed after each time step and rendered with the updated values from the expression.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/169.png" class="align-center" src="../../_images/169.png" />
</div></blockquote>
<ol class="arabic simple" start="17">
<li><p>Let’s update our Geometry Generator expression to use the animation time steps and gradually scale the geometry. Click the <span class="guilabel">Open the layer styling panel</span> button in the <span class="guilabel">Layers</span> panel. Select <span class="guilabel">Geometry Generator</span> followed by the <span class="guilabel">Expression Builder</span> button.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/1710.png" class="align-center" src="../../_images/1710.png" />
</div></blockquote>
<ol class="arabic simple" start="18">
<li><p>Here we want to start with a scale factor of 1 and end up with the final scale factor of <code class="docutils literal notranslate"><span class="pre">&quot;POPESTIMATE2023&quot;</span> <span class="pre">/</span> <span class="pre">maximum(</span> <span class="pre">&quot;POPESTIMATE2023&quot;)</span></code>. We use the <cite>scale_linear()</cite> function which takes the time of the current time-step and calculates the scale factor using the start and end times. Update the expression as shown below and click <span class="guilabel">OK</span>.</p></li>
</ol>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>collect_geometries(
    array_foreach(generate_series(1, @geometry_part_count),
            scale(geometry_n(@geometry,@element),
                    scale_linear(
                            epoch(@map_start_time),
                            epoch(@animation_start_time),
                            epoch(@animation_end_time),
                            1,
                            &quot;POPESTIMATE2023&quot; / maximum( &quot;POPESTIMATE2023&quot;)),
                    scale_linear(
                            epoch(@map_start_time),
                            epoch(@animation_start_time),
                            epoch(@animation_end_time),
                            1,
                            &quot;POPESTIMATE2023&quot; / maximum( &quot;POPESTIMATE2023&quot;)),
pole_of_inaccessibility(geometry_n(@geometry,@element), 100)
            )
    )
)
</pre></div>
</div>
<img alt="../../_images/188.png" class="align-center" src="../../_images/188.png" />
</div></blockquote>
<ol class="arabic simple" start="19">
<li><p>Back in the <span class="guilabel">Temporal Controller</span> panel, click the <span class="guilabel">Play</span> button to see the animation. You should see the shape of each polygon gradually scaled after each frame. Our expression is quite long and has repetitive code. We can make it more readable so it is easier to maintain. Click the <span class="guilabel">Expression Builder</span> button.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/197.png" class="align-center" src="../../_images/197.png" />
</div></blockquote>
<ol class="arabic simple" start="20">
<li><p>We can use the <cite>with_variable()</cite> function to assign a named variable to an expression and refer to it again by its name. This helps us avoid repeating the same expression multiple times. Update the expression as shown below and click <span class="guilabel">OK</span>.</p></li>
</ol>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>with_variable(
    &#39;scale_factor&#39;,
    scale_linear(
            epoch(@map_start_time),
            epoch(@animation_start_time),
            epoch(@animation_end_time),
            1,
            &quot;POPESTIMATE2023&quot; / maximum( &quot;POPESTIMATE2023&quot;)),
    collect_geometries(
            array_foreach(generate_series(1, @geometry_part_count),
                    scale(geometry_n(@geometry,@element),
                    @scale_factor,
                    @scale_factor,
                    pole_of_inaccessibility(
                            geometry_n(@geometry,@element), 100)
                    )
            )
))
</pre></div>
</div>
<img alt="../../_images/207.png" class="align-center" src="../../_images/207.png" />
</div></blockquote>
<ol class="arabic simple" start="21">
<li><p>Once you are happy with the configuration, we can export the animation. Click the <span class="guilabel">Export Animation</span> button.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/2112.png" class="align-center" src="../../_images/2112.png" />
</div></blockquote>
<ol class="arabic simple" start="22">
<li><p>In the <span class="guilabel">Export Map Animation</span> dialog, click <span class="guilabel">…</span> next to <span class="guilabel">Output directory</span> and browse to any folder on your computer. Keep all the other options to their default value and click <span class="guilabel">Save</span>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/228.png" class="align-center" src="../../_images/228.png" />
</div></blockquote>
<ol class="arabic simple" start="23">
<li><p>The individual frames of the animation will be exported as images. We can create a video or animated GIF from these frames. I recommend using the website ezgif.com that allows you to create GIFs from individual images easily. Visit <a class="reference external" href="https://ezgif.com/maker">Ezgif Animated GIF Maker</a>. Browse to the exported animation frames and click <span class="guilabel">Upload files!</span>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/236.png" class="align-center" src="../../_images/236.png" />
</div></blockquote>
<ol class="arabic simple" start="24">
<li><p>Configure the GIF options by setting the <span class="guilabel">Delay time</span> to <code class="docutils literal notranslate"><span class="pre">5</span></code>. Check <span class="guilabel">crossfade frames</span> effect and set the <span class="guilabel">Fader delay</span> and <span class="guilabel">Fader count</span> to <code class="docutils literal notranslate"><span class="pre">2</span></code>. Click <span class="guilabel">Make a GIF!</span>/</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/247.png" class="align-center" src="../../_images/247.png" />
</div></blockquote>
<ol class="arabic simple" start="25">
<li><p>Click the <span class="guilabel">save</span> button to download the animation as a GIF file.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/output.gif" class="align-center" src="../../_images/output.gif" />
</div></blockquote>
</section>
</section>





  <!-- Comment Section Powered by utterances -->
<div id="comments">
  <hr />
  <p>If you want to give feedback or share your experience with this tutorial, please comment below. (requires GitHub account)</p>
<script src="https://utteranc.es/client.js"
        repo="spatialthoughts/qgis-tutorials"
        issue-term="title"
        label="comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
</div>


    </div>
      
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2023, Ujaval Gandhi.<br/>
      Zadnjič posodobljeno avg. 09, 2024.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 7.2.6.<br/>
    </p>
  </div>
</footer>
<div class="container">
  <p>This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/deed.en_US">Creative Commons Attribution 4.0 International License</a></p>
</div>
<!-- Twitter Button -->
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<!-- Disqus comments widget -->
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'qgistutorials'; // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  }());
</script>

<script type="text/javascript">
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

<!-- Script fpr language switching. Largely adapted from https://github.com/pcav/faunalia-website -->
<script>
    var currentPage = 'docs/3/cartogram_animation.html'; // coming from sphinx, always without starting '/'
    var currentLang = 'en';
    $(document).ready(function(){

        var search = new RegExp('\/[a-zA-Z_]{2,8}\/'+ currentPage, 'gi');
        var langPlusPage = window.location.href.match(search);
        // it's possible this is a index.html page called without 'index.html', try without the currentPage
        if (langPlusPage==undefined){
            search = new RegExp('\/[a-zA-Z_]{2,8}\/$', 'gi');
            langPlusPage = window.location.href.match(search);
        }

        // it's possible this is an index.html page called without 'index.html', try removing index.html
        if (langPlusPage==undefined){
            currentPage = currentPage.replace('index.html','')
            search = new RegExp('\/[a-zA-Z_]{2,8}\/'+ currentPage, 'gi');
            langPlusPage = window.location.href.match(search);
        }
        // still no langPlugPage: stop, because the language swicher will misbehave 

        if (langPlusPage == undefined || langPlusPage.length != 1){
            alert('You hit an error, please report back to us.');
            return;
        }
        langPlusPage = langPlusPage[0];
        currentLang = langPlusPage.replace(currentPage, '');

        $("#languages").val(currentLang.replace(/\//g,'')); // currentLang is something like '/nl/'

        $("#languages").change(function() {
            gotoLang($(this).val());
        });

    });

    // load current page in a different language
    function gotoLang(lang){
        var currentUrl = window.location.href;
        var newUrl = currentUrl.replace(currentLang, '/'+lang+'/');
        window.location.href = newUrl;
    }
</script>

  </body>
</html>