<!DOCTYPE html>

<html lang="ro">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Scriptare în Python pentru Cadrul de Procesare &#8212; QGIS Tutorials and Tips</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/translations.js"></script>
    <link rel="search" title="Căutare" href="../search.html" />

<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>


<!-- Cookie Notice -->
<!-- Script from https://github.com/AOEpeople/cookie-notice -->
<script type="text/javascript" src="../_static/cookie.notice.min.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-B1WQ7B80XJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-B1WQ7B80XJ');
</script>


  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          QGIS Tutorials and Tips</a>
        <span class="navbar-text navbar-version pull-left"><b>v1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Tutorials List <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introducere</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/making_a_map.html">Crearea unei Hărți (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/working_with_attributes.html">Working with Attributes (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/importing_spreadsheets_csv.html">Importul Foilor de Calcul sau a Fișierelor CSV (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/basic_vector_styling.html">Noțiuni de Bază Despre Stilizarea Vectorilor (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/calculating_line_lengths.html">Determinarea Lungimii Liniilor și a Statisticilor (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/raster_styling_and_analysis.html">Basic Raster Styling and Analysis (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/raster_mosaicing_and_clipping.html">Mozaicarea și Tăierea Rasterelor (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/working_with_terrain.html">Working with Terrain Data (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/working_with_wms.html">Working with WMS Data (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/working_with_projections.html">Working with Projections (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/georeferencing_basics.html">Georeferențierea Foilor Topografice și a Hărților Scanate (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/advanced_georeferencing.html">Georeferențierea Imaginilor Aeriene (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/digitizing_basics.html">Digitizing Map Data (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/performing_table_joins.html">Efectuarea Joncțiunilor Tabelare (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/performing_spatial_joins.html">Realizarea Joncțiunilor Tabelare (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/performing_spatial_queries.html">Efectuarea Interogărilor Spațiale (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/nearest_neighbor_analysis.html">Analiza Celui Mai Apropiat Vecin (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/sampling_raster_data.html">Sampling Raster Data using Points or Polygons (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/calculating_raster_area.html">Calculating Raster Area (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/creating_heatmaps.html">Crearea Hărților Calorice (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/animating_time_series.html">Animating Time Series Data (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/handling_invalid_geometries.html">Gestionarea Geometriilor Nevalide (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/advanced_raster_analysis.html">Advanced Raster Analysis (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/interpolating_point_data.html">Interpolating Point Data (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/batch_processing.html">Procesarea În Serie, folosind Cadrul de Procesare (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/processing_graphical_modeler.html">Automatizarea Fluxurilor de Lucru Complexe utilizând Modelatorul de Procese (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/automating_map_creation.html">Automatizarea Creării Hărților cu ajutorul Atlasului (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/multi_criteria_overlay.html">Multi Criteria Overlay Analysis (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/basic_network_analysis.html">Basic Network Visualization and Routing (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/origin_destination_matrix.html">Locating Nearest Facility with Origin-Destination Matrix (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/service_area_analysis.html">Service Area Analysis using Openrouteservice (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/travel_time_analysis.html">Travel Time Analysis with Uber Movement (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/areal_mean_rainfall.html">Calculating Areal Mean Rainfall (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/colorized_river_basin_map.html">Creating a Colorized River Basin Map (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/creating_landuse_map.html">Creating a Landuse Map (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/calculating_intersection_density.html">Calculating Street Intersection Density (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/landuse_buffer.html">Determining Landuse Buffer Zones (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/solidwaste_mapping.html">Mapping Waste Disposal Volumes (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/getting_started_with_pyqgis.html">Noțiuni de Bază Despre Programarea în Python (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/processing_algorithms_pyqgis.html">Running Processing Algorithms via Python (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/custom_python_functions.html">Utilizarea Funcțiilor în Expresiile Python Personalizate (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/processing_python_scripts.html">Scriptare în Python pentru Cadrul de Procesare (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/building_a_python_plugin.html">Construirea unui Plugin Python (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/processing_python_plugin.html">Construirea unui Plugin de Procesare (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="running_qgis_jobs.html">Rularea și programarea Activităților de Prelucrare QGIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/web_mapping_with_qgis2web.html">Web Mapping with QGIS2Web (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="creating_basemaps_with_qtiles.html">Crearea hărților de bază folosind QTiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/using_plugins.html">Using Plugins (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="downloading_osm_data.html">Căutarea și descărcarea datelor OpenStreetMap</a></li>
<li class="toctree-l1"><a class="reference internal" href="learning_resources.html">Resurse de învățare QGIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="credits.html">Creditare date</a></li>
<li class="toctree-l1"><a class="reference internal" href="batch_processing.html">Procesarea în serie, folosind Cadrul de Procesare (QGIS2)</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            

            

            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><h4>Author</h4>
<p>Ujaval Gandhi</p>
<a href="https://twitter.com/intent/follow?screen_name=spatialthoughts" class="twitter-follow-button" data-show-count="false">Follow @spatialthoughts</a>
<hr>
<p>Want to learn QGIS in a structured way? Check out <a href="https://spatialthoughts.com/" target="_blank">Spatial Thoughts</a> for more learning materials and instructor-led online programs with QGIS.org certification.</p>

<hr>
<p>These tutorials are also available in many other languages. Please see <a href="https://www.qgistutorials.com/en/docs/introduction.html#translations" target="_blank">translations</a> page.
</p>
        </div>
      </div>
    <div class="body col-md-9 content" role="main">
      

  <section id="writing-python-scripts-for-processing-framework">
<h1>Scriptare în Python pentru Cadrul de Procesare<a class="headerlink" href="#writing-python-scripts-for-processing-framework" title="Permalink to this heading">¶</a></h1>
<div class="admonition warning">
<p class="admonition-title">Atenționare</p>
<p>O nouă versiune a acestui tutorial este disponibilă la <a class="reference internal" href="3/processing_python_scripts.html"><span class="doc">Scriptare în Python pentru Cadrul de Procesare (QGIS3)</span></a></p>
</div>
<p>Se pot crea script-uri pyqgis independente, care pot fi executate prin intermediul Consolei Python din QGIS. Cu puține modificări, puteți rula script-urile prin intermediul Cadrului de Procesare. Acest lucru are mai multe avantaje. În primul rând, preluarea datelor de la utilizator și scrierea fișierelor de ieșire este mult mai ușoară, deoarece Cadrul de Procesare oferă o interfață de utilizator standardizată pentru acestea. În al doilea rând, având script-ul în Bara de Instrumente de Procesare, este posibil ca acesta să facă parte din orice Model de Procesare sau să ruleze în serie, pentru mai multe intrări. Acest tutorial vă arată cum să scrieți un script Python personalizat, care să facă parte din Cadrul de Procesare din QGIS.</p>
<section id="overview-of-the-task">
<h2>Privire de ansamblu asupra activității<a class="headerlink" href="#overview-of-the-task" title="Permalink to this heading">¶</a></h2>
<p>Script-ul nostru va efectua o operație de dizolvare bazată pe un câmp ales de utilizator. De asemenea, va însuma valorile altui câmp pentru entitățile dizolvate. În cadrul exemplului vom dizolva un fișier shape al lumii în funcție de atributul <code class="docutils literal notranslate"><span class="pre">SUBREGIUNE</span></code>, apoi vom însuma câmpul <code class="docutils literal notranslate"><span class="pre">POP_EST</span></code> pentru a calcula totalul populației din regiunea dizolvată.</p>
<div class="admonition note">
<p class="admonition-title">Notă</p>
<p>Dacă doriți să știți cum se face o operație de dizolvare împreună cu Statisticile, puteți folosi excelentul plugin <code class="docutils literal notranslate"><span class="pre">DissolveWithStats</span></code>. Acest script este o demonstrație despre cum să puneți în aplicare o funcționalitate similară prin intermediul unui script de Procesare.</p>
</div>
</section>
<section id="get-the-data">
<h2>Obținerea datelor<a class="headerlink" href="#get-the-data" title="Permalink to this heading">¶</a></h2>
<p>Vom folosi setul de date <a class="reference external" href="http://www.naturalearthdata.com/downloads/10m-cultural-vectors/10m-admin-0-countries/">Admin 0 - Țări</a> de la Natural Earth.</p>
<p>Vom folosi setul de date <a class="reference external" href="http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/cultural/ne_10m_admin_0_countries.zip">Admin 0 - fișierul shape al țărilor.</a></p>
<p>Sursa de date <a class="reference internal" href="credits.html#naturalearth" id="id1"><span>[NATURALEARTH]</span></a></p>
<p>Pentru comoditate, puteți descărca o copie a setului de date direct de la adresa de mai jos:</p>
<p><a class="reference external" href="http://www.qgistutorials.com/downloads/ne_10m_admin_0_countries.zip">ne_10_admin_0_countries.zip</a></p>
</section>
<section id="procedure">
<h2>Procedura<a class="headerlink" href="#procedure" title="Permalink to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>În QGIS, mergeți la <span class="menuselection">Layers ‣ Add Vector ‣ Add Vector Layer</span>. Navigați la fișierul descărcat <code class="docutils literal notranslate"><span class="pre">ne_10_admin_0_countries.zip</span></code> și încărcați stratul <code class="docutils literal notranslate"><span class="pre">ne_10_admin_0_countries</span></code>. Mergeți la <span class="menuselection">Processing ‣ Toolbox</span>.</p></li>
</ol>
<img alt="../_images/1202.png" class="align-center" src="../_images/1202.png" />
<ol class="arabic simple" start="2">
<li><p>Extinteți grupul <span class="guilabel">Scripts</span> din <span class="guilabel">Processing Toolbox</span> și selectați <span class="guilabel">Create a new script</span>.</p></li>
</ol>
<img alt="../_images/2167.png" class="align-center" src="../_images/2167.png" />
<ol class="arabic simple" start="3">
<li><p>Pentru ca un script Python să fie recunoscut ca un script de Procesare, la începutul script-ului trebuie să se afle specificațiile de intrare și de ieșire. Acestea vor fi utilizate la construirea interfeței cu utilizatorul, pentru a rula script-ul. Puteți afla mai multe despre formatul acestor linii, din <a class="reference external" href="https://docs.qgis.org/2.8/en/docs/user_manual/processing/scripts.html">Documentația Processing din QGIS</a>. Introduceți următoarele linii în <span class="guilabel">Script editor</span>. Aici avem 3 intrări ale utilizatorului: <code class="docutils literal notranslate"><span class="pre">dissolve_layer</span></code>, <code class="docutils literal notranslate"><span class="pre">dissolve_field</span></code> și <code class="docutils literal notranslate"><span class="pre">sum_field</span></code>. Rețineți că <code class="docutils literal notranslate"><span class="pre">dissolve_layer</span></code> se adaugă după definițiile ambelor câmpuri de intrare. Acest lucru înseamnă că intrările vor fi pre-populate prin alegerea câmpurilor din <code class="docutils literal notranslate"><span class="pre">dissolve_layer</span></code>. De asemenea, specificați <code class="docutils literal notranslate"><span class="pre">output_layer</span></code> ca și strat vectorial de ieșire. Faceți clic pe butonul <span class="guilabel">Save</span>.</p></li>
</ol>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>##dissolve_layer=vector
##dissolve_field=field dissolve_layer
##sum_field=field dissolve_layer
##output_layer=output vector
</pre></div>
</div>
<img alt="../_images/3106.png" class="align-center" src="../_images/3106.png" />
<ol class="arabic simple" start="4">
<li><p>Denumiți script-ul <code class="docutils literal notranslate"><span class="pre">dissolve_with_sum</span></code> și salvați-l în locația implicită din folderul <span class="menuselection">.qgis2 ‣ processing ‣ scripts</span>.</p></li>
</ol>
<img alt="../_images/468.png" class="align-center" src="../_images/468.png" />
<ol class="arabic simple" start="5">
<li><p>Înapoi, în <span class="guilabel">Script editor</span>, faceți clic pe butonul <span class="guilabel">Run algorithm</span>, pentru a previzualiza interfața utilizatorului.</p></li>
</ol>
<img alt="../_images/562.png" class="align-center" src="../_images/562.png" />
<ol class="arabic simple" start="6">
<li><p>Puteți vedea că doar prin adăugarea a câtorva rânduri, avem o interfață frumoasă, pe care utilizatorul va preciza intrările. De asemenea, este în concordanță cu toți ceilalți algoritmi de procesare, astfel încât nu există nici o curbă de învățare implicată în folosirea algoritmului personalizat.</p></li>
</ol>
<img alt="../_images/659.png" class="align-center" src="../_images/659.png" />
<ol class="arabic simple" start="7">
<li><p>În: guilabel: <cite>Script editor</cite>, introduceți următorul cod. Veți observa că apelăm unele metode speciale, cum ar fi <code class="docutils literal notranslate"><span class="pre">processing.getObject()</span></code> și <code class="docutils literal notranslate"><span class="pre">processing.features()</span></code>. Acestea sunt ambalate confortabil, pentru a ușura lucrul cu datele. Puteți afla mai multe despre acestea din secțiunea <a class="reference external" href="https://docs.qgis.org/2.8/en/docs/user_manual/processing/console.html#additional-functions-for-handling-data">Funcțiilor suplimentare de manipulare a datelor</a> a Documentației de Procesare QGIS. Clic pe <span class="guilabel">Save</span> pentru a salva codul nou introdus, și apoi pe butonul <span class="guilabel">X</span> pentru a închide editorul.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Notă</p>
<p>Acest script folosește în mod extensiv comprehensiunea listelor python. Aruncați o privire la acest <a class="reference external" href="https://docs.python.org/2/tutorial/datastructures.html#list-comprehensions">tutorial pentru a înțelege listele comprehensive</a>, și pentru a vă familiariza cu sintaxa.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">PyQt4.QtCore</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">inlayer</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">getObject</span><span class="p">(</span><span class="n">dissolve_layer</span><span class="p">)</span>
<span class="n">dissolve_field_index</span> <span class="o">=</span> <span class="n">inlayer</span><span class="o">.</span><span class="n">fieldNameIndex</span><span class="p">(</span><span class="n">dissolve_field</span><span class="p">)</span>
<span class="n">sum_field_index</span> <span class="o">=</span> <span class="n">inlayer</span><span class="o">.</span><span class="n">fieldNameIndex</span><span class="p">(</span><span class="n">sum_field</span><span class="p">)</span>

<span class="c1"># Find unique values present in the dissolve field</span>
<span class="n">unique_values</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">f</span><span class="p">[</span><span class="n">dissolve_field</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span>
<span class="n">processing</span><span class="o">.</span><span class="n">features</span><span class="p">(</span><span class="n">inlayer</span><span class="p">)])</span>

<span class="nb">print</span> <span class="n">unique_values</span>
</pre></div>
</div>
<img alt="../_images/758.png" class="align-center" src="../_images/758.png" />
<ol class="arabic simple" start="8">
<li><p>În timp ce se scrie codul, este important să fiți în măsură să vedeți erorile și să depanați codul. Script-urile de Procesare pot fi depanate cu ușurință prin intermediul consolei Python încorporate. În fereastra principală a QGIS, mergeți la <span class="menuselection">Plugins ‣ Python Console</span>. O dată ce consola este deschisă, găsiți script-ul în <span class="guilabel">Instrumentarul Processing</span> și faceți dublu clic pe el pentru a-l lansa.</p></li>
</ol>
<img alt="../_images/856.png" class="align-center" src="../_images/856.png" />
<ol class="arabic simple" start="9">
<li><p>Selectați <code class="docutils literal notranslate"><span class="pre">SUBREGIUNE</span></code> ca și <span class="guilabel">câmp de dizolvare</span>. Puteți alege orice câmp și ca <span class="guilabel">câmp de însumare</span> atât timp cât scriptul nu are nici un cod pentru a interacționa cu acesta. Clic <span class="guilabel">Run</span>.</p></li>
</ol>
<img alt="../_images/955.png" class="align-center" src="../_images/955.png" />
<ol class="arabic simple" start="10">
<li><p>Veți vedea un dialog de eroare. Acest lucru este de așteptat, deoarece script-ul este incomplet și nu generează nici o ieșire încă.</p></li>
</ol>
<img alt="../_images/1063.png" class="align-center" src="../_images/1063.png" />
<ol class="arabic simple" start="11">
<li><p>În principalele ferestrele QGIS, veți vedea ieșirea de depanare a script-ului afișat în consolă. Acest lucru este un mod util de a adăuga instrucțiuni de imprimare și de a vedea valorile variabile intermediare.</p></li>
</ol>
<img alt="../_images/11102.png" class="align-center" src="../_images/11102.png" />
<ol class="arabic simple" start="12">
<li><p>Să ne întoarcem la editarea script-ului printr-un clic dreapta pe script, apoi selectați <span class="guilabel">Edit script</span>.</p></li>
</ol>
<img alt="../_images/1264.png" class="align-center" src="../_images/1264.png" />
<ol class="arabic simple" start="13">
<li><p>Introduceți codul de mai jos pentru a finaliza script-ul. Rețineți că folosim algoritmul existent de dizolvare din QGIS, prin procesarea cu ajutorul metodei <code class="docutils literal notranslate"><span class="pre">processing.runalg()</span></code>.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a dictionary to hold values from the sum field</span>
<span class="n">sum_unique_values</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">attrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">attributes</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">processing</span><span class="o">.</span><span class="n">features</span><span class="p">(</span><span class="n">inlayer</span><span class="p">)]</span>

<span class="k">for</span> <span class="n">unique_value</span> <span class="ow">in</span> <span class="n">unique_values</span><span class="p">:</span>
    <span class="n">val_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">f_attr</span><span class="p">[</span><span class="n">sum_field_index</span><span class="p">]</span> <span class="k">for</span> <span class="n">f_attr</span> <span class="ow">in</span> <span class="n">attrs</span> <span class="k">if</span> <span class="n">f_attr</span><span class="p">[</span><span class="n">dissolve_field_index</span><span class="p">]</span> <span class="o">==</span> <span class="n">unique_value</span><span class="p">]</span>
    <span class="n">sum_unique_values</span><span class="p">[</span><span class="n">unique_value</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">val_list</span><span class="p">)</span>

<span class="c1"># Run the regular Dissolve algorithm</span>
<span class="n">processing</span><span class="o">.</span><span class="n">runalg</span><span class="p">(</span><span class="s2">&quot;qgis:dissolve&quot;</span><span class="p">,</span> <span class="n">dissolve_layer</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
    <span class="n">dissolve_field</span><span class="p">,</span> <span class="n">output_layer</span><span class="p">)</span>

<span class="c1"># Add a new attribute called &#39;SUM&#39; in the output layer</span>
<span class="n">outlayer</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">getObject</span><span class="p">(</span><span class="n">output_layer</span><span class="p">)</span>
<span class="n">provider</span> <span class="o">=</span> <span class="n">outlayer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span>
<span class="n">provider</span><span class="o">.</span><span class="n">addAttributes</span><span class="p">([</span><span class="n">QgsField</span><span class="p">(</span><span class="s1">&#39;SUM&#39;</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">Double</span><span class="p">)])</span>
<span class="n">outlayer</span><span class="o">.</span><span class="n">updateFields</span><span class="p">()</span>

<span class="c1"># Set the value of the &#39;SUM&#39; field for each feature</span>
<span class="n">outlayer</span><span class="o">.</span><span class="n">startEditing</span><span class="p">()</span>
<span class="n">new_field_index</span> <span class="o">=</span> <span class="n">outlayer</span><span class="o">.</span><span class="n">fieldNameIndex</span><span class="p">(</span><span class="s1">&#39;SUM&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">processing</span><span class="o">.</span><span class="n">features</span><span class="p">(</span><span class="n">outlayer</span><span class="p">):</span>
  <span class="n">outlayer</span><span class="o">.</span><span class="n">changeAttributeValue</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">id</span><span class="p">(),</span> <span class="n">new_field_index</span><span class="p">,</span> <span class="n">sum_unique_values</span><span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="n">dissolve_field</span><span class="p">]])</span>
<span class="n">outlayer</span><span class="o">.</span><span class="n">commitChanges</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/1361.png" class="align-center" src="../_images/1361.png" />
<ol class="arabic simple" start="14">
<li><p>Rulează algoritmul prin selectarea <code class="docutils literal notranslate"><span class="pre">SUBREGIUNII</span></code> ca și <span class="guilabel">câmp dizolvat</span>, și <code class="docutils literal notranslate"><span class="pre">POP_EST</span></code> ca și <span class="guilabel">câmp însumat</span>. Clic pe <span class="guilabel">Run</span>.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Notă</p>
<p>Algoritmul de procesare poate dura până la 10 minute pentru a termina, în funcție de sistemul dumneavoastră.</p>
</div>
<img alt="../_images/1458.png" class="align-center" src="../_images/1458.png" />
<ol class="arabic simple" start="15">
<li><p>După ce prelucrarea se încheie, puteți folosi instrumentul de <span class="guilabel">Identificare</span>, pentru a efectua clic pe orice poligon. Veți vedea adăugat noul câmp, <code class="docutils literal notranslate"><span class="pre">SUM</span></code>, cu valorile <code class="docutils literal notranslate"><span class="pre">POP_EST</span></code> adăugate din toate poligoanele originale.</p></li>
</ol>
<img alt="../_images/1554.png" class="align-center" src="../_images/1554.png" />
<ol class="arabic simple" start="16">
<li><p>Veți observa că toate celelalte câmpuri ale rezultatului sunt încă prezente. Când se dizolvă mai multe entități pentru a crea o singură entitate, nu are sens să se păstreze câmpurile originale în rezultat. Mergeți înapoi la: guilabel: <cite>Script editor</cite> și adăugați următorul cod pentru a șterge toate domeniile, cu excepția câmpului <code class="docutils literal notranslate"><span class="pre">SUM</span></code> și a câmpului care a fost folosit pentru a dizolva stratul original. Faceți clic pe butonul <span class="guilabel">Save</span> și închideți fereastra.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Delete all fields except dissolve field and the newly created &#39;SUM&#39; field.</span>
<span class="n">outlayer</span><span class="o">.</span><span class="n">startEditing</span><span class="p">()</span>

<span class="n">fields_to_delete</span> <span class="o">=</span> <span class="p">[</span><span class="n">fid</span> <span class="k">for</span> <span class="n">fid</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">provider</span><span class="o">.</span><span class="n">fields</span><span class="p">()))</span> <span class="k">if</span> <span class="n">fid</span> <span class="o">!=</span> <span class="n">new_field_index</span> <span class="ow">and</span> <span class="n">fid</span> <span class="o">!=</span> <span class="n">dissolve_field_index</span><span class="p">]</span>
<span class="n">provider</span><span class="o">.</span><span class="n">deleteAttributes</span><span class="p">(</span><span class="n">fields_to_delete</span><span class="p">)</span>
<span class="n">outlayer</span><span class="o">.</span><span class="n">updateFields</span><span class="p">()</span>

<span class="n">outlayer</span><span class="o">.</span><span class="n">commitChanges</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/1651.png" class="align-center" src="../_images/1651.png" />
<ol class="arabic simple" start="17">
<li><p>Una dintre funcționalitățile ascunse ale Cadrului de Procesare este aceea că toți algoritmii pot lucra pe entitățile selectate ale unui strat. Acest lucru este foarte util atunci când doriți să rulați un algoritm pe subsetul unui strat. Deoarece script-ul nostru folosește metoda <code class="docutils literal notranslate"><span class="pre">processing.features()</span></code> pentru a citi entitățile, se va respecta selecția curentă. Pentru a demonstra aceasta, haideți să facem mai întâi o selecție. Faceți clic pe butonul <span class="guilabel">Selectare entități utilizând o expresie</span>.</p></li>
</ol>
<img alt="../_images/1748.png" class="align-center" src="../_images/1748.png" />
<ol class="arabic simple" start="18">
<li><p>Introduceți următoarea expresie pentru a selecta entitățile din America de Nord și cea din Sud, apoi faceți clic pe <span class="guilabel">Select</span>.</p></li>
</ol>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&quot;CONTINENT&quot; = &#39;North America&#39; OR &quot;CONTINENT&quot; = &#39;South America&#39;
</pre></div>
</div>
<img alt="../_images/1845.png" class="align-center" src="../_images/1845.png" />
<ol class="arabic simple" start="19">
<li><p>Veți vedea entitățile selectate, evidențiate cu galben. Efectuați clic-dreapta pe script-ul <code class="docutils literal notranslate"><span class="pre">dissolve_with_sum</span></code>, apoi selectați <span class="guilabel">Execute</span>.</p></li>
</ol>
<img alt="../_images/1937.png" class="align-center" src="../_images/1937.png" />
<ol class="arabic simple" start="20">
<li><p>Selectați intrările ca mai înainte, apoi efectuați clic pe <span class="guilabel">Run</span>.</p></li>
</ol>
<img alt="../_images/2032.png" class="align-center" src="../_images/2032.png" />
<ol class="arabic simple" start="22">
<li><p>Un nou <code class="docutils literal notranslate"><span class="pre">strat</span> <span class="pre">de</span> <span class="pre">ieșire</span></code> va fi adăugat în QGIS. Acesta va conține geometriile dizolvate numai din entitățile selectate din stratul de intrare. Observați, de asemenea, că <code class="docutils literal notranslate"><span class="pre">stratul</span> <span class="pre">de</span> <span class="pre">ieșire</span></code> va conține numai 2 câmpuri, cum era de asteptat.</p></li>
</ol>
<img alt="../_images/2168.png" class="align-center" src="../_images/2168.png" />
<ol class="arabic simple" start="23">
<li><p>O ultimă, dar importantă activitate, o reprezintă documentarea algoritmului nostru. Cadrul de Procesare dispune de instrumente plăcute pentru a scrie și accesa Ajutorul. Mergeți la <span class="guilabel">Script editor</span> și faceți clic pe butonul <span class="guilabel">Edit script help</span>.</p></li>
</ol>
<img alt="../_images/2232.png" class="align-center" src="../_images/2232.png" />
<ol class="arabic simple" start="24">
<li><p>Completați detaliile pentru diferite elemente și faceți clic pe <span class="guilabel">OK</span>. Un ajutor detaliat va fi disponibil pentru toți utilizatorii script-ului în fila <span class="guilabel">Help</span>, atunci când se va lansa algoritmul.</p></li>
</ol>
<img alt="../_images/2329.png" class="align-center" src="../_images/2329.png" />
<p>Mai jos este script-ul complet. Îl puteți modifica pentru a se potrivi cerințelor dumneavoastră.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">##dissolve_layer=vector</span>
<span class="c1">##dissolve_field=field dissolve_layer</span>
<span class="c1">##sum_field=field dissolve_layer</span>
<span class="c1">##output_layer=output vector</span>

<span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">PyQt4.QtCore</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">inlayer</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">getObject</span><span class="p">(</span><span class="n">dissolve_layer</span><span class="p">)</span>
<span class="n">dissolve_field_index</span> <span class="o">=</span> <span class="n">inlayer</span><span class="o">.</span><span class="n">fieldNameIndex</span><span class="p">(</span><span class="n">dissolve_field</span><span class="p">)</span>
<span class="n">sum_field_index</span> <span class="o">=</span> <span class="n">inlayer</span><span class="o">.</span><span class="n">fieldNameIndex</span><span class="p">(</span><span class="n">sum_field</span><span class="p">)</span>

<span class="c1"># Find unique values present in the dissolve field</span>
<span class="n">unique_values</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">f</span><span class="p">[</span><span class="n">dissolve_field</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">processing</span><span class="o">.</span><span class="n">features</span><span class="p">(</span><span class="n">inlayer</span><span class="p">)])</span>

<span class="c1"># Create a dictionary to hold values from the sum field</span>
<span class="n">sum_unique_values</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">attrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">attributes</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">processing</span><span class="o">.</span><span class="n">features</span><span class="p">(</span><span class="n">inlayer</span><span class="p">)]</span>
 
<span class="k">for</span> <span class="n">unique_value</span> <span class="ow">in</span> <span class="n">unique_values</span><span class="p">:</span>
    <span class="n">val_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">f_attr</span><span class="p">[</span><span class="n">sum_field_index</span><span class="p">]</span> <span class="k">for</span> <span class="n">f_attr</span> <span class="ow">in</span> <span class="n">attrs</span> <span class="k">if</span> <span class="n">f_attr</span><span class="p">[</span><span class="n">dissolve_field_index</span><span class="p">]</span> <span class="o">==</span> <span class="n">unique_value</span><span class="p">]</span>
    <span class="n">sum_unique_values</span><span class="p">[</span><span class="n">unique_value</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">val_list</span><span class="p">)</span>

<span class="c1"># Run the regular Dissolve algorithm</span>
<span class="n">processing</span><span class="o">.</span><span class="n">runalg</span><span class="p">(</span><span class="s2">&quot;qgis:dissolve&quot;</span><span class="p">,</span> <span class="n">dissolve_layer</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
    <span class="n">dissolve_field</span><span class="p">,</span> <span class="n">output_layer</span><span class="p">)</span>

<span class="c1"># Add a new attribute called &#39;SUM&#39; in the output layer</span>
<span class="n">outlayer</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">getObject</span><span class="p">(</span><span class="n">output_layer</span><span class="p">)</span>
<span class="n">provider</span> <span class="o">=</span> <span class="n">outlayer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span>
<span class="n">provider</span><span class="o">.</span><span class="n">addAttributes</span><span class="p">([</span><span class="n">QgsField</span><span class="p">(</span><span class="s1">&#39;SUM&#39;</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">Double</span><span class="p">)])</span>
<span class="n">outlayer</span><span class="o">.</span><span class="n">updateFields</span><span class="p">()</span>

<span class="c1"># Set the value of the &#39;SUM&#39; field for each feature</span>
<span class="n">outlayer</span><span class="o">.</span><span class="n">startEditing</span><span class="p">()</span>
<span class="n">new_field_index</span> <span class="o">=</span> <span class="n">outlayer</span><span class="o">.</span><span class="n">fieldNameIndex</span><span class="p">(</span><span class="s1">&#39;SUM&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">processing</span><span class="o">.</span><span class="n">features</span><span class="p">(</span><span class="n">outlayer</span><span class="p">):</span>
  <span class="n">outlayer</span><span class="o">.</span><span class="n">changeAttributeValue</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">id</span><span class="p">(),</span> <span class="n">new_field_index</span><span class="p">,</span> <span class="n">sum_unique_values</span><span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="n">dissolve_field</span><span class="p">]])</span>
<span class="n">outlayer</span><span class="o">.</span><span class="n">commitChanges</span><span class="p">()</span>

<span class="c1"># Delete all fields except dissolve field and the newly created &#39;SUM&#39; field</span>
<span class="n">outlayer</span><span class="o">.</span><span class="n">startEditing</span><span class="p">()</span>
<span class="n">fields_to_delete</span> <span class="o">=</span> <span class="p">[</span><span class="n">fid</span> <span class="k">for</span> <span class="n">fid</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">provider</span><span class="o">.</span><span class="n">fields</span><span class="p">()))</span> <span class="k">if</span> <span class="n">fid</span> <span class="o">!=</span> <span class="n">new_field_index</span> <span class="ow">and</span> <span class="n">fid</span> <span class="o">!=</span> <span class="n">dissolve_field_index</span><span class="p">]</span>
<span class="n">provider</span><span class="o">.</span><span class="n">deleteAttributes</span><span class="p">(</span><span class="n">fields_to_delete</span><span class="p">)</span>
<span class="n">outlayer</span><span class="o">.</span><span class="n">updateFields</span><span class="p">()</span>
<span class="n">outlayer</span><span class="o">.</span><span class="n">commitChanges</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>





  <!-- Comment Section Powered by utterances -->
<div id="comments">
  <hr />
  <p>If you want to give feedback or share your experience with this tutorial, please comment below. (requires GitHub account)</p>
<script src="https://utteranc.es/client.js"
        repo="spatialthoughts/qgis-tutorials"
        issue-term="title"
        label="comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
</div>


    </div>
      
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2023, Ujaval Gandhi.<br/>
      Ultima actualizare la feb. 18, 2024.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 7.0.1.<br/>
    </p>
  </div>
</footer>
<div class="container">
  <p>This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/deed.en_US">Creative Commons Attribution 4.0 International License</a></p>
</div>
<!-- Twitter Button -->
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<!-- Disqus comments widget -->
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'qgistutorials'; // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  }());
</script>

<script type="text/javascript">
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

<!-- Script fpr language switching. Largely adapted from https://github.com/pcav/faunalia-website -->
<script>
    var currentPage = 'docs/processing_python_scripts.html'; // coming from sphinx, always without starting '/'
    var currentLang = 'en';
    $(document).ready(function(){

        var search = new RegExp('\/[a-zA-Z_]{2,8}\/'+ currentPage, 'gi');
        var langPlusPage = window.location.href.match(search);
        // it's possible this is a index.html page called without 'index.html', try without the currentPage
        if (langPlusPage==undefined){
            search = new RegExp('\/[a-zA-Z_]{2,8}\/$', 'gi');
            langPlusPage = window.location.href.match(search);
        }

        // it's possible this is an index.html page called without 'index.html', try removing index.html
        if (langPlusPage==undefined){
            currentPage = currentPage.replace('index.html','')
            search = new RegExp('\/[a-zA-Z_]{2,8}\/'+ currentPage, 'gi');
            langPlusPage = window.location.href.match(search);
        }
        // still no langPlugPage: stop, because the language swicher will misbehave 

        if (langPlusPage == undefined || langPlusPage.length != 1){
            alert('You hit an error, please report back to us.');
            return;
        }
        langPlusPage = langPlusPage[0];
        currentLang = langPlusPage.replace(currentPage, '');

        $("#languages").val(currentLang.replace(/\//g,'')); // currentLang is something like '/nl/'

        $("#languages").change(function() {
            gotoLang($(this).val());
        });

    });

    // load current page in a different language
    function gotoLang(lang){
        var currentUrl = window.location.href;
        var newUrl = currentUrl.replace(currentLang, '/'+lang+'/');
        window.location.href = newUrl;
    }
</script>

  </body>
</html>