<!DOCTYPE html>

<html lang="es" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Creación de un cartograma animado (QGIS3) &#8212; QGIS Tutorials and Tips</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/bootstrap-sphinx.css?v=0bf093e7" />
    <script src="../../_static/documentation_options.js?v=92345faf"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/translations.js?v=efdbd0b9"></script>
    <link rel="search" title="Búsqueda" href="../../search.html" />
    <link rel="next" title="Visualización y Enrutamiento Básico de Red (QGIS3)" href="basic_network_analysis.html" />
    <link rel="prev" title="Creación de mapas interactivos (QGIS3)" href="interactive_reveal_maps.html" />

<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../../_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>


<!-- Cookie Notice -->
<!-- Script from https://github.com/AOEpeople/cookie-notice -->
<script type="text/javascript" src="../../_static/cookie.notice.min.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-B1WQ7B80XJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-B1WQ7B80XJ');
</script>


  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          QGIS Tutorials and Tips</a>
        <span class="navbar-text navbar-version pull-left"><b>v1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Tutorials List <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introducción</a></li>
<li class="toctree-l1"><a class="reference internal" href="making_a_map.html">Haciendo un Mapa (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="working_with_attributes.html">Trabajando con atributos (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="importing_spreadsheets_csv.html">Importar Hojas de Cálculo o archivos CSV (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic_vector_styling.html">Estilo Básico Vectorial (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="calculating_line_lengths.html">Calcular Longitudes y Estadísticas de Línea (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="raster_styling_and_analysis.html">Estilos y Análisis Básicos Ráster (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="raster_mosaicing_and_clipping.html">Mosaicar y Recortar Ráster (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="working_with_terrain.html">Trabajar con Datos de Terreno (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="working_with_wms.html">Trabajar con Datos WMS (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="working_with_projections.html">Trabajar con Proyecciones (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="georeferencing_basics.html">Georeferenciar Hojas Topográficas y Mapas Escaneados (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced_georeferencing.html">Georeferenciar Imágenes Aéreas (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="digitizing_basics.html">Digitalizar Datos del Mapa (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="performing_table_joins.html">Realizar Uniones de Tablas (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="performing_spatial_joins.html">Realizar Uniones Espaciales (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="performing_spatial_queries.html">Realizar Consultas Espaciales (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="nearest_neighbor_analysis.html">Análisis del Vecino Más Cercano (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="sampling_raster_data.html">Muestrear Datos Ráster usando Puntos o Polígonos (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="calculating_raster_area.html">Cálcular el área ráster (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="creating_heatmaps.html">Crear Mapas de Calor (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="animating_time_series.html">Animar Datos de Series de Tiempo (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="handling_invalid_geometries.html">Manejar Geometrías No Válidas (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced_raster_analysis.html">Análisis Avanzado de Ráster (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="interpolating_point_data.html">Interpolar Datos Punto (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="batch_processing.html">Procesamiento por Lotes usando el Marco de Procesamiento (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="processing_graphical_modeler.html">Automatizar Flujos de Trabajo Complejos usando el Modelador de Procesos (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="automating_map_creation.html">Automatización de la creación de mapas con el Atlas de diseñador de impresiones  (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="multi_criteria_overlay.html">Análisis de Sobreposición Multicriterio (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="vector_styling_expressions.html">Filtrado básico y estilización con expresiones (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="block_world_styling.html">Creación de un Mapa Mundial de Bloques (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="river_styling_expressions.html">Estilización de una red fluvial con expresiones (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="contour_3d_styling.html">Styling Contours in 3D (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="isometric_buildings.html">Creación de edificios isométricos (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="interactive_canvas_maps.html">Creación de mapas interactivos en lienzo (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="interactive_reveal_maps.html">Creación de mapas interactivos (QGIS3)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Creación de un cartograma animado (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic_network_analysis.html">Visualización y Enrutamiento Básico de Red (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="origin_destination_matrix.html">Localizando la Instalación Más Cercana con Matriz Origen-Destino (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="service_area_analysis.html">Análisis de Área de Servicio usando Openrouteservice (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="travel_time_analysis.html">Análisis del tiempo de viaje con el movimiento de Uber (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="areal_mean_rainfall.html">Calcular la Precipitación Media de Área (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="colorized_river_basin_map.html">Creación de un mapa de cuenca fluvial coloreado (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="creating_landuse_map.html">Creación de un mapa de uso de la tierra (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="calculating_intersection_density.html">Calcular Densidad de Intersección de Calle (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="landuse_buffer.html">Determinación de zonas de influencia de usos de la tierra (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="solidwaste_mapping.html">Cartografía de los volúmenes de eliminación de residuos (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started_with_pyqgis.html">Iniciándote con la Programación Python (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="processing_algorithms_pyqgis.html">Ejecutar Algoritmos de Procesamiento vía Python (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom_python_functions.html">Usando Funciones de Expresión Python Personalizadas (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="processing_python_scripts.html">Escribir Scripts Python para el Marco de Procesamiento (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="building_a_python_plugin.html">Construyendo un Complemento Python (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="processing_python_plugin.html">Construyendo un Complemento de Procesamiento (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../running_qgis_jobs.html">Ejecutar y Programar Trabajos de Procesamiento QGIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="web_mapping_with_qgis2web.html">Mapeo Web con QGIS2Web (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../creating_basemaps_with_qtiles.html">Creando Mapas Base con QTiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="using_plugins.html">Usar Complementos (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../downloading_osm_data.html">Buscando y descargando datos de OpenStreetMap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../learning_resources.html">Recursos de Aprendizaje QGIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../credits.html">Créditos de los Datos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../batch_processing.html">Procesamiento por Lotes usando el Marco de Procesamiento (QGIS2)</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="interactive_reveal_maps.html" title="Previous Chapter: Creación de mapas interactivos (QGIS3)"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Creación de m...</span>
    </a>
  </li>
  <li>
    <a href="basic_network_analysis.html" title="Next Chapter: Visualización y Enrutamiento Básico de Red (QGIS3)"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Visualización... &raquo;</span>
    </a>
  </li>
              
            
            

            

            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><h4>Author</h4>
<p>Ujaval Gandhi</p>
<a href="https://twitter.com/intent/follow?screen_name=spatialthoughts" class="twitter-follow-button" data-show-count="false">Follow @spatialthoughts</a>
<hr>
<p>Want to learn QGIS in a structured way? Check out <a href="https://spatialthoughts.com/" target="_blank">Spatial Thoughts</a> for more learning materials and instructor-led online programs with QGIS.org certification.</p>

<hr>
<p>These tutorials are also available in many other languages. Please see <a href="https://www.qgistutorials.com/en/docs/introduction.html#translations" target="_blank">translations</a> page.
</p>
        </div>
      </div>
    <div class="body col-md-9 content" role="main">
      

  <section id="creating-an-animated-cartogram-qgis3">
<h1>Creación de un cartograma animado (QGIS3)<a class="headerlink" href="#creating-an-animated-cartogram-qgis3" title="Link to this heading">¶</a></h1>
<p>El cartograma es un tipo de visualización cartográfica en el que la forma de cada objeto espacial se distorsiona en proporción a una variable. Los cartogramas facilitan la visualización de grandes variaciones en los datos. El método más sencillo para crear un cartograma es escalar el tamaño de cada región en función de una variable. Este método conserva la forma original del polígono y sólo cambia el tamaño. Estos se conocen como <a class="reference external" href="https://es.wikipedia.org/wiki/Cartograma#Cartogramas_sin_contig%C3%BCidad">Cartogramas isomórficos no contiguos</a>. En este tutorial aprenderemos a utilizar expresiones de QGIS para crear un cartograma y a utilizar el Controlador Temporal para crear una animación que transforme gradualmente los objetos espaciales hasta el tamaño objetivo.</p>
<p>This tutorial is builds on <a class="reference external" href="https://www.youtube.com/watch?v=qxKD6wcFUcE">Hans van der Kwast’s excellent cartogram tutorial</a>. The formula for scale factor used here is from the original paper <a class="reference external" href="https://doi.org/10.1111/j.0033-0124.1976.00371.x">Noncontiguous Area Cartograms</a> by Judy M Olson.</p>
<section id="overview-of-the-task">
<h2>Visión general de la tarea<a class="headerlink" href="#overview-of-the-task" title="Link to this heading">¶</a></h2>
<p>We will take a layer of states in the US and create an animated cartogram by scaling each state by population. The resulting map will have each state’s area proportional its population.</p>
<blockquote>
<div><img alt="../../_images/output.gif" class="align-center" src="../../_images/output.gif" />
</div></blockquote>
</section>
<section id="get-the-data">
<h2>Obtener los datos<a class="headerlink" href="#get-the-data" title="Link to this heading">¶</a></h2>
<p><a class="reference external" href="https://www.census.gov/">La Oficina del Censo de los Estados Unidos</a> proporciona archivos de límites cartográficos junto con conjuntos de datos demográficos. Descargaremos los datos y los procesaremos para crear una capa de datos adecuada para nuestra tarea.</p>
<ol class="arabic simple">
<li><p>Visite la página de datos <a class="reference external" href="https://www.census.gov/geographies/mapping-files/time-series/geo/carto-boundary-file.html">Cartographic Boundary Files - Shapefile</a> en el sitio web de la Oficina del Censo de Estados Unidos. Desplácese hacia abajo y descargue el archivo shape de los estados <code class="docutils literal notranslate"><span class="pre">cb_2018_us_state_20m.zip</span></code>. Contiene los polígonos estatales que necesitamos para la visualización.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/data19.png" class="align-center" src="../../_images/data19.png" />
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Los polígonos estatales no contienen datos demográficos. Estos datos deben descargarse por separado y unirse al archivo shape para su uso en un SIG. Visite la página <a class="reference external" href="https://www.census.gov/data/tables/time-series/demo/popest/2020s-state-total.html">Totales de Población Estatal y Componentes de Cambio: 2020-2023</a> y descargue las <em>Estimaciones Anuales de Población, Componentes Estimados de Cambio de Población Residente y Tasas de los Componentes de Cambio de Población Residente para los Estados Unidos, Estados, Distrito de Columbia y Puerto Rico: April 1, 2020 to July 1, 2023</em> dataset que se descargará como <code class="docutils literal notranslate"><span class="pre">NST-EST2023-ALLDATA.csv</span></code>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/data23.png" class="align-center" src="../../_images/data23.png" />
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>Abra QGIS. Localice el archivo <code class="docutils literal notranslate"><span class="pre">cb_2018_us_state_20m.zip</span></code> en el <span class="guilabel">Browser</span> de QGIS y expándalo. Arrastre y suelte la capa <code class="docutils literal notranslate"><span class="pre">cb_2018_us_state_20m.shp</span></code> al lienzo.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/data33.png" class="align-center" src="../../_images/data33.png" />
</div></blockquote>
<ol class="arabic simple" start="4">
<li><p>Se añadirá una nueva capa <code class="docutils literal notranslate"><span class="pre">cb_2018_us_state_20m</span></code> al panel <span class="guilabel">Layers`</span>. A continuación, cargaremos el archivo CSV. Haga clic en el botón <span class="guilabel">Abrir gestor de fuentes de datos</span>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/data43.png" class="align-center" src="../../_images/data43.png" />
</div></blockquote>
<ol class="arabic simple" start="5">
<li><p>Cambie a la pestaña <span class="guilabel">Texto delimitado</span>. Haga clic en <span class="guilabel">…</span> junto a <span class="guilabel">Nombre de archivo</span> y busque el archivo descargado <code class="docutils literal notranslate"><span class="pre">NST-EST2023-ALLDATA.csv</span></code>. Despliegue la sección <span class="guilabel">Definición de geometría</span> y seleccione <code class="docutils literal notranslate"><span class="pre">Sin</span> <span class="pre">geometría</span> <span class="pre">(tabla</span> <span class="pre">sólo</span> <span class="pre">de</span> <span class="pre">atributos)</span></code>. Haga clic en <span class="guilabel">Añadir</span>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/data53.png" class="align-center" src="../../_images/data53.png" />
</div></blockquote>
<ol class="arabic simple" start="6">
<li><p>A new layer <code class="docutils literal notranslate"><span class="pre">NST-EST2023-ALLDATA</span></code> will be added to the <span class="guilabel">Layers</span> panel. Right-click and select <span class="guilabel">Open Attribute Table</span>. This table has the population counts in the <code class="docutils literal notranslate"><span class="pre">POPESTIMATE2023</span></code> column. Each state has a unique id in the <code class="docutils literal notranslate"><span class="pre">STATE</span></code> column that we will use to join this table with the polygon layer.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/data63.png" class="align-center" src="../../_images/data63.png" />
</div></blockquote>
<ol class="arabic simple" start="7">
<li><p>Right-click the <code class="docutils literal notranslate"><span class="pre">cb_2018_us_state_20m</span></code> layer and select <span class="guilabel">Open Attribute Table</span>. The state ids are contained in the <code class="docutils literal notranslate"><span class="pre">GEOID</span></code> column. While the numbers are the same, they are formatted as a 2-digit 0-padded number. To match these with the <code class="docutils literal notranslate"><span class="pre">STATE</span></code> column from our population table, we need similarly formatted numbers. Select the <code class="docutils literal notranslate"><span class="pre">NST-EST2023-ALLDATA</span></code>. Go to <span class="menuselection">Processing ‣ Toolbox</span>. Search and locate the <span class="menuselection">Vector table ‣ Field calculator</span> algorithm. Double-click to open it.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/data73.png" class="align-center" src="../../_images/data73.png" />
</div></blockquote>
<ol class="arabic simple" start="8">
<li><p>En el cuadro de diálogo <span class="guilabel">Calculadora de campos</span>, seleccione <code class="docutils literal notranslate"><span class="pre">NST-EST2023-ALLDATA</span></code> como <span class="guilabel">Capa de entrada`</span>. Introduzca <code class="docutils literal notranslate"><span class="pre">GEOID</span></code> como <span class="guilabel">Nombre de campo`</span> y defina el <span class="guilabel">Tipo de campo de resultado`</span> como <code class="docutils literal notranslate"><span class="pre">Texto</span> <span class="pre">(cadena)</span></code>. A continuación, tomaremos los números del campo <code class="docutils literal notranslate"><span class="pre">STATE</span></code> y utilizaremos la función <code class="docutils literal notranslate"><span class="pre">lpad()</span></code> para crear una cadena de 2 dígitos con 0 puntos. Introduzca la siguiente expresión y haga clic en <span class="guilabel">Ejecutar</span>.</p></li>
</ol>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>lpad(&quot;STATE&quot;, 2, &#39;0&#39;)
</pre></div>
</div>
<img alt="../../_images/data82.png" class="align-center" src="../../_images/data82.png" />
</div></blockquote>
<ol class="arabic simple" start="9">
<li><p>Se añadirá una nueva capa <code class="docutils literal notranslate"><span class="pre">Calculated</span></code> al panel <span class="guilabel">Capas</span>. Haga clic con el botón derecho y seleccione <span class="guilabel">Abrir tabla de atributos</span>. Observe que la columna recién creada <code class="docutils literal notranslate"><span class="pre">GEOID</span></code> tiene los identificadores correctamente formateados. Ahora podemos utilizar este campo para unir esta tabla con la capa de estados. Busque y localice el algoritmo <span class="menuselection">Vector general ‣ Unir atributos por valor de campo</span>. Haga doble clic para abrirlo.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/data92.png" class="align-center" src="../../_images/data92.png" />
</div></blockquote>
<ol class="arabic simple" start="10">
<li><p>En el cuadro de diálogo <span class="guilabel">Unir atributos por valor de campo</span>, seleccione <code class="docutils literal notranslate"><span class="pre">cb_2018_us_state_20m</span></code> como <span class="guilabel">Capa de entrada</span>. Seleccione <code class="docutils literal notranslate"><span class="pre">GEOID</span></code> como <span class="guilabel">Campo de tabla</span>. Para <span class="guilabel">Capa de entrada 2</span>, seleccione nuestra tabla <code class="docutils literal notranslate"><span class="pre">Calculated</span></code> y <span class="guilabel">Campo de tabla 2`</span> seleccione <code class="docutils literal notranslate"><span class="pre">GEOID</span></code>. La tabla tiene muchas columnas pero sólo necesitamos la población del último año. Haga clic en el botón <span class="guilabel">…</span> de <span class="guilabel">Campos 2 a copiar`</span> y seleccione sólo el campo <code class="docutils literal notranslate"><span class="pre">POPESTIMATE2023</span></code>. Deje las demás opciones predeterminadas y haga clic en <span class="guilabel">Ejecutar</span>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/data102.png" class="align-center" src="../../_images/data102.png" />
</div></blockquote>
<ol class="arabic simple" start="11">
<li><p>Se añadirá una nueva capa <code class="docutils literal notranslate"><span class="pre">Joined</span> <span class="pre">layer</span></code> al panel <span class="guilabel">Capas</span>. Antes de utilizar esta capa para nuestro cartograma, vamos a reproyectarla a un SRC proyectado. Busque y localice el algoritmo <span class="menuselection">Vector general ‣ Reproyectar capa</span>. Haga doble clic para abrirlo.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/data114.png" class="align-center" src="../../_images/data114.png" />
</div></blockquote>
<ol class="arabic simple" start="12">
<li><p>In the <span class="guilabel">Reproject layer</span> dialog, select <code class="docutils literal notranslate"><span class="pre">Joined</span> <span class="pre">layer</span></code> as the <span class="guilabel">Input layer</span>. For the <span class="guilabel">Target CRS</span>, click the <span class="guilabel">Select CRS</span> button. Search for the <code class="docutils literal notranslate"><span class="pre">North_America_Albers_Equal_Area_Conic</span></code> CRS and select it. This is our final layer so we will save it to disk. Click the <span class="guilabel">…</span> button next to <span class="guilabel">Reprojected</span> and select <span class="guilabel">Save to File…</span>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/data123.png" class="align-center" src="../../_images/data123.png" />
</div></blockquote>
<ol class="arabic simple" start="13">
<li><p>Introduzca el nombre de la capa como <code class="docutils literal notranslate"><span class="pre">us_states_with_population.gpkg</span></code> y seleccione <span class="guilabel">Guardar</span>. Haga clic en <span class="guilabel">Ejecutar</span> para crear el archivo GeoPackage con los datos reproyectados.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/data132.png" class="align-center" src="../../_images/data132.png" />
</div></blockquote>
<p>Utilizaremos esta capa en la siguiente sección. Para mayor comodidad, puede descargar directamente una copia de la capa anterior desde abajo:</p>
<p><a class="reference external" href="https://www.qgistutorials.com/downloads/us_states_with_population.gpkg">us_states_with_population.gpkg</a></p>
<p>Fuente de datos <a class="reference internal" href="../credits.html#uscensus" id="id1"><span>[USCENSUS]</span></a></p>
</section>
<section id="procedure">
<h2>Procedimiento<a class="headerlink" href="#procedure" title="Link to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>Inicie un nuevo proyecto QGIS. Localice el archivo <code class="docutils literal notranslate"><span class="pre">us_states_with_population.gpkg</span></code> en la etiqueta <span class="guilabel">Navegador</span> y expándalo. Arrastre y suelte la capa <code class="docutils literal notranslate"><span class="pre">us_states_with_population</span></code> al lienzo vacío.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/140.png" class="align-center" src="../../_images/140.png" />
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>A new layer <code class="docutils literal notranslate"><span class="pre">us_states_with_population</span></code> will be added to the <span class="guilabel">Layers</span> panel. Right-click and select <span class="guilabel">Open Attribute Table</span>. For our cartogram, we need to use the population density as the variable. We will use the population values in the <code class="docutils literal notranslate"><span class="pre">POPESTIMATE2023</span></code> field. Close the attribute table.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/227.png" class="align-center" src="../../_images/227.png" />
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>Search and locate the <span class="menuselection">Vector table ‣ Field calculator</span> algorithm from the Processing Toolbox. Double-click to open it.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/319.png" class="align-center" src="../../_images/319.png" />
</div></blockquote>
<ol class="arabic simple" start="4">
<li><p>In the <span class="guilabel">Field calculator</span> dialog, select <code class="docutils literal notranslate"><span class="pre">us_states_with_population</span></code> as the <span class="guilabel">Input layer</span>. Enter <code class="docutils literal notranslate"><span class="pre">density</span></code> as the <span class="guilabel">Field name</span>. Enter the following expression to compute the density. As the function <code class="docutils literal notranslate"><span class="pre">area(&#64;geometry)</span></code> calculates the area in the unit of the CRS (which is in meters), we apply the conversion factor to convert it to square kilometers. Click <span class="guilabel">Run</span>.</p></li>
</ol>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>1000*1000* &quot;POPESTIMATE2023&quot; /
area(@geometry)
</pre></div>
</div>
<img alt="../../_images/48.png" class="align-center" src="../../_images/48.png" />
</div></blockquote>
<ol class="arabic simple" start="5">
<li><p>Click the <span class="guilabel">…</span> button next to <span class="guilabel">Calculated</span> and select <span class="guilabel">Save to File…</span>. Enter the name of the layer as <code class="docutils literal notranslate"><span class="pre">us_states_population_density.gpkg</span></code> and select <span class="guilabel">Save</span>. Click <span class="guilabel">Run</span>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/58.png" class="align-center" src="../../_images/58.png" />
</div></blockquote>
<ol class="arabic simple" start="6">
<li><p>A new layer <code class="docutils literal notranslate"><span class="pre">us_states_population_density</span></code> will be added to the <span class="guilabel">Layers</span> panel. Right-click and select <span class="guilabel">Open Attribute Table</span>. We need to pick an <strong>Anchor</strong> feature against which all other features will be scaled. Ideally you would pick the feature with the highest value of the variable you want to use for the cartogram. This will ensure there are no overlapping areas. Double-click the <span class="guilabel">density</span> column header to sort the table by density. You will notice that the highest density value in our dataset is quite large compared to other values and it belongs to a fairly small state. This will result all the features being scaled to very small sizes. We can pick the feature the second highest density which has a relatively large area and its density is comparable to other features.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/68.png" class="align-center" src="../../_images/68.png" />
</div></blockquote>
<ol class="arabic simple" start="7">
<li><p>In Area cartograms, the scale factor determines how much the feature’s area is reduced. We must reduce each feature’s area so that the population density of the feature is the same as the population density of the anchor feature. The formula for scale factor is the ratio of the square-root of the feature’s value against the square-root of the value of the anchor feature. Open the <span class="menuselection">Vector table ‣ Field calculator</span> algorithm from the Processing Toolbox. In the <span class="guilabel">Field calculator</span> dialog, select <code class="docutils literal notranslate"><span class="pre">us_states_population_density</span></code> as the <span class="guilabel">Input layer</span>. Enter <code class="docutils literal notranslate"><span class="pre">scale_factor</span></code> as the <span class="guilabel">Field name</span>. Enter the following expression to compute the scale factor. The expression calculates the ratio of the square root of the feature’s density against the square root of the density of the second largest density value. Click the <span class="guilabel">…</span> button next to <span class="guilabel">Calculated</span> and select <span class="guilabel">Save to File…</span>. Enter the name of the layer as <code class="docutils literal notranslate"><span class="pre">us_states_scale_factor.gpkg</span></code> and select <span class="guilabel">Save</span>. Click <span class="guilabel">Run</span>.</p></li>
</ol>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sqrt(&quot;density&quot;)/array_get(array_agg(
   expression:=sqrt(&quot;density&quot;),
   order_by:=sqrt(&quot;density&quot;)), -2)
</pre></div>
</div>
<img alt="../../_images/78.png" class="align-center" src="../../_images/78.png" />
</div></blockquote>
<ol class="arabic simple" start="8">
<li><p>A new layer <code class="docutils literal notranslate"><span class="pre">us_states_scale_factor</span></code> will be added to the <span class="guilabel">Layers</span> panel. Right-click and select <span class="guilabel">Open Attribute Table</span>. The <code class="docutils literal notranslate"><span class="pre">scale_factor</span></code> field now contains the ratio by which each feature must be scaled to have the same population density as the anchor feature.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/88.png" class="align-center" src="../../_images/88.png" />
</div></blockquote>
<ol class="arabic simple" start="9">
<li><p>We only need the <code class="docutils literal notranslate"><span class="pre">us_states_scale_factor</span></code> layer for the final visualization. Select the remaining layers, right-click and select <span class="guilabel">Remove Layer</span>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/98.png" class="align-center" src="../../_images/98.png" />
</div></blockquote>
<ol class="arabic simple" start="10">
<li><p>Select the <code class="docutils literal notranslate"><span class="pre">us_states_scale_factor</span></code> layer and click the <span class="guilabel">Open the layer styling panel</span> button in the <span class="guilabel">Layers</span> panel. Select <span class="guilabel">Simple Fill</span> and open the drop-down selector for <span class="guilabel">Symbol layer type</span>. Set the <span class="guilabel">Symbol layer type</span> to <code class="docutils literal notranslate"><span class="pre">Outline:</span> <span class="pre">Simple</span> <span class="pre">Line</span></code> and select a <span class="guilabel">Color</span> of your choice. This symbol layer will be a reference for our map when we resize the polygons.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/1012.png" class="align-center" src="../../_images/1012.png" />
</div></blockquote>
<ol class="arabic simple" start="11">
<li><p>Click the <span class="guilabel">Add Symbol layer (+)</span> button. A new symbol layer <span class="guilabel">Simple Fill</span> will be added. Set the <span class="guilabel">Fill color</span> to the same color as the lines and the <span class="guilabel">Stroke color</span> to be a slightly darker color.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/1115.png" class="align-center" src="../../_images/1115.png" />
</div></blockquote>
<ol class="arabic simple" start="12">
<li><p>Next, open the drop-down selector for <span class="guilabel">Symbol layer type</span> and select <code class="docutils literal notranslate"><span class="pre">Geometry</span> <span class="pre">Generator</span></code> as the <span class="guilabel">Symbol layer type</span>. Geometry generator allows us to modify the geometry for rendering using expressions. Click the <span class="guilabel">Expression Builder</span> button.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/1213.png" class="align-center" src="../../_images/1213.png" />
</div></blockquote>
<ol class="arabic simple" start="13">
<li><p>We will use the <cite>scale()</cite> function which resizes the given geometry by X- and Y-scaling factors. For our cartogram, we want to resize each polygon by the ratio of its population to the highest population. Enter the following expression to apply this scaling and click <span class="guilabel">OK</span>.</p></li>
</ol>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>scale(
   @geometry,
   &quot;scale_factor&quot;,
   &quot;scale_factor&quot;,
   centroid(@geometry)
)
</pre></div>
</div>
<img alt="../../_images/1311.png" class="align-center" src="../../_images/1311.png" />
</div></blockquote>
<ol class="arabic simple" start="14">
<li><p>You will see the state polygons are now sized by the proportion of each state’s population to the highest population. Many large states with low population densities are now much smaller than their original size. You will notice that polygons with irregular shapes are off-center after being scaled. This is because the anchor point of the scaling is the centroid of the geometry which is often the representative point for the polygon. Let’s update our expression to fix this. Click the <span class="guilabel">Expression Builder</span> button.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/1410.png" class="align-center" src="../../_images/1410.png" />
</div></blockquote>
<ol class="arabic simple" start="15">
<li><p>The <cite>scale()</cite> function takes an optional parameter to specify the scaling center point. We will use the <cite>pole_of_inaccessibility()</cite> function to find a representative anchor point for each polygon. This is similar to a centroid, but it is guaranteed to be inside of the polygon whereas a centroid can fall outside for certain shapes. Update the expression as shown below which calculates the pole of inaccessibility of the geometry with a small tolerance value and click <span class="guilabel">OK</span>.</p></li>
</ol>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>scale(
    @geometry,
    &quot;scale_factor&quot;,
    &quot;scale_factor&quot;,
    pole_of_inaccessibility(@geometry, 100)
)
</pre></div>
</div>
<img alt="../../_images/1510.png" class="align-center" src="../../_images/1510.png" />
</div></blockquote>
<ol class="arabic simple" start="16">
<li><p>Now the scaled polygons will have much better placement. We see another problem. Many features in the layer are <strong>Multipolygons</strong>, i.e. they have more than one part. Such features have 2 or more polygons that are part of the same geometry. With our current expression, both are scaled with the same anchor point computed from the combined geometry. This is not ideal. For example, a large feature with multiple islands should be scaled such that each island is scaled with its own center point. To fix this, we update our expression to iterate over each part of the geometry and scale it with its own center. Click the <span class="guilabel">Expression Builder</span> button.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/169.png" class="align-center" src="../../_images/169.png" />
</div></blockquote>
<ol class="arabic simple" start="17">
<li><p>Here we use the <cite>array_foreach()</cite> function to iterate over each part of the geometry and generate the scaled versions of them. Finally <cite>collect_geometries()</cite> function combines each scaled part into a single multi-polygon geometry. Update the expression as shown below and click <span class="guilabel">OK</span>.</p></li>
</ol>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>collect_geometries(
    array_foreach(generate_series(1, @geometry_part_count),
            scale(geometry_n(@geometry,@element),
                    &quot;scale_factor&quot;,
                    &quot;scale_factor&quot;,
pole_of_inaccessibility(geometry_n(@geometry,@element), 100)
            )
    )
)
</pre></div>
</div>
<img alt="../../_images/1710.png" class="align-center" src="../../_images/1710.png" />
</div></blockquote>
<ol class="arabic simple" start="18">
<li><p>The result is much better scaling for multi-part features.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/188.png" class="align-center" src="../../_images/188.png" />
</div></blockquote>
<ol class="arabic simple" start="19">
<li><p>Our cartogram is ready. This map shows concentration of the population on the eastern half of the US and a striking absence of population in states west of the Mississippi river.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/197.png" class="align-center" src="../../_images/197.png" />
</div></blockquote>
<ol class="arabic simple" start="20">
<li><p>We can make an improved visualization by creating an animation that slowly transforms the original rendering to the final size. Click the <span class="guilabel">Temporal Control Panel</span> button with the Clock icon in the <span class="guilabel">Map Navigation Toolbar</span>.  Select the <span class="guilabel">Animated temporal navigation</span> button.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/207.png" class="align-center" src="../../_images/207.png" />
</div></blockquote>
<ol class="arabic simple" start="21">
<li><p>The default <span class="guilabel">Animation range</span> will be populated with a 24-hour window in the increment of 1-hour. This is fine for our use case as we will get 24-frames of animation. You can adjust this if you want a slower/faster animation. Right-click the <code class="docutils literal notranslate"><span class="pre">us_states_with_population</span></code> layer and select <span class="guilabel">Properties</span>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/2112.png" class="align-center" src="../../_images/2112.png" />
</div></blockquote>
<ol class="arabic simple" start="22">
<li><p>Select <span class="guilabel">Temporal</span> tab and enable the <span class="guilabel">Dynamic Temporal Control</span>. This layer will be updated using expression so we don’t need to configure it here. Just select <code class="docutils literal notranslate"><span class="pre">Redraw</span> <span class="pre">Layer</span> <span class="pre">Only</span></code> so that the layer is refreshed after each time step and rendered with the updated values from the expression.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/228.png" class="align-center" src="../../_images/228.png" />
</div></blockquote>
<ol class="arabic simple" start="23">
<li><p>Let’s update our Geometry Generator expression to use the animation time steps and gradually scale the geometry. Click the <span class="guilabel">Open the layer styling panel</span> button in the <span class="guilabel">Layers</span> panel. Select <span class="guilabel">Geometry Generator</span> followed by the <span class="guilabel">Expression Builder</span> button.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/236.png" class="align-center" src="../../_images/236.png" />
</div></blockquote>
<ol class="arabic simple" start="24">
<li><p>Here we want to start with a scale factor of 1 and end up with the final scale factor value for the feature in the field <code class="docutils literal notranslate"><span class="pre">scale_factor</span></code>. We use the <cite>scale_linear()</cite> function which takes the time of the current time-step and calculates the scale factor using the start and end times. Update the expression as shown below and click <span class="guilabel">OK</span>.</p></li>
</ol>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>collect_geometries(
    array_foreach(generate_series(1, @geometry_part_count),
            scale(geometry_n(@geometry,@element),
                    scale_linear(
                            epoch(@map_start_time),
                            epoch(@animation_start_time),
                            epoch(@animation_end_time),
                            1,
                            &quot;scale_factor&quot;),
                    scale_linear(
                            epoch(@map_start_time),
                            epoch(@animation_start_time),
                            epoch(@animation_end_time),
                            1,
                            &quot;scale_factor&quot;),
pole_of_inaccessibility(geometry_n(@geometry,@element), 100)
            )
    )
)
</pre></div>
</div>
<img alt="../../_images/247.png" class="align-center" src="../../_images/247.png" />
</div></blockquote>
<ol class="arabic simple" start="25">
<li><p>Back in the <span class="guilabel">Temporal Controller</span> panel, click the <span class="guilabel">Play</span> button to see the animation. You should see the shape of each polygon gradually scaled after each frame.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/257.png" class="align-center" src="../../_images/257.png" />
</div></blockquote>
<ol class="arabic simple" start="26">
<li><p>Once you are happy with the configuration, we can export the animation. Click the <span class="guilabel">Export Animation</span> button.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/266.png" class="align-center" src="../../_images/266.png" />
</div></blockquote>
<ol class="arabic simple" start="27">
<li><p>In the <span class="guilabel">Export Map Animation</span> dialog, click <span class="guilabel">…</span> next to <span class="guilabel">Output directory</span> and browse to any folder on your computer. Keep all the other options to their default value and click <span class="guilabel">Save</span>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/277.png" class="align-center" src="../../_images/277.png" />
</div></blockquote>
<ol class="arabic simple" start="28">
<li><p>The individual frames of the animation will be exported as images. We can create a video or animated GIF from these frames. I recommend using the website ezgif.com which allows you to create GIFs from individual images easily. Visit <a class="reference external" href="https://ezgif.com/maker">Ezgif Animated GIF Maker</a>. Browse to the exported animation frames and click <span class="guilabel">Upload files!</span>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/287.png" class="align-center" src="../../_images/287.png" />
</div></blockquote>
<ol class="arabic simple" start="29">
<li><p>Configure the GIF options by setting the <span class="guilabel">Delay time</span> to <code class="docutils literal notranslate"><span class="pre">5</span></code>. Check <span class="guilabel">crossfade frames</span> effect and set the <span class="guilabel">Fader delay</span> and <span class="guilabel">Fader count</span> to <code class="docutils literal notranslate"><span class="pre">2</span></code>. Click <span class="guilabel">Make a GIF!</span>/</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/296.png" class="align-center" src="../../_images/296.png" />
</div></blockquote>
<ol class="arabic simple" start="30">
<li><p>Click the <span class="guilabel">save</span> button to download the animation as a GIF file.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/output.gif" class="align-center" src="../../_images/output.gif" />
<img alt="../../_images/hawaii.gif" class="align-center" src="../../_images/hawaii.gif" />
<img alt="../../_images/alaska.gif" class="align-center" src="../../_images/alaska.gif" />
</div></blockquote>
</section>
</section>





  <!-- Comment Section Powered by utterances -->
<div id="comments">
  <hr />
  <p>If you want to give feedback or share your experience with this tutorial, please comment below. (requires GitHub account)</p>
<script src="https://utteranc.es/client.js"
        repo="spatialthoughts/qgis-tutorials"
        issue-term="title"
        label="comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
</div>


    </div>
      
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2023, Ujaval Gandhi.<br/>
      Actualizado por última vez en nov 03, 2024.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 7.2.6.<br/>
    </p>
  </div>
</footer>
<div class="container">
  <p>This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/deed.en_US">Creative Commons Attribution 4.0 International License</a></p>
</div>
<!-- Twitter Button -->
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<!-- Disqus comments widget -->
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'qgistutorials'; // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  }());
</script>

<script type="text/javascript">
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

<!-- Script fpr language switching. Largely adapted from https://github.com/pcav/faunalia-website -->
<script>
    var currentPage = 'docs/3/cartogram_animation.html'; // coming from sphinx, always without starting '/'
    var currentLang = 'en';
    $(document).ready(function(){

        var search = new RegExp('\/[a-zA-Z_]{2,8}\/'+ currentPage, 'gi');
        var langPlusPage = window.location.href.match(search);
        // it's possible this is a index.html page called without 'index.html', try without the currentPage
        if (langPlusPage==undefined){
            search = new RegExp('\/[a-zA-Z_]{2,8}\/$', 'gi');
            langPlusPage = window.location.href.match(search);
        }

        // it's possible this is an index.html page called without 'index.html', try removing index.html
        if (langPlusPage==undefined){
            currentPage = currentPage.replace('index.html','')
            search = new RegExp('\/[a-zA-Z_]{2,8}\/'+ currentPage, 'gi');
            langPlusPage = window.location.href.match(search);
        }
        // still no langPlugPage: stop, because the language swicher will misbehave 

        if (langPlusPage == undefined || langPlusPage.length != 1){
            alert('You hit an error, please report back to us.');
            return;
        }
        langPlusPage = langPlusPage[0];
        currentLang = langPlusPage.replace(currentPage, '');

        $("#languages").val(currentLang.replace(/\//g,'')); // currentLang is something like '/nl/'

        $("#languages").change(function() {
            gotoLang($(this).val());
        });

    });

    // load current page in a different language
    function gotoLang(lang){
        var currentUrl = window.location.href;
        var newUrl = currentUrl.replace(currentLang, '/'+lang+'/');
        window.location.href = newUrl;
    }
</script>

  </body>
</html>