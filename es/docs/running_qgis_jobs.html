<!DOCTYPE html>

<html lang="es" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Ejecutar y Programar Trabajos de Procesamiento QGIS &#8212; QGIS Tutorials and Tips</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=0bf093e7" />
    <script src="../_static/documentation_options.js?v=92345faf"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/translations.js?v=efdbd0b9"></script>
    <link rel="search" title="Búsqueda" href="../search.html" />
    <link rel="next" title="Mapeo Web con QGIS2Web (QGIS3)" href="3/web_mapping_with_qgis2web.html" />
    <link rel="prev" title="Construyendo un Complemento de Procesamiento (QGIS3)" href="3/processing_python_plugin.html" />

<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>


<!-- Cookie Notice -->
<!-- Script from https://github.com/AOEpeople/cookie-notice -->
<script type="text/javascript" src="../_static/cookie.notice.min.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-B1WQ7B80XJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-B1WQ7B80XJ');
</script>


  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          QGIS Tutorials and Tips</a>
        <span class="navbar-text navbar-version pull-left"><b>v1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Tutorials List <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introducción</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/making_a_map.html">Haciendo un Mapa (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/working_with_attributes.html">Trabajando con atributos (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/importing_spreadsheets_csv.html">Importar Hojas de Cálculo o archivos CSV (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/basic_vector_styling.html">Estilo Básico Vectorial (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/calculating_line_lengths.html">Calcular Longitudes y Estadísticas de Línea (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/raster_styling_and_analysis.html">Estilos y Análisis Básicos Ráster (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/raster_mosaicing_and_clipping.html">Mosaicar y Recortar Ráster (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/working_with_terrain.html">Trabajar con Datos de Terreno (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/working_with_wms.html">Trabajar con Datos WMS (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/working_with_projections.html">Trabajar con Proyecciones (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/georeferencing_basics.html">Georeferenciar Hojas Topográficas y Mapas Escaneados (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/advanced_georeferencing.html">Georeferenciar Imágenes Aéreas (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/digitizing_basics.html">Digitalizar Datos del Mapa (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/performing_table_joins.html">Realizar Uniones de Tablas (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/performing_spatial_joins.html">Realizar Uniones Espaciales (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/performing_spatial_queries.html">Realizar Consultas Espaciales (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/nearest_neighbor_analysis.html">Análisis del Vecino Más Cercano (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/sampling_raster_data.html">Muestrear Datos Ráster usando Puntos o Polígonos (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/calculating_raster_area.html">Cálcular el área ráster (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/creating_heatmaps.html">Crear Mapas de Calor (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/animating_time_series.html">Animar Datos de Series de Tiempo (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/handling_invalid_geometries.html">Manejar Geometrías No Válidas (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/advanced_raster_analysis.html">Análisis Avanzado de Ráster (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/interpolating_point_data.html">Interpolar Datos Punto (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/batch_processing.html">Procesamiento por Lotes usando el Marco de Procesamiento (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/processing_graphical_modeler.html">Automatizar Flujos de Trabajo Complejos usando el Modelador de Procesos (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/automating_map_creation.html">Automatización de la creación de mapas con el Atlas de diseñador de impresiones  (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/multi_criteria_overlay.html">Análisis de Sobreposición Multicriterio (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/vector_styling_expressions.html">Basic Filtering and Styling with Expressions (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/block_world_styling.html">Creating a Block World Map (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/river_styling_expressions.html">Styling a River Network with Expressions (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/contour_3d_styling.html">Styling Contours in 3D (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/basic_network_analysis.html">Visualización y Enrutamiento Básico de Red (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/origin_destination_matrix.html">Localizando la Instalación Más Cercana con Matriz Origen-Destino (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/service_area_analysis.html">Análisis de Área de Servicio usando Openrouteservice (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/travel_time_analysis.html">Análisis del tiempo de viaje con el movimiento de Uber (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/areal_mean_rainfall.html">Calcular la Precipitación Media de Área (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/colorized_river_basin_map.html">Creación de un mapa de cuenca fluvial coloreado (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/creating_landuse_map.html">Creación de un mapa de uso de la tierra (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/calculating_intersection_density.html">Calcular Densidad de Intersección de Calle (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/landuse_buffer.html">Determinación de zonas de influencia de usos de la tierra (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/solidwaste_mapping.html">Cartografía de los volúmenes de eliminación de residuos (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/getting_started_with_pyqgis.html">Iniciándote con la Programación Python (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/processing_algorithms_pyqgis.html">Ejecutar Algoritmos de Procesamiento vía Python (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/custom_python_functions.html">Usando Funciones de Expresión Python Personalizadas (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/processing_python_scripts.html">Escribir Scripts Python para el Marco de Procesamiento (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/building_a_python_plugin.html">Construyendo un Complemento Python (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/processing_python_plugin.html">Construyendo un Complemento de Procesamiento (QGIS3)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Ejecutar y Programar Trabajos de Procesamiento QGIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/web_mapping_with_qgis2web.html">Mapeo Web con QGIS2Web (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="creating_basemaps_with_qtiles.html">Creando Mapas Base con QTiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/using_plugins.html">Usar Complementos (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="downloading_osm_data.html">Buscando y descargando datos de OpenStreetMap</a></li>
<li class="toctree-l1"><a class="reference internal" href="learning_resources.html">Recursos de Aprendizaje QGIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="credits.html">Créditos de los Datos</a></li>
<li class="toctree-l1"><a class="reference internal" href="batch_processing.html">Procesamiento por Lotes usando el Marco de Procesamiento (QGIS2)</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="3/processing_python_plugin.html" title="Previous Chapter: Construyendo un Complemento de Procesamiento (QGIS3)"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Construyendo ...</span>
    </a>
  </li>
  <li>
    <a href="3/web_mapping_with_qgis2web.html" title="Next Chapter: Mapeo Web con QGIS2Web (QGIS3)"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Mapeo Web con... &raquo;</span>
    </a>
  </li>
              
            
            

            

            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><h4>Author</h4>
<p>Ujaval Gandhi</p>
<a href="https://twitter.com/intent/follow?screen_name=spatialthoughts" class="twitter-follow-button" data-show-count="false">Follow @spatialthoughts</a>
<hr>
<p>Want to learn QGIS in a structured way? Check out <a href="https://spatialthoughts.com/" target="_blank">Spatial Thoughts</a> for more learning materials and instructor-led online programs with QGIS.org certification.</p>

<hr>
<p>These tutorials are also available in many other languages. Please see <a href="https://www.qgistutorials.com/en/docs/introduction.html#translations" target="_blank">translations</a> page.
</p>
        </div>
      </div>
    <div class="body col-md-9 content" role="main">
      

  <section id="running-and-scheduling-qgis-processing-jobs">
<h1>Ejecutar y Programar Trabajos de Procesamiento QGIS<a class="headerlink" href="#running-and-scheduling-qgis-processing-jobs" title="Link to this heading">¶</a></h1>
<p>Puede automatizar bastantes tareas en QGIS usando scripts de Python (PyQGIS) y el Marco de Procesamiento. La mayor parte del tiempo, correría estos scripts manualmente mientras QGIS  está abierto. Mientras esto es útil, varias veces necesitará ejecutar estas tareas mediante la línea de comando y sin necesidad de abrir QGIS. Afortunadamente, puede escribir scripts python independientes que usan bibliotecas QGIS y pueden correr mediante la línea de comando. En este tutorial, aprenderemos como escribir y programar una tarea que usa el Marco de Procesamiento QGIS.</p>
<section id="overview-of-the-task">
<h2>Vista general de la tarea<a class="headerlink" href="#overview-of-the-task" title="Link to this heading">¶</a></h2>
<p>Digamos que estamos trabajando en algún análisis usando archivos shape de una región. Los archivos shape están actualizados diariamente y siempre necesitamos el último archivo. Pero antes que podamos usar estos archivos, necesitamos limpiar los datos. Podemos establecer un trabajo QGIS que automatice este proceso y se ejecute diariamente de manera que tenga los últimos archivos shape limpiados para su trabajo. Escribiremos un script Python autónomo que descarga un archivo shape y ejecuta operaciones de limpieza topológica diariamente.</p>
<section id="other-skills-you-will-learn">
<h3>Otras habilidades que aprenderá<a class="headerlink" href="#other-skills-you-will-learn" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>Descarga y descompresión de archivos usando Python</p></li>
<li><p>Ejecutar cualquier algoritmo de Procesamiento mediante PyQGIS.</p></li>
<li><p>Corregir errores topológicos en una capa vectorial.</p></li>
</ul>
</section>
</section>
<section id="get-the-data">
<h2>Obtener los datos<a class="headerlink" href="#get-the-data" title="Link to this heading">¶</a></h2>
<p><a class="reference external" href="http://www.geofabrik.de/">Geofabrik</a> provee archivos shape actualizados diariamente de conjuntos de datos <a class="reference external" href="http://www.openstreetmap.org/">OpenStreetMap</a>.</p>
<p>Usaremos <a class="reference external" href="http://download.geofabrik.de/australia-oceania.html">archivos shape para Fiji</a> en este ejercicio. Descargue <a class="reference external" href="http://download.geofabrik.de/australia-oceania/fiji-latest.shp.zip">fiji-latest.shp.zip</a>  y descomprímalo en una carpeta de su disco.</p>
<p>Fuente de Datos <a class="reference internal" href="credits.html#geofabrik" id="id1"><span>[GEOFABRIK]</span></a></p>
</section>
<section id="procedure">
<h2>Procedimiento<a class="headerlink" href="#procedure" title="Link to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>Primero pasaremos por el proceso de limpiar manualmente el archivo shape para anotar los comandos que usaremos en el script python. Inicie QGIS y vaya a <span class="menuselection">Capa ‣ Añadir Capa ‣ Añadir Capa Vectorial</span>.</p></li>
</ol>
<img alt="../_images/1271.png" class="align-center" src="../_images/1271.png" />
<ol class="arabic simple" start="2">
<li><p>Explore la carpeta que contiene los archivos shape descomprimidos y seleccione el archivo <code class="docutils literal notranslate"><span class="pre">roads.shp</span></code> y clic en <span class="guilabel">Abrir</span>.</p></li>
</ol>
<img alt="../_images/2176.png" class="align-center" src="../_images/2176.png" />
<ol class="arabic simple" start="3">
<li><p>Primero debemos reproyectar la capa caminos a un SRC Proyectado. Esto nos permitirá usar <em>metros</em> como unidades cuando se realice el análisis en vez de grados. Abra <span class="menuselection">Procesos ‣ Caja de Herramientas</span>.</p></li>
</ol>
<img alt="../_images/3122.png" class="align-center" src="../_images/3122.png" />
<ol class="arabic simple" start="4">
<li><p>Busque la herramienta <span class="guilabel">Reproyectar capa</span>. Doble-clic en ella para iniciar el diálogo.</p></li>
</ol>
<img alt="../_images/475.png" class="align-center" src="../_images/475.png" />
<ol class="arabic simple" start="5">
<li><p>En el diálogo <span class="guilabel">Reproyectar Capa</span>, seleccione la capa <code class="docutils literal notranslate"><span class="pre">roads</span></code> como nuestra <span class="guilabel">Capa de Entrada</span>. Usaremos el SRC <code class="docutils literal notranslate"><span class="pre">EPSG:3460</span> <span class="pre">Fiji</span> <span class="pre">1986</span> <span class="pre">/</span> <span class="pre">Fiji</span> <span class="pre">Map</span> <span class="pre">Grid</span></code> como el <span class="guilabel">SRC Destino</span>. Clic en <span class="guilabel">Ejecutar</span>.</p></li>
</ol>
<img alt="../_images/569.png" class="align-center" src="../_images/569.png" />
<ol class="arabic simple" start="6">
<li><p>Una vez que termine el proceso, verá la capa reproyectada cargada en QGIS. Vaya a <span class="menuselection">Procesos ‣ Historia y Registro..</span>.</p></li>
</ol>
<img alt="../_images/666.png" class="align-center" src="../_images/666.png" />
<ol class="arabic simple" start="7">
<li><p>En diálogo <span class="guilabel">Historia y Registro</span>, expanda la carpeta <span class="guilabel">Algoritmo</span> y seleccione la última entrada. Verá mostrado el comando completo de procesamiento en el panel de abajo. Anote este comando para usarlo en nuestro script.</p></li>
</ol>
<img alt="../_images/765.png" class="align-center" src="../_images/765.png" />
<ol class="arabic simple" start="8">
<li><p>De vuelta en la ventana principal de QGIS, clic en el botón <span class="guilabel">SRC</span> en la esquina inferior derecha.</p></li>
</ol>
<img alt="../_images/863.png" class="align-center" src="../_images/863.png" />
<ol class="arabic simple" start="9">
<li><p>En el diálogo <span class="guilabel">Propiedades del Proyecto | SRC</span>, marque la <span class="guilabel">Habilite la transformación SRC al vuelo</span> y seleccione <code class="docutils literal notranslate"><span class="pre">EPSG:3460</span> <span class="pre">Fiji</span> <span class="pre">1986</span> <span class="pre">/</span> <span class="pre">Fiji</span> <span class="pre">Map</span> <span class="pre">Grid</span></code> como el SRC. Esto asegurará que nuestras capas originales y reproyectadas se alineen correctamente.</p></li>
</ol>
<img alt="../_images/962.png" class="align-center" src="../_images/962.png" />
<ol class="arabic simple" start="10">
<li><p>Ahora ejecutaremos la operación de limpieza. GRASS tiene un conjunto muy poderoso de herramienta de limpieza topológica. Éstas están disponible en QGIS mediante el algoritmo <code class="docutils literal notranslate"><span class="pre">v.clean</span></code>. Busque este algoritmo en la <span class="guilabel">Caja de Herramientas de Procesos</span> y doble-clic en ella para iniciar el diálogo.</p></li>
</ol>
<img alt="../_images/1070.png" class="align-center" src="../_images/1070.png" />
<ol class="arabic simple" start="11">
<li><p>Puede leer más acerca de las varias herramientas y opciones en la pestaña <span class="guilabel">Ayuda</span>. Para este tutorial, estaremos usando la herramienta <code class="docutils literal notranslate"><span class="pre">autoajuste</span></code> para eliminar vértices duplicados  que están a 1 metro de distancia uno del otro. Seleccione <code class="docutils literal notranslate"><span class="pre">Capa</span> <span class="pre">reproyectada</span></code> como la <span class="guilabel">Capa a limpiar</span>. Elija <code class="docutils literal notranslate"><span class="pre">autoajuste</span></code> como la <span class="guilabel">Herramienta de limpieza</span>. Ingrese <code class="docutils literal notranslate"><span class="pre">1.00</span></code> como el <span class="guilabel">Umbral</span>. Deje los otros campos en blanco y clic <span class="guilabel">Ejecutar</span>.</p></li>
</ol>
<img alt="../_images/11108.png" class="align-center" src="../_images/11108.png" />
<ol class="arabic simple" start="12">
<li><p>Una vez que termine el procesamiento, verá 2 capas nuevas agregadas a QGIS. La <code class="docutils literal notranslate"><span class="pre">Capa</span> <span class="pre">vectorial</span> <span class="pre">limpiada</span></code> es la capa con errores topológicos corregidos. También tendrá una <code class="docutils literal notranslate"><span class="pre">Capa</span> <span class="pre">de</span> <span class="pre">errores</span></code> que destaca los elementos espaciales que fueron reparados. Puede usar la capa de errores como una guía y acercarse para ver los vértices que fueron eliminados.</p></li>
</ol>
<img alt="../_images/1272.png" class="align-center" src="../_images/1272.png" />
<ol class="arabic simple" start="13">
<li><p>Vaya al diálogo  <span class="menuselection">Procesos ‣ Historia y Registro</span> y anote el comando completo de procesamiento para uso posterior.</p></li>
</ol>
<img alt="../_images/1368.png" class="align-center" src="../_images/1368.png" />
<ol class="arabic simple" start="14">
<li><p>Ahora estamos listos para iniciar la codificación. Vea la sección <strong>Un Editor de Texto o un IDE Python</strong> en el tutorial <a class="reference internal" href="building_a_python_plugin.html"><span class="doc">Construir una extension Python</span></a> para instrucciones para establecer su editor de texto o IDE. Para ejecutar scripts python autónomos que usen QGIS, debemos establecer varias opciones de configuración. Una buena manera de ejecutar scripts autónomos es iniciarlos mediante un archivo <code class="docutils literal notranslate"><span class="pre">.bat</span></code>. Este archivo establecerá primero las opciones de configuración y luego llamará al script de python. Cree un nuevo archivo llamado <code class="docutils literal notranslate"><span class="pre">launch.bat</span></code> e ingrese el siguiente texto. Cambie los valores de acuerdo a su configuración QGIS. No olvide reemplazar el nombre de usuario con el suyo en la ruta al script python. Las rutas en este archivo serán las mismas en su sistema si ha instalado QGIS mediante el <code class="docutils literal notranslate"><span class="pre">instalador</span> <span class="pre">OSGeo4W</span></code>. Guarde el archivo en su Escritorio.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Los usuarios Linux y Mac necesitarán crear un script shell para establecer las rutas y variables de entorno.</p>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>REM Change OSGEO4W_ROOT to point to the base install folder
SET OSGEO4W_ROOT=C:\OSGeo4W64
SET QGISNAME=qgis
SET QGIS=%OSGEO4W_ROOT%\apps\%QGISNAME%
set QGIS_PREFIX_PATH=%QGIS%
REM Gdal Setup
set GDAL_DATA=%OSGEO4W_ROOT%\share\gdal\
REM Python Setup
set PATH=%OSGEO4W_ROOT%\bin;%QGIS%\bin;%PATH%
SET PYTHONHOME=%OSGEO4W_ROOT%\apps\Python27
set PYTHONPATH=%QGIS%\python;%PYTHONPATH%

REM Launch python job
python c:\Users\Ujaval\Desktop\download_and_clean.py
pause
</pre></div>
</div>
<img alt="../_images/1464.png" class="align-center" src="../_images/1464.png" />
<ol class="arabic simple" start="15">
<li><p>Cree un nuevo archivo python e ingrese el siguiente código. Nombre el archivo como <code class="docutils literal notranslate"><span class="pre">download_and_clean.py</span></code> y guárdelo en su Escritorio.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="o">*</span>
<span class="nb">print</span> <span class="s1">&#39;Hello QGIS!&#39;</span>
</pre></div>
</div>
<img alt="../_images/1558.png" class="align-center" src="../_images/1558.png" />
<ol class="arabic simple" start="16">
<li><p>Cámbiese a su Escritorio y localice el icono <code class="docutils literal notranslate"><span class="pre">launch.bat</span></code>. Haga doble-clic para iniciar una nueva ventana de comando y ejecutar el script. Si ve una <code class="docutils literal notranslate"><span class="pre">Hola</span> <span class="pre">QGIS!</span></code> impreso en la ventana de comando, su configuración funcionó bien. Si ve errores, o no ve el texto, revise su archivo <code class="docutils literal notranslate"><span class="pre">launch.bat</span></code> y asegúrese que todas las rutas coinciden con las ubicaciones en su sistema.</p></li>
</ol>
<img alt="../_images/1655.png" class="align-center" src="../_images/1655.png" />
<ol class="arabic simple" start="17">
<li><p>De vuelta en su editor de texto, modifique el script <code class="docutils literal notranslate"><span class="pre">download_and_clean.py</span></code> para agregar el siguiente código. Este es el código de arranque para inicializar QGIS. Esto es innecesario si está ejecutando el script dentro de QGIS. Pero debido a que lo estamos ejecutándolo de fuera de QGIS, necesitamos agregarlos al inicio. Asegúrese de reemplazar el nombre de usuario con el suyo. Después de hacer estos campos, guarde el archivo y ejecute de nuevo <code class="docutils literal notranslate"><span class="pre">launch.bat</span></code>. Si ve impreso <code class="docutils literal notranslate"><span class="pre">Hola</span> <span class="pre">QGIS!</span></code>, está listo para agregar la lógica de procesamiento al script.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># Initialize QGIS Application</span>
<span class="n">QgsApplication</span><span class="o">.</span><span class="n">setPrefixPath</span><span class="p">(</span><span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">OSGeo4W64</span><span class="se">\\</span><span class="s2">apps</span><span class="se">\\</span><span class="s2">qgis&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">QgsApplication</span><span class="p">([],</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">QgsApplication</span><span class="o">.</span><span class="n">initQgis</span><span class="p">()</span>

<span class="c1"># Add the path to Processing framework</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;c:</span><span class="se">\\</span><span class="s1">Users</span><span class="se">\\</span><span class="s1">Ujaval</span><span class="se">\\</span><span class="s1">.qgis2</span><span class="se">\\</span><span class="s1">python</span><span class="se">\\</span><span class="s1">plugins&#39;</span><span class="p">)</span>

<span class="c1"># Import and initialize Processing framework</span>
<span class="kn">from</span> <span class="nn">processing.core.Processing</span> <span class="kn">import</span> <span class="n">Processing</span>
<span class="n">Processing</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="kn">import</span> <span class="nn">processing</span>

<span class="nb">print</span> <span class="s1">&#39;Hello QGIS!&#39;</span>
</pre></div>
</div>
<img alt="../_images/1752.png" class="align-center" src="../_images/1752.png" />
<ol class="arabic simple" start="18">
<li><p>Recupere el primer comando de procesamiento que guardamos de la bitácora. Este era el comando para reproyectar una capa. Pegue el comando a su script y agregue el código que le rodea que sigue. Note que los comandos de procesamiento devuelven la ruta a las capas de salida como una diccionario. Estamos almacenando esto como el valor <code class="docutils literal notranslate"><span class="pre">ret</span></code> e imprimiendo la ruta a la capa reproyectada.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">roads_shp_path</span> <span class="o">=</span> <span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">Users</span><span class="se">\\</span><span class="s2">Ujaval</span><span class="se">\\</span><span class="s2">Downloads</span><span class="se">\\</span><span class="s2">fiji-latest.shp</span><span class="se">\\</span><span class="s2">roads.shp&quot;</span>
<span class="n">ret</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">runalg</span><span class="p">(</span><span class="s1">&#39;qgis:reprojectlayer&#39;</span><span class="p">,</span> <span class="n">roads_shp_path</span><span class="p">,</span> <span class="s1">&#39;EPSG:3460&#39;</span><span class="p">,</span>
<span class="kc">None</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;OUTPUT&#39;</span><span class="p">]</span>
<span class="nb">print</span> <span class="n">output</span>
</pre></div>
</div>
<img alt="../_images/1849.png" class="align-center" src="../_images/1849.png" />
<ol class="arabic simple" start="19">
<li><p>Ejecute el script mediante <code class="docutils literal notranslate"><span class="pre">launch.bat</span></code> y verá la ruta a la capa reproyectada recién creada.</p></li>
</ol>
<img alt="../_images/1940.png" class="align-center" src="../_images/1940.png" />
<ol class="arabic simple" start="20">
<li><p>Ahora agregue el código para la limpieza de topología. Debido a que esta es nuestra salida final, agregaremos las rutas de archivos de salida como los últimos 2 argumentos para el algoritmo <code class="docutils literal notranslate"><span class="pre">grass.v.clean</span></code>. Si dejó vacíos estos, la salida será creada en un directorio temporal.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">processing</span><span class="o">.</span><span class="n">runalg</span><span class="p">(</span><span class="s2">&quot;grass:v.clean&quot;</span><span class="p">,</span>
                  <span class="n">output</span><span class="p">,</span>
                  <span class="mi">1</span><span class="p">,</span>
                  <span class="mi">1</span><span class="p">,</span>
                  <span class="kc">None</span><span class="p">,</span>
                  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                  <span class="mf">0.0001</span><span class="p">,</span>
                  <span class="s1">&#39;C:</span><span class="se">\\</span><span class="s1">Users</span><span class="se">\\</span><span class="s1">Ujaval</span><span class="se">\\</span><span class="s1">Desktop</span><span class="se">\\</span><span class="s1">clean.shp&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;C:\Users</span><span class="se">\\</span><span class="s1">Ujaval</span><span class="se">\\</span><span class="s1">Desktop</span><span class="se">\\</span><span class="s1">errors.shp&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/2035.png" class="align-center" src="../_images/2035.png" />
<ol class="arabic simple" start="21">
<li><p>Ejecute el script y verá 2 nuevos archivos shape creados en su Escritorio. Esto completa la parte de procesamiento del script. Agreguemos el código para descargar los datos del sitio web original y para descomprimirlos automáticamente. También almacenaremos la ruta al archivo descomprimido en una variable que podemos pasar después al algoritmo de procesamiento. Necesitaremos importar algunos módulos adicionales para hacer esto. (Vea el final del tutorial para el script completo con todos los cambios)</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">urllib</span>
<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">import</span> <span class="nn">tempfile</span>

<span class="n">temp_dir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>
<span class="n">download_url</span> <span class="o">=</span> <span class="s1">&#39;http://download.geofabrik.de/australia-oceania/fiji-latest.shp.zip&#39;</span>
<span class="nb">print</span> <span class="s1">&#39;Downloading file&#39;</span>
<span class="nb">zip</span><span class="p">,</span> <span class="n">headers</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">download_url</span><span class="p">)</span>
<span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="nb">zip</span><span class="p">)</span> <span class="k">as</span> <span class="n">zf</span><span class="p">:</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">zf</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;roads&#39;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">zf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">filename</span> <span class="o">==</span> <span class="s1">&#39;roads.shp&#39;</span><span class="p">:</span>
                <span class="n">roads_shp_path</span> <span class="o">=</span> <span class="n">file_path</span>
</pre></div>
</div>
<img alt="../_images/2177.png" class="align-center" src="../_images/2177.png" />
<ol class="arabic simple" start="22">
<li><p>Ejecute el script completado. Cada vez que ejecuta el script, se descargará y procesará una copia fresca de los datos.</p></li>
</ol>
<img alt="../_images/2234.png" class="align-center" src="../_images/2234.png" />
<ol class="arabic simple" start="23">
<li><p>Para automatizar la ejecución diaria de este script, podemos usar el <code class="docutils literal notranslate"><span class="pre">Programador</span> <span class="pre">de</span> <span class="pre">Tarea</span></code> en Windows. Inicie el Programador de Tarea y clic en <span class="guilabel">Crear Tarea Básica</span>.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Los usuarios de Linux y Mac pueden usar tareas cron para programar tareas.</p>
</div>
<img alt="../_images/2331.png" class="align-center" src="../_images/2331.png" />
<ol class="arabic simple" start="24">
<li><p>Nombre la tarea como <code class="docutils literal notranslate"><span class="pre">Descarga</span> <span class="pre">y</span> <span class="pre">Limpieza</span> <span class="pre">Diaria</span></code> y clic en <span class="guilabel">Siguiente</span>.</p></li>
</ol>
<img alt="../_images/2430.png" class="align-center" src="../_images/2430.png" />
<ol class="arabic simple" start="25">
<li><p>Seleccione <code class="docutils literal notranslate"><span class="pre">Diariamente</span></code> como el <span class="guilabel">Disparador</span> y clic en <span class="guilabel">Siguiente</span></p></li>
</ol>
<img alt="../_images/2527.png" class="align-center" src="../_images/2527.png" />
<ol class="arabic simple" start="26">
<li><p>Seleccione una hora a su gusto y clic en <span class="guilabel">Siguiente</span>.</p></li>
</ol>
<img alt="../_images/2625.png" class="align-center" src="../_images/2625.png" />
<ol class="arabic simple" start="27">
<li><p>Escoja <code class="docutils literal notranslate"><span class="pre">Iniciar</span> <span class="pre">un</span> <span class="pre">programa</span></code> como la <span class="guilabel">Acción</span> y clic en <span class="guilabel">Siguiente</span>.</p></li>
</ol>
<img alt="../_images/2724.png" class="align-center" src="../_images/2724.png" />
<ol class="arabic simple" start="28">
<li><p>Clic <span class="guilabel">Explorar</span> y localice el script <code class="docutils literal notranslate"><span class="pre">launch.bat</span></code>. Clic en <span class="guilabel">Siguiente</span>.</p></li>
</ol>
<img alt="../_images/2823.png" class="align-center" src="../_images/2823.png" />
<ol class="arabic simple" start="29">
<li><p>Clic <span class="guilabel">Finalizar</span> en la última pantalla para programar la tarea. Ahora el script se iniciará automáticamente cada día en la hora especificada para darle una copia fresca de los datos limpiados.</p></li>
</ol>
<img alt="../_images/2920.png" class="align-center" src="../_images/2920.png" />
<p>Abajo está el script <code class="docutils literal notranslate"><span class="pre">download_and_clean.py</span></code> completo para su referencia.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">urllib</span>
<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">import</span> <span class="nn">tempfile</span>

<span class="c1"># Initialize QGIS Application</span>
<span class="n">QgsApplication</span><span class="o">.</span><span class="n">setPrefixPath</span><span class="p">(</span><span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">OSGeo4W64</span><span class="se">\\</span><span class="s2">apps</span><span class="se">\\</span><span class="s2">qgis&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">QgsApplication</span><span class="p">([],</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">QgsApplication</span><span class="o">.</span><span class="n">initQgis</span><span class="p">()</span>

<span class="c1"># Add the path to Processing framework  </span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;c:</span><span class="se">\\</span><span class="s1">Users</span><span class="se">\\</span><span class="s1">Ujaval</span><span class="se">\\</span><span class="s1">.qgis2</span><span class="se">\\</span><span class="s1">python</span><span class="se">\\</span><span class="s1">plugins&#39;</span><span class="p">)</span>

<span class="c1"># Import and initialize Processing framework</span>
<span class="kn">from</span> <span class="nn">processing.core.Processing</span> <span class="kn">import</span> <span class="n">Processing</span>
<span class="n">Processing</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="kn">import</span> <span class="nn">processing</span>

<span class="c1"># Download and unzip the latest shapefile</span>
<span class="n">temp_dir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>
<span class="n">download_url</span> <span class="o">=</span> <span class="s1">&#39;http://download.geofabrik.de/australia-oceania/fiji-latest.shp.zip&#39;</span>
<span class="nb">print</span> <span class="s1">&#39;Downloading file&#39;</span>
<span class="nb">zip</span><span class="p">,</span> <span class="n">headers</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">download_url</span><span class="p">)</span>
<span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="nb">zip</span><span class="p">)</span> <span class="k">as</span> <span class="n">zf</span><span class="p">:</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">zf</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;roads&#39;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">zf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">filename</span> <span class="o">==</span> <span class="s1">&#39;roads.shp&#39;</span><span class="p">:</span>
                <span class="n">roads_shp_path</span> <span class="o">=</span> <span class="n">file_path</span>

<span class="nb">print</span> <span class="s1">&#39;Downloaded file to </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">roads_shp_path</span>

<span class="c1"># Reproject the Roads layer</span>
<span class="nb">print</span> <span class="s1">&#39;Reprojecting the roads layer&#39;</span>

<span class="n">ret</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">runalg</span><span class="p">(</span><span class="s1">&#39;qgis:reprojectlayer&#39;</span><span class="p">,</span> <span class="n">roads_shp_path</span><span class="p">,</span> <span class="s1">&#39;EPSG:3460&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;OUTPUT&#39;</span><span class="p">]</span>

<span class="c1"># Clean the Roads layer</span>
<span class="nb">print</span> <span class="s1">&#39;Cleaning the roads layer&#39;</span>

<span class="n">processing</span><span class="o">.</span><span class="n">runalg</span><span class="p">(</span><span class="s2">&quot;grass:v.clean&quot;</span><span class="p">,</span>
                  <span class="n">output</span><span class="p">,</span>
                  <span class="mi">1</span><span class="p">,</span>
                  <span class="mi">1</span><span class="p">,</span>
                  <span class="kc">None</span><span class="p">,</span>
                  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                  <span class="mf">0.0001</span><span class="p">,</span>
                  <span class="s1">&#39;C:</span><span class="se">\\</span><span class="s1">Users</span><span class="se">\\</span><span class="s1">Ujaval</span><span class="se">\\</span><span class="s1">Desktop</span><span class="se">\\</span><span class="s1">clean.shp&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;C:\Users</span><span class="se">\\</span><span class="s1">Ujaval</span><span class="se">\\</span><span class="s1">Desktop</span><span class="se">\\</span><span class="s1">errors.shp&#39;</span><span class="p">)</span>
<span class="nb">print</span> <span class="s1">&#39;Success&#39;</span>
</pre></div>
</div>
</section>
</section>





  <!-- Comment Section Powered by utterances -->
<div id="comments">
  <hr />
  <p>If you want to give feedback or share your experience with this tutorial, please comment below. (requires GitHub account)</p>
<script src="https://utteranc.es/client.js"
        repo="spatialthoughts/qgis-tutorials"
        issue-term="title"
        label="comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
</div>


    </div>
      
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2023, Ujaval Gandhi.<br/>
      Actualizado por última vez en jun 06, 2024.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 7.2.6.<br/>
    </p>
  </div>
</footer>
<div class="container">
  <p>This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/deed.en_US">Creative Commons Attribution 4.0 International License</a></p>
</div>
<!-- Twitter Button -->
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<!-- Disqus comments widget -->
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'qgistutorials'; // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  }());
</script>

<script type="text/javascript">
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

<!-- Script fpr language switching. Largely adapted from https://github.com/pcav/faunalia-website -->
<script>
    var currentPage = 'docs/running_qgis_jobs.html'; // coming from sphinx, always without starting '/'
    var currentLang = 'en';
    $(document).ready(function(){

        var search = new RegExp('\/[a-zA-Z_]{2,8}\/'+ currentPage, 'gi');
        var langPlusPage = window.location.href.match(search);
        // it's possible this is a index.html page called without 'index.html', try without the currentPage
        if (langPlusPage==undefined){
            search = new RegExp('\/[a-zA-Z_]{2,8}\/$', 'gi');
            langPlusPage = window.location.href.match(search);
        }

        // it's possible this is an index.html page called without 'index.html', try removing index.html
        if (langPlusPage==undefined){
            currentPage = currentPage.replace('index.html','')
            search = new RegExp('\/[a-zA-Z_]{2,8}\/'+ currentPage, 'gi');
            langPlusPage = window.location.href.match(search);
        }
        // still no langPlugPage: stop, because the language swicher will misbehave 

        if (langPlusPage == undefined || langPlusPage.length != 1){
            alert('You hit an error, please report back to us.');
            return;
        }
        langPlusPage = langPlusPage[0];
        currentLang = langPlusPage.replace(currentPage, '');

        $("#languages").val(currentLang.replace(/\//g,'')); // currentLang is something like '/nl/'

        $("#languages").change(function() {
            gotoLang($(this).val());
        });

    });

    // load current page in a different language
    function gotoLang(lang){
        var currentUrl = window.location.href;
        var newUrl = currentUrl.replace(currentLang, '/'+lang+'/');
        window.location.href = newUrl;
    }
</script>

  </body>
</html>