<!DOCTYPE html>

<html lang="el">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Locating Nearest Facility with Origin-Destination Matrix (QGIS3) &#8212; QGIS Tutorials and Tips</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/bootstrap-sphinx.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/translations.js"></script>
    <link rel="search" title="Αναζήτηση" href="../../search.html" />
    <link rel="next" title="Service Area Analysis using Openrouteservice (QGIS3)" href="service_area_analysis.html" />
    <link rel="prev" title="Basic Network Visualization and Routing (QGIS3)" href="basic_network_analysis.html" />

<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js "></script>


<!-- Cookie Notice -->
<!-- Script from https://github.com/AOEpeople/cookie-notice -->
<script type="text/javascript" src="../../_static/cookie.notice.min.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-B1WQ7B80XJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-B1WQ7B80XJ');
</script>


  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html"><span><img src="../../_static/logo.png"></span>
          QGIS Tutorials and Tips</a>
        <span class="navbar-text navbar-version pull-left"><b>v1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Tutorials List <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Εισαγωγή</a></li>
<li class="toctree-l1"><a class="reference internal" href="making_a_map.html">Φτιάχνοντας ένα χάρτη (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="working_with_attributes.html">Working with Attributes (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="importing_spreadsheets_csv.html">Importing Spreadsheets or CSV files (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic_vector_styling.html">Basic Vector Styling (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="calculating_line_lengths.html">Calculating Line Lengths and Statistics (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="raster_styling_and_analysis.html">Basic Raster Styling and Analysis (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="raster_mosaicing_and_clipping.html">Raster Mosaicing and Clipping (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="working_with_terrain.html">Working with Terrain Data (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="working_with_wms.html">Working with WMS Data (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="working_with_projections.html">Working with Projections (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="georeferencing_basics.html">Georeferencing Topo Sheets and Scanned Maps (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced_georeferencing.html">Georeferencing Aerial Imagery (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="digitizing_basics.html">Digitizing Map Data (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="performing_table_joins.html">Performing Table Joins (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="performing_spatial_joins.html">Performing Spatial Joins (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="performing_spatial_queries.html">Performing Spatial Queries (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="nearest_neighbor_analysis.html">Nearest Neighbor Analysis (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="sampling_raster_data.html">Sampling Raster Data using Points or Polygons (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="calculating_raster_area.html">Calculating Raster Area (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="creating_heatmaps.html">Creating Heatmaps (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="animating_time_series.html">Animating Time Series Data (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="handling_invalid_geometries.html">Handling Invalid Geometries (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced_raster_analysis.html">Advanced Raster Analysis (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="interpolating_point_data.html">Interpolating Point Data (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="calculating_intersection_density.html">Calculating Street Intersection Density (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="batch_processing.html">Batch Processing using Processing Framework (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="processing_graphical_modeler.html">Automating Complex Workflows using Processing Modeler (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="automating_map_creation.html">Automating Map Creation with Print Layout Atlas (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="multi_criteria_overlay.html">Multi Criteria Overlay Analysis (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic_network_analysis.html">Basic Network Visualization and Routing (QGIS3)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Locating Nearest Facility with Origin-Destination Matrix (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="service_area_analysis.html">Service Area Analysis using Openrouteservice (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="travel_time_analysis.html">Travel Time Analysis with Uber Movement (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="areal_mean_rainfall.html">Calculating Areal Mean Rainfall (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started_with_pyqgis.html">Getting Started With Python Programming (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="processing_algorithms_pyqgis.html">Running Processing Algorithms via Python (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom_python_functions.html">Using Custom Python Expression Functions (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="processing_python_scripts.html">Writing Python Scripts for Processing Framework (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="building_a_python_plugin.html">Building a Python Plugin (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="processing_python_plugin.html">Building a Processing Plugin (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../running_qgis_jobs.html">Running and Scheduling QGIS Processing Jobs</a></li>
<li class="toctree-l1"><a class="reference internal" href="web_mapping_with_qgis2web.html">Web Mapping with QGIS2Web (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../creating_basemaps_with_qtiles.html">Creating Basemaps with QTiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="using_plugins.html">Using Plugins (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../downloading_osm_data.html">Αναζήτηση και Λήψη OpenStreetMap Δεδομένων</a></li>
<li class="toctree-l1"><a class="reference internal" href="../learning_resources.html">QGIS Μαθησιακοί πόροι</a></li>
<li class="toctree-l1"><a class="reference internal" href="../credits.html">Συντελεστές δεδομένων</a></li>
<li class="toctree-l1"><a class="reference internal" href="../batch_processing.html">Batch Processing using Processing Framework (QGIS2)</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="basic_network_analysis.html" title="Previous Chapter: Basic Network Visualization and Routing (QGIS3)"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Basic Network...</span>
    </a>
  </li>
  <li>
    <a href="service_area_analysis.html" title="Next Chapter: Service Area Analysis using Openrouteservice (QGIS3)"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Service Area ... &raquo;</span>
    </a>
  </li>
              
            
            

            

            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><h4>Author</h4>
<p>Ujaval Gandhi</p>
<a href="https://twitter.com/intent/follow?screen_name=spatialthoughts" class="twitter-follow-button" data-show-count="false">Follow @spatialthoughts</a>
<hr>
<p>Want to learn QGIS in a structured way? Check out <a href="https://spatialthoughts.com/" target="_blank">Spatial Thoughts</a> for more learning materials and instructor-led online programs with QGIS.org certification.</p>


<h4>Change Language</h4>
<form role="form" class="sidebar-form sidebar-left">
<select id="languages" class="form-control select-mini">
  <option value="en">English</option>
  <option value="zh_TW">Chinese (Taiwan)</option>
  <option value="nl">Dutch</option>
  <option value="fi_FI">Finnish</option>
  <option value="fr">French</option>
  <option value="de">German</option>
  <option value="el">Greek</option>
  <option value="id">Indonesian</option>
  <option value="it">Italian</option>
  <option value="ko">Korean</option>
  <option value="fa">Persian</option>
  <option value="pt_BR">Portuguese</option>
  <option value="ro">Romanian</option>
  <option value="ru">Russian</option>
  <option value="sl">Slovenian</option>
  <option value="es">Spanish</option>
  <option value="th">Thai</option>
  <option value="tr">Turkish</option>
  <option value="uk">Ukrainian</option>
  <option value="vi">Vietnamese</option>
</select>
</form>
        </div>
      </div>
    <div class="body col-md-9 content" role="main">
      

  <section id="locating-nearest-facility-with-origin-destination-matrix-qgis3">
<h1>Locating Nearest Facility with Origin-Destination Matrix (QGIS3)<a class="headerlink" href="#locating-nearest-facility-with-origin-destination-matrix-qgis3" title="Μόνιμος σύνδεσμος σε αυτήν την κεφαλίδα">¶</a></h1>
<p>In the previous tutorial, <a class="reference internal" href="basic_network_analysis.html"><span class="doc">Basic Network Visualization and Routing (QGIS3)</span></a>, we learned how to build a network and calculate the shortest path between 2 points. We can apply that technique to many different types of network-based analysis. One such application is to compute <strong>Origin-Destination Matrix</strong> or <strong>OD Matrix</strong>. Given a set of origin points and another set of destination points, we can calculate the shortest path between each origin-destination pairs and find out the travel distance/time between them. Such analysis is useful to locate the closest facility to any given point. For example, a logistics company may use this analysis to find the closest warehouse to their customers to optimize delivery routes. Here we use the Distance Matrix algorithm from <strong>QGIS Network Analysis Toolbox (QNEAT3)</strong> plugin to find the nearest health facility to each address in the city.</p>
<div class="admonition note">
<p class="admonition-title">Σημείωση</p>
<p>This tutorial shows how to use your own network data to compute an origin-destination matrix. If you do not have your own network data, you can use <strong>ORS Tools Plugin</strong> and algorithm <span class="menuselection">ORS Tools ‣ Matrix ‣  Matrix from Layers</span> to do a similar analysis using OpenStreetMap data. See <a class="reference internal" href="service_area_analysis.html"><span class="doc">Service Area Analysis using Openrouteservice (QGIS3)</span></a> to learn how to use ORS Tools plugin.</p>
</div>
<section id="overview-of-the-task">
<h2>Overview of the task<a class="headerlink" href="#overview-of-the-task" title="Μόνιμος σύνδεσμος σε αυτήν την κεφαλίδα">¶</a></h2>
<p>We will take 2 layers for Washington DC - one with points representing addresses and another with points representing mental health facilities - and find out the facility with the least travel distance from each address.</p>
<section id="other-skills-you-will-learn">
<h3>Other skills you will learn<a class="headerlink" href="#other-skills-you-will-learn" title="Μόνιμος σύνδεσμος σε αυτήν την κεφαλίδα">¶</a></h3>
<ul class="simple">
<li><p>Extract a random sample from a point layer.</p></li>
<li><p>Use Virtual Layers to run SQL query on a QGIS layer.</p></li>
</ul>
</section>
</section>
<section id="get-the-data">
<h2>Get the data<a class="headerlink" href="#get-the-data" title="Μόνιμος σύνδεσμος σε αυτήν την κεφαλίδα">¶</a></h2>
<p>District of Columbia government freely shares hundreds of datasets on the <a class="reference external" href="https://opendata.dc.gov/">Open Data Catalog</a>.</p>
<p>Download the following data layers as shapefiles.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://opendata.dc.gov/datasets/roadway-block">Roadway Block</a></p></li>
<li><p><a class="reference external" href="https://opendata.dc.gov/datasets/address-points">Address Points</a></p></li>
<li><p><a class="reference external" href="https://opendata.dc.gov/datasets/adult-mental-health-providers">Adult Mental Health Providers</a></p></li>
</ul>
<p>For convenience, you may directly download a copy of the datasets from the
links below:</p>
<p><a class="reference external" href="https://www.qgistutorials.com/downloads/Roadway_Block-shp.zip">Roadway_Block-shp.zip</a></p>
<p><a class="reference external" href="https://www.qgistutorials.com/downloads/Address_Points.zip">Address_Points.zip</a></p>
<p><a class="reference external" href="https://www.qgistutorials.com/downloads/Adult_Mental_Health_Providers.zip">Adult_Mental_Health_Providers.zip</a></p>
<p>Data Source: <a class="reference internal" href="../credits.html#dcopendata" id="id1"><span>[DCOPENDATA]</span></a></p>
</section>
<section id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Μόνιμος σύνδεσμος σε αυτήν την κεφαλίδα">¶</a></h2>
<p>Visit <span class="menuselection">Plugins ‣ Manage and Install plugins</span>. Select :guilabel:` All` Search for <strong>QNEAT3</strong> plugin and install it. Click <span class="guilabel">Close</span>.</p>
<img alt="../../_images/setup11.png" class="align-center" src="../../_images/setup11.png" />
</section>
<section id="procedure">
<h2>Procedure<a class="headerlink" href="#procedure" title="Μόνιμος σύνδεσμος σε αυτήν την κεφαλίδα">¶</a></h2>
<ol class="arabic simple">
<li><p>Locate the downloaded <code class="docutils literal notranslate"><span class="pre">Roadway_Block-shp.zip</span></code> file in the <span class="guilabel">Browser</span> panel. Expand it and drag the <code class="docutils literal notranslate"><span class="pre">Roadway_Block.shp</span></code> file to the canvas. Similarly, locate the <code class="docutils literal notranslate"><span class="pre">Adult_Mental_Health_Providers.zip</span></code> file, expand it and add <code class="docutils literal notranslate"><span class="pre">Adult_Mental_Health_Providers.shp</span></code> to the canvas.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/1101.png" class="align-center" src="../../_images/1101.png" />
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Next, locate the <code class="docutils literal notranslate"><span class="pre">Address_Points.zip</span></code> file, expand it and add the <code class="docutils literal notranslate"><span class="pre">Address_Points.shp</span></code>. You will see a lot of points around the city. Each point represents a valid address. We will select 1000 points randomly. This technique is called random sampling. Go to <span class="menuselection">Processing ‣ Toolbox</span>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/260.png" class="align-center" src="../../_images/260.png" />
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>Search for and locate the <span class="menuselection">Vector Selection ‣ Random extract</span> algorithm.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/334.png" class="align-center" src="../../_images/334.png" />
</div></blockquote>
<ol class="arabic simple" start="4">
<li><p>Select <code class="docutils literal notranslate"><span class="pre">Address_Points</span></code> as the <span class="guilabel">Input layer</span>, <code class="docutils literal notranslate"><span class="pre">Number</span> <span class="pre">of</span> <span class="pre">feature</span></code> as the <span class="guilabel">Method</span> and, enter <code class="docutils literal notranslate"><span class="pre">1000</span></code> in the <span class="guilabel">Number/percentage of features</span>. In the <span class="guilabel">Extracted (random)</span> choose the <code class="docutils literal notranslate"><span class="pre">...</span></code>  and click <span class="guilabel">Save to a file</span>. Now choose the directory and enter the name as <code class="docutils literal notranslate"><span class="pre">address_point_subset.shp</span></code> and click <span class="guilabel">Run</span>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/415.png" class="align-center" src="../../_images/415.png" />
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Σημείωση</p>
<p>As the algorithm will extract 1000 random points from the given data set, to replicate the exact points used in this exercise you can download the subset file which we got during the execution of the algorithm here <a class="reference external" href="https://www.qgistutorials.com/downloads/address_point_subset.zip">address_point_subset.zip</a> . After downloading load <code class="docutils literal notranslate"><span class="pre">address_point_subset.shp</span></code> layer into QGIS.</p>
</div>
<ol class="arabic simple" start="5">
<li><p>A new layer <code class="docutils literal notranslate"><span class="pre">address_point_subset</span></code> will be added to the <span class="guilabel">Layers</span> panel, you can turn off the visibility of <code class="docutils literal notranslate"><span class="pre">Address_Points</span></code> address points layer.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/515.png" class="align-center" src="../../_images/515.png" />
</div></blockquote>
<ol class="arabic simple" start="6">
<li><p>Right-click on the <code class="docutils literal notranslate"><span class="pre">address_point_subset</span></code> layer and select <span class="guilabel">Rename layer</span>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/615.png" class="align-center" src="../../_images/615.png" />
</div></blockquote>
<ol class="arabic simple" start="7">
<li><p>Let’s rename this layer as <code class="docutils literal notranslate"><span class="pre">origin_points</span></code>. Similarly, rename the <code class="docutils literal notranslate"><span class="pre">Adult_Mental_Health_Providers</span></code> layers representing the health facilities as <code class="docutils literal notranslate"><span class="pre">destination_points</span></code>. Naming the layers this way makes it easy to identify them in subsequent processing.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/714.png" class="align-center" src="../../_images/714.png" />
</div></blockquote>
<ol class="arabic simple" start="8">
<li><p>Locate the <span class="menuselection">QNEAT3 ‣ Distance matrices ‣ OD Matrix from Layers as Line (m:n)</span> algorithm. If you do not see this algorithm in the toolbox, make sure you have installed the <strong>QNEAT3</strong> plugin.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/814.png" class="align-center" src="../../_images/814.png" />
</div></blockquote>
<ol class="arabic simple" start="9">
<li><p>This algorithm helps find the distances along with the network between selected origin and destination layers. Select <code class="docutils literal notranslate"><span class="pre">Roadway_Block</span></code> as the <span class="guilabel">Network layer</span>. Select <code class="docutils literal notranslate"><span class="pre">origin_points</span></code> as the <span class="guilabel">From-Points layer</span> and <code class="docutils literal notranslate"><span class="pre">OBJECTID_1</span></code> as the <span class="guilabel">Unique Point ID field</span>. Similarly, set <code class="docutils literal notranslate"><span class="pre">destination_points</span></code> as the <span class="guilabel">To-Points Layer</span> and <code class="docutils literal notranslate"><span class="pre">OBJECTID</span></code> as  the <span class="guilabel">Unique Point ID field</span>. Set the <span class="guilabel">Optimization Criterion</span> as <code class="docutils literal notranslate"><span class="pre">Shortest</span> <span class="pre">Path</span> <span class="pre">(distance</span> <span class="pre">optimization)</span></code>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/914.png" class="align-center" src="../../_images/914.png" />
</div></blockquote>
<ol class="arabic simple" start="10">
<li><p>As many streets in the network are one-way, we need to set the <span class="guilabel">Advanced parameters</span> to specify the direction. See <a class="reference internal" href="basic_network_analysis.html"><span class="doc">Basic Network Visualization and Routing (QGIS3)</span></a> for more details on how these attributes are structured. Choose <code class="docutils literal notranslate"><span class="pre">SUMMARYDIR</span></code> as the <span class="guilabel">Direction field</span>. Enter <code class="docutils literal notranslate"><span class="pre">OB</span></code> as the <span class="guilabel">Value for the forward direction</span>, <code class="docutils literal notranslate"><span class="pre">IB</span></code> as the <span class="guilabel">Value for backward direction</span>, and <code class="docutils literal notranslate"><span class="pre">BD</span></code> as the <span class="guilabel">Value for the both direction</span>. Set the <span class="guilabel">Topology tolerance</span> as <code class="docutils literal notranslate"><span class="pre">0.0000150</span></code>. Keep other options to their default values and click <span class="guilabel">Run</span>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/1021.png" class="align-center" src="../../_images/1021.png" />
</div></blockquote>
<ol class="arabic simple" start="11">
<li><p>A new table layer called <code class="docutils literal notranslate"><span class="pre">Output</span> <span class="pre">OD</span> <span class="pre">Matrix</span></code> will be added to the <span class="guilabel">Layers</span> panel. Right-click and select <span class="guilabel">Open Attributes Table</span>. You will see that the table contains <em>13000</em> rows. We had 13 origin points and 1000 destination points - so the output contains <em>13x1000 = 13000</em> pairs of origins and destination. The <code class="docutils literal notranslate"><span class="pre">total_cost</span></code> column contains distance in meters between each origin point to every destination point.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/1124.png" class="align-center" src="../../_images/1124.png" />
</div></blockquote>
<ol class="arabic simple" start="12">
<li><p>For this tutorial, we are interested in only the destination point with the shortest distance. We can create a SQL query to pick the destination with the least <code class="docutils literal notranslate"><span class="pre">total_cost</span></code> among all destinations. Go to <span class="menuselection">Processing ‣ Toolbox</span>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/1222.png" class="align-center" src="../../_images/1222.png" />
</div></blockquote>
<ol class="arabic simple" start="13">
<li><p>Search for and locate the <span class="menuselection">Vector general ‣ Execute SQL</span>, select <code class="docutils literal notranslate"><span class="pre">...</span></code> in <span class="guilabel">Additional input data sources</span> check the <span class="guilabel">Output OD Matrix</span> and, click <span class="guilabel">OK</span>. Now click the <span class="guilabel">Summation</span> under <span class="guilabel">SQL query</span>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/1320.png" class="align-center" src="../../_images/1320.png" />
</div></blockquote>
<ol class="arabic simple" start="14">
<li><p>Enter the following query in <span class="guilabel">SQL query</span> dialog box. Enter <code class="docutils literal notranslate"><span class="pre">geometry</span></code> as the <span class="guilabel">Geometry field</span> and, select <code class="docutils literal notranslate"><span class="pre">LineString</span></code> as the <span class="guilabel">Geometry type</span>. Click <span class="guilabel">Run</span>.</p></li>
</ol>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>select origin_id, destination_id, min(total_cost) as shortest_distance, geometry
from input1 group by origin_id
</pre></div>
</div>
<img alt="../../_images/1418.png" class="align-center" src="../../_images/1418.png" />
</div></blockquote>
<ol class="arabic simple" start="15">
<li><p>A new virtual layer <code class="docutils literal notranslate"><span class="pre">SQL</span> <span class="pre">Output</span></code> will be added to the <span class="guilabel">Layers</span> panel. This Layer has the result of our analysis. Nearest Adult mental health center for each of the 1000 origin points. Let’s try a few different ways to visualize and validate these results.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/1516.png" class="align-center" src="../../_images/1516.png" />
</div></blockquote>
<ol class="arabic simple" start="16">
<li><p>To validate this let us build the Shortest path. The point <em>(OBJECTID_1 = 853046)</em> is visually near to Health center <em>(OBJECTID = 3)</em>, but from the SQL query it is connected to health center <em>(OBJECTID = 9)</em>. Let’s validate this by finding the actual distance between these origins and destination. First, let’s run the shortest path algorithm on 1 pair. Locate the <span class="menuselection">QNEAT3 ‣ Routing ‣ Shortest path (point to point)</span> algorithm and launch it.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/1615.png" class="align-center" src="../../_images/1615.png" />
</div></blockquote>
<ol class="arabic simple" start="17">
<li><p>Select <code class="docutils literal notranslate"><span class="pre">Roadway_Block</span></code> as the <span class="guilabel">Network Layer</span>. To pick a start and endpoint. You can click the <span class="guilabel">…</span> button next to the <span class="guilabel">Start point</span> and click on the origin point <em>(OBJECTID_1 = 853046)</em> in the canvas. Similarly, select the destination point <em>(OBJECTID = 3)</em> as the <span class="guilabel">End point</span>. Keep the <span class="guilabel">Optimization Criterion</span> as <code class="docutils literal notranslate"><span class="pre">Shortest</span> <span class="pre">Path</span> <span class="pre">(distance</span> <span class="pre">optimization)</span></code>. Expand the <span class="guilabel">Advanced parameter</span> section. Choose <code class="docutils literal notranslate"><span class="pre">SUMMARYDIR</span></code> as the <span class="guilabel">Direction field</span>. Enter <code class="docutils literal notranslate"><span class="pre">OB</span></code> as the <span class="guilabel">Value for forward direction</span> and <code class="docutils literal notranslate"><span class="pre">IB</span></code> as the <span class="guilabel">Value for backward direction</span>. Set the <span class="guilabel">Topology tolerance</span> as <code class="docutils literal notranslate"><span class="pre">0.000015</span></code>. Keep other options to their default values and click <span class="guilabel">Run</span>. Now change the destination point <em>(OBJECTID = 9)</em> in the <span class="guilabel">End point</span> and click <span class="guilabel">Run</span></p></li>
</ol>
<blockquote>
<div><img alt="../../_images/1716.png" class="align-center" src="../../_images/1716.png" />
</div></blockquote>
<ol class="arabic simple" start="18">
<li><p>Two new layers <code class="docutils literal notranslate"><span class="pre">Shortest</span> <span class="pre">Path</span> <span class="pre">Layer</span></code> will be added to the <span class="guilabel">Layers</span> panel. You will see that although the destination point <em>(OBJECTID = 9)</em> visually is closed to the origin point, the actual distance is longer when compared to the destination point <em>(OBJECTID = 3)</em>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/1814.png" class="align-center" src="../../_images/1814.png" />
</div></blockquote>
<ol class="arabic simple" start="19">
<li><p>Note that even though the lines connecting the origin and destination is a straight-line, the destination was found using the distance along with the network. It will be much useful visualization to show the actual shortest-path between each origin-destination. As of now, there is no easy way to generate the shortest-path between multiple origin-destination pairs the way we generated the distance matrix. But I will demonstrate a way to use some python scripting to generate this visualization. First, let’s run the shortest path algorithm on 1 pair. Locate the <span class="menuselection">QNEAT3 ‣ Routing ‣ Shortest path (point to point)</span> algorithm and launch it.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/1912.png" class="align-center" src="../../_images/1912.png" />
</div></blockquote>
<ol class="arabic simple" start="20">
<li><p>In the <span class="guilabel">Shortest Path (Point to Point)</span> dialog, select <code class="docutils literal notranslate"><span class="pre">Roadway_Block</span></code> as the <span class="guilabel">Network Layer</span>. Keep the <span class="guilabel">Optimization criteria</span> as Shortest Path (distance optimization). Next we need to pick a start and end point. You can click the <span class="guilabel">…</span> button next to <span class="guilabel">Start point</span> and click on the origin point in the canvas. Similarly select the destination point as the <span class="guilabel">End point</span>. Expand the <span class="guilabel">Advanced parameter</span> section. Choose <code class="docutils literal notranslate"><span class="pre">SUMMARYDIR</span></code> as the <span class="guilabel">Direction field</span>. Enter <code class="docutils literal notranslate"><span class="pre">OB</span></code> as the <span class="guilabel">Value for forward direction</span> and <code class="docutils literal notranslate"><span class="pre">IB</span></code> as the <span class="guilabel">Value for backward direction</span>. In <span class="guilabel">Topology tolerance</span> enter <code class="docutils literal notranslate"><span class="pre">0.000015</span></code>. Keep other options to their default values and click <span class="guilabel">Run</span>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/2012.png" class="align-center" src="../../_images/2012.png" />
</div></blockquote>
<ol class="arabic simple" start="21">
<li><p>A new layer <code class="docutils literal notranslate"><span class="pre">Shortest</span> <span class="pre">Path</span></code> Layer will be added to the <span class="guilabel">Layers</span> panel. You will see that this path follows the network rather than connecting the origin and destination with a straight line. The reason we ran the algorithm on 1 pair is to easily identify the parameter values that we can use in our script. Select <code class="docutils literal notranslate"><span class="pre">Shortest</span> <span class="pre">Path</span> <span class="pre">layer</span></code>, right-click and select <span class="guilabel">Remove Layer</span>. Click the <span class="guilabel">History</span> button in the <span class="guilabel">Processing Toolbox</span>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/2115.png" class="align-center" src="../../_images/2115.png" />
</div></blockquote>
<ol class="arabic simple" start="22">
<li><p>In the <span class="guilabel">History</span> dialog, Select the latest command(command used for Shortest path). This command displays all the parameters and their values that we used. We can now take these values and put them in a script that can allow us to run this command on many origin-destination pairs. Click <span class="guilabel">Close</span>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/2214.png" class="align-center" src="../../_images/2214.png" />
</div></blockquote>
<ol class="arabic simple" start="23">
<li><p>In the <span class="guilabel">Processing Toolbox</span>, click the <span class="guilabel">scripts</span> button and select <span class="guilabel">Create New script</span>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/2313.png" class="align-center" src="../../_images/2313.png" />
</div></blockquote>
<ol class="arabic simple" start="24">
<li><p>In the <span class="guilabel">Processing Script Editor</span>, copy/paste the below code. Save the file as <code class="docutils literal notranslate"><span class="pre">get_routes_from_matrix.py</span></code>. Now close the <span class="guilabel">Processing Script Editor</span>. If you are using a different dataset than the one used in this tutorial, you will have to update the script with the parameter values from step 22.</p></li>
</ol>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">processing</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtCore</span> <span class="kn">import</span> <span class="n">QCoreApplication</span>
<span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="p">(</span><span class="n">QgsProcessing</span><span class="p">,</span> <span class="n">QgsProcessingAlgorithm</span><span class="p">,</span> 
    <span class="n">QgsProcessingParameterFeatureSource</span><span class="p">,</span> <span class="n">QgsProcessingParameterFeatureSink</span><span class="p">,</span>
    <span class="n">QgsFeatureSink</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MatrixToRoutes</span><span class="p">(</span><span class="n">QgsProcessingAlgorithm</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creats Routes from Distance Matrix&quot;&quot;&quot;</span>
    <span class="n">NETWORK</span> <span class="o">=</span> <span class="s1">&#39;NETWORK&#39;</span>
    <span class="n">MATRIX</span> <span class="o">=</span> <span class="s1">&#39;MATRIX&#39;</span>
    <span class="n">OUTPUT</span> <span class="o">=</span> <span class="s1">&#39;OUTPUT&#39;</span>

    
    <span class="k">def</span> <span class="nf">initAlgorithm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addParameter</span><span class="p">(</span>
            <span class="n">QgsProcessingParameterFeatureSource</span><span class="p">(</span>
                <span class="s1">&#39;NETWORK&#39;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s1">&#39;Network Layer&#39;</span><span class="p">),</span>
                <span class="n">types</span><span class="o">=</span><span class="p">[</span><span class="n">QgsProcessing</span><span class="o">.</span><span class="n">TypeVectorLine</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">addParameter</span><span class="p">(</span>
            <span class="n">QgsProcessingParameterFeatureSource</span><span class="p">(</span>
                <span class="s1">&#39;MATRIX&#39;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s1">&#39;Distance Matrix Layer&#39;</span><span class="p">),</span>
                <span class="n">types</span><span class="o">=</span><span class="p">[</span><span class="n">QgsProcessing</span><span class="o">.</span><span class="n">TypeVectorLine</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>
        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">addParameter</span><span class="p">(</span>
            <span class="n">QgsProcessingParameterFeatureSink</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">OUTPUT</span><span class="p">,</span>
                <span class="s1">&#39;Network Routes&#39;</span><span class="p">,</span>
                <span class="n">QgsProcessing</span><span class="o">.</span><span class="n">TypeVectorLine</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">processAlgorithm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">feedback</span><span class="p">):</span>
        <span class="n">network</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterAsString</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NETWORK</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterAsSource</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">MATRIX</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
        
        <span class="n">sink</span><span class="p">,</span> <span class="n">dest_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterAsSink</span><span class="p">(</span>
            <span class="n">parameters</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">OUTPUT</span><span class="p">,</span>
            <span class="n">context</span><span class="p">,</span>
            <span class="n">matrix</span><span class="o">.</span><span class="n">fields</span><span class="p">(),</span>
            <span class="n">matrix</span><span class="o">.</span><span class="n">wkbType</span><span class="p">(),</span>
            <span class="n">matrix</span><span class="o">.</span><span class="n">sourceCrs</span><span class="p">()</span>
            <span class="p">)</span>
        
        <span class="c1"># Compute the number of steps to display within the progress bar and</span>
        <span class="c1"># get features from source</span>
        <span class="n">total</span> <span class="o">=</span> <span class="mf">100.0</span> <span class="o">/</span> <span class="n">matrix</span><span class="o">.</span><span class="n">featureCount</span><span class="p">()</span> <span class="k">if</span> <span class="n">matrix</span><span class="o">.</span><span class="n">featureCount</span><span class="p">()</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">features</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">()</span>
        
        <span class="n">coordinate_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">current</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
            <span class="c1"># Stop the algorithm if cancel button has been clicked</span>
            <span class="k">if</span> <span class="n">feedback</span><span class="o">.</span><span class="n">isCanceled</span><span class="p">():</span>
                <span class="k">break</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span><span class="o">.</span><span class="n">asPolyline</span><span class="p">()</span>
            <span class="n">origin_coords</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">y</span><span class="p">()</span>
            <span class="n">destination_coords</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">y</span><span class="p">()</span>

            <span class="n">feedback</span><span class="o">.</span><span class="n">setProgress</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">current</span> <span class="o">*</span> <span class="n">total</span><span class="p">))</span>

            <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;INPUT&#39;</span><span class="p">:</span><span class="n">network</span><span class="p">,</span>
            <span class="s1">&#39;START_POINT&#39;</span><span class="p">:</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">origin_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">origin_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="s1">&#39;END_POINT&#39;</span><span class="p">:</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">destination_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">destination_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="s1">&#39;STRATEGY&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;ENTRY_COST_CALCULATION_METHOD&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;DIRECTION_FIELD&#39;</span><span class="p">:</span><span class="s1">&#39;SUMMARYDIR&#39;</span><span class="p">,</span>
            <span class="s1">&#39;VALUE_FORWARD&#39;</span><span class="p">:</span><span class="s1">&#39;OB&#39;</span><span class="p">,</span>
            <span class="s1">&#39;VALUE_BACKWARD&#39;</span><span class="p">:</span><span class="s1">&#39;IB&#39;</span><span class="p">,</span>
            <span class="s1">&#39;VALUE_BOTH&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;DEFAULT_DIRECTION&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
            <span class="s1">&#39;SPEED_FIELD&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;DEFAULT_SPEED&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span>
            <span class="s1">&#39;TOLERANCE&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;OUTPUT&#39;</span><span class="p">:</span><span class="s1">&#39;memory:&#39;</span><span class="p">}</span>
            
            <span class="n">route_layer</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;qneat3:shortestpathpointtopoint&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)[</span><span class="s1">&#39;OUTPUT&#39;</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="n">route_layer</span><span class="p">:</span>
                <span class="c1"># We expect only 1 feature in the output, so use next() to get the first item</span>
                <span class="n">route_f</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">route_layer</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">())</span>
                <span class="n">output_geom</span> <span class="o">=</span> <span class="n">route_f</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span>
                <span class="n">f</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">output_geom</span><span class="p">)</span>
                <span class="n">sink</span><span class="o">.</span><span class="n">addFeature</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">QgsFeatureSink</span><span class="o">.</span><span class="n">FastInsert</span><span class="p">)</span>
            <span class="n">feedback</span><span class="o">.</span><span class="n">setProgressText</span><span class="p">(</span><span class="s1">&#39;Processed feature </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">current</span><span class="p">))</span>

  
        <span class="k">return</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">OUTPUT</span><span class="p">:</span> <span class="n">sink</span><span class="p">}</span> 

    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;routes_from_matrix&#39;</span>

    <span class="k">def</span> <span class="nf">displayName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s1">&#39;Get Routes from Matrix&#39;</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">shortHelpString</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s1">&#39;Creates Route Layer from the result of Distance Matrix algorithm&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">group</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">groupId</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">groupId</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">tr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s1">&#39;Processing&#39;</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">createInstance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">MatrixToRoutes</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../../_images/2412.png" class="align-center" src="../../_images/2412.png" />
</div></blockquote>
<ol class="arabic simple" start="25">
<li><p>Now we can test the script. Select a few connections for the layer <code class="docutils literal notranslate"><span class="pre">SQL</span> <span class="pre">Output</span></code> for which you want the actual routes computed. In the <span class="guilabel">Processing Toolbox</span>, a new dropdown <span class="guilabel">Scripts</span> will be added. Click on it and select <code class="docutils literal notranslate"><span class="pre">Get</span> <span class="pre">Routes</span> <span class="pre">from</span> <span class="pre">Matrix</span></code>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/2510.png" class="align-center" src="../../_images/2510.png" />
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Σημείωση</p>
<p>This script needs to compute the network graph for each iteration and thus quite slow. If you have a lot of origin-destination pairs, it can take time.</p>
</div>
<ol class="arabic simple" start="26">
<li><p>In the <span class="guilabel">Network Layer</span> select <code class="docutils literal notranslate"><span class="pre">Roadway_Block</span></code> and in the <span class="guilabel">Distance Matrix layer</span> select <code class="docutils literal notranslate"><span class="pre">SQL</span> <span class="pre">Output</span></code> then check selected features only. Click <span class="guilabel">Run</span>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/269.png" class="align-center" src="../../_images/269.png" />
</div></blockquote>
<ol class="arabic simple" start="27">
<li><p>A new layer <code class="docutils literal notranslate"><span class="pre">Network</span> <span class="pre">Routes</span></code> will be added to the <span class="guilabel">Layers</span> panel. This will contain the actual route to the destination.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/2710.png" class="align-center" src="../../_images/2710.png" />
</div></blockquote>
</section>
</section>





  <div id="disqus_thread"></div>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


    </div>
      
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2021, Ujaval Gandhi.<br/>
      Τελευταία ενημέρωση στις Σεπ 01, 2022.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.0.1.<br/>
    </p>
  </div>
</footer>
<div class="container">
  <p>This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/deed.en_US">Creative Commons Attribution 4.0 International License</a></p>
</div>
<!-- Twitter Button -->
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<!-- Disqus comments widget -->
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'qgistutorials'; // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  }());
</script>

<script type="text/javascript">
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

<!-- Script fpr language switching. Largely adapted from https://github.com/pcav/faunalia-website -->
<script>
    var currentPage = 'docs/3/origin_destination_matrix.html'; // coming from sphinx, always without starting '/'
    var currentLang = 'en';
    $(document).ready(function(){

        var search = new RegExp('\/[a-zA-Z_]{2,8}\/'+ currentPage, 'gi');
        var langPlusPage = window.location.href.match(search);
        // it's possible this is a index.html page called without 'index.html', try without the currentPage
        if (langPlusPage==undefined){
            search = new RegExp('\/[a-zA-Z_]{2,8}\/$', 'gi');
            langPlusPage = window.location.href.match(search);
        }

        // it's possible this is an index.html page called without 'index.html', try removing index.html
        if (langPlusPage==undefined){
            currentPage = currentPage.replace('index.html','')
            search = new RegExp('\/[a-zA-Z_]{2,8}\/'+ currentPage, 'gi');
            langPlusPage = window.location.href.match(search);
        }
        // still no langPlugPage: stop, because the language swicher will misbehave 

        if (langPlusPage == undefined || langPlusPage.length != 1){
            alert('You hit an error, please report back to us.');
            return;
        }
        langPlusPage = langPlusPage[0];
        currentLang = langPlusPage.replace(currentPage, '');

        $("#languages").val(currentLang.replace(/\//g,'')); // currentLang is something like '/nl/'

        $("#languages").change(function() {
            gotoLang($(this).val());
        });

    });

    // load current page in a different language
    function gotoLang(lang){
        var currentUrl = window.location.href;
        var newUrl = currentUrl.replace(currentLang, '/'+lang+'/');
        window.location.href = newUrl;
    }
</script>

  </body>
</html>