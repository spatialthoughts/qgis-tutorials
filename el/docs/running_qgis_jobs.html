<!DOCTYPE html>

<html lang="el">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Running and Scheduling QGIS Processing Jobs &#8212; QGIS Tutorials and Tips</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/translations.js"></script>
    <link rel="search" title="Αναζήτηση" href="../search.html" />
    <link rel="next" title="Web Mapping with QGIS2Web (QGIS3)" href="3/web_mapping_with_qgis2web.html" />
    <link rel="prev" title="Building a Processing Plugin (QGIS3)" href="3/processing_python_plugin.html" />

<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js "></script>


<!-- Cookie Notice -->
<!-- Script from https://github.com/AOEpeople/cookie-notice -->
<script type="text/javascript" src="../_static/cookie.notice.min.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-B1WQ7B80XJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-B1WQ7B80XJ');
</script>


  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><span><img src="../_static/logo.png"></span>
          QGIS Tutorials and Tips</a>
        <span class="navbar-text navbar-version pull-left"><b>v1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Tutorials List <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Εισαγωγή</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/making_a_map.html">Φτιάχνοντας ένα χάρτη (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/working_with_attributes.html">Working with Attributes (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/importing_spreadsheets_csv.html">Importing Spreadsheets or CSV files (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/basic_vector_styling.html">Basic Vector Styling (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/calculating_line_lengths.html">Calculating Line Lengths and Statistics (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/raster_styling_and_analysis.html">Basic Raster Styling and Analysis (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/raster_mosaicing_and_clipping.html">Raster Mosaicing and Clipping (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/working_with_terrain.html">Working with Terrain Data (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/working_with_wms.html">Working with WMS Data (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/working_with_projections.html">Working with Projections (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/georeferencing_basics.html">Georeferencing Topo Sheets and Scanned Maps (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/advanced_georeferencing.html">Georeferencing Aerial Imagery (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/digitizing_basics.html">Digitizing Map Data (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/performing_table_joins.html">Performing Table Joins (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/performing_spatial_joins.html">Performing Spatial Joins (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/performing_spatial_queries.html">Performing Spatial Queries (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/nearest_neighbor_analysis.html">Nearest Neighbor Analysis (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/sampling_raster_data.html">Sampling Raster Data using Points or Polygons (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/calculating_raster_area.html">Calculating Raster Area (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/creating_heatmaps.html">Creating Heatmaps (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/animating_time_series.html">Animating Time Series Data (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/handling_invalid_geometries.html">Handling Invalid Geometries (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/advanced_raster_analysis.html">Advanced Raster Analysis (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/interpolating_point_data.html">Interpolating Point Data (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/calculating_intersection_density.html">Calculating Street Intersection Density (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/batch_processing.html">Batch Processing using Processing Framework (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/processing_graphical_modeler.html">Automating Complex Workflows using Processing Modeler (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/automating_map_creation.html">Automating Map Creation with Print Layout Atlas (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/multi_criteria_overlay.html">Multi Criteria Overlay Analysis (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/basic_network_analysis.html">Basic Network Visualization and Routing (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/origin_destination_matrix.html">Locating Nearest Facility with Origin-Destination Matrix (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/service_area_analysis.html">Service Area Analysis using Openrouteservice (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/travel_time_analysis.html">Travel Time Analysis with Uber Movement (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/areal_mean_rainfall.html">Calculating Areal Mean Rainfall (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/getting_started_with_pyqgis.html">Getting Started With Python Programming (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/processing_algorithms_pyqgis.html">Running Processing Algorithms via Python (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/custom_python_functions.html">Using Custom Python Expression Functions (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/processing_python_scripts.html">Writing Python Scripts for Processing Framework (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/building_a_python_plugin.html">Building a Python Plugin (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/processing_python_plugin.html">Building a Processing Plugin (QGIS3)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Running and Scheduling QGIS Processing Jobs</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/web_mapping_with_qgis2web.html">Web Mapping with QGIS2Web (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="creating_basemaps_with_qtiles.html">Creating Basemaps with QTiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/using_plugins.html">Using Plugins (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="downloading_osm_data.html">Αναζήτηση και Λήψη OpenStreetMap Δεδομένων</a></li>
<li class="toctree-l1"><a class="reference internal" href="learning_resources.html">QGIS Μαθησιακοί πόροι</a></li>
<li class="toctree-l1"><a class="reference internal" href="credits.html">Συντελεστές δεδομένων</a></li>
<li class="toctree-l1"><a class="reference internal" href="batch_processing.html">Batch Processing using Processing Framework (QGIS2)</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="3/processing_python_plugin.html" title="Previous Chapter: Building a Processing Plugin (QGIS3)"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Building a Pr...</span>
    </a>
  </li>
  <li>
    <a href="3/web_mapping_with_qgis2web.html" title="Next Chapter: Web Mapping with QGIS2Web (QGIS3)"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Web Mapping w... &raquo;</span>
    </a>
  </li>
              
            
            

            

            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><h4>Author</h4>
<p>Ujaval Gandhi</p>
<a href="https://twitter.com/intent/follow?screen_name=spatialthoughts" class="twitter-follow-button" data-show-count="false">Follow @spatialthoughts</a>
<hr>
<p>Want to learn QGIS in a structured way? Check out <a href="https://spatialthoughts.com/" target="_blank">Spatial Thoughts</a> for more learning materials and instructor-led online programs with QGIS.org certification.</p>


<h4>Change Language</h4>
<form role="form" class="sidebar-form sidebar-left">
<select id="languages" class="form-control select-mini">
  <option value="en">English</option>
  <option value="zh_TW">Chinese (Taiwan)</option>
  <option value="nl">Dutch</option>
  <option value="fi_FI">Finnish</option>
  <option value="fr">French</option>
  <option value="de">German</option>
  <option value="el">Greek</option>
  <option value="id">Indonesian</option>
  <option value="it">Italian</option>
  <option value="ko">Korean</option>
  <option value="fa">Persian</option>
  <option value="pt_BR">Portuguese</option>
  <option value="ro">Romanian</option>
  <option value="ru">Russian</option>
  <option value="sl">Slovenian</option>
  <option value="es">Spanish</option>
  <option value="th">Thai</option>
  <option value="tr">Turkish</option>
  <option value="uk">Ukrainian</option>
  <option value="vi">Vietnamese</option>
</select>
</form>
        </div>
      </div>
    <div class="body col-md-9 content" role="main">
      

  <section id="running-and-scheduling-qgis-processing-jobs">
<h1>Running and Scheduling QGIS Processing Jobs<a class="headerlink" href="#running-and-scheduling-qgis-processing-jobs" title="Μόνιμος σύνδεσμος σε αυτήν την κεφαλίδα">¶</a></h1>
<p>You can automate a lot of tasks in QGIS using Python scripting (PyQGIS) and the
Processing Framework. Most of the time, you would run these scripts manually
while QGIS is open. While that is helpful, many times you need a way to run
this jobs via the command-line and without needing to open QGIS. Fortunately,
you can write standalone python scripts that use QGIS libraries and can be run
via the command-line. In this tutorial, we will learn how to write and
schedule a job that uses the QGIS Processing framework.</p>
<section id="overview-of-the-task">
<h2>Overview of the task<a class="headerlink" href="#overview-of-the-task" title="Μόνιμος σύνδεσμος σε αυτήν την κεφαλίδα">¶</a></h2>
<p>Let’s say we are working on some analysis using shapefiles of a region. The
shapefiles are updated on a daily basis and we always need the latest file. But
before we can use these files, we need to cleanup the data. We can setup a QGIS
job that automates this process and runs it daily so you have the latest
cleaned up shapefiles for your work. We will write a standalone Python script
that downloads a shapefile and run topological cleaning operations on a daily
basis.</p>
<section id="other-skills-you-will-learn">
<h3>Other skills you will learn<a class="headerlink" href="#other-skills-you-will-learn" title="Μόνιμος σύνδεσμος σε αυτήν την κεφαλίδα">¶</a></h3>
<ul class="simple">
<li><p>Downloading and unzipping files using Python.</p></li>
<li><p>Running any Processing algorithm via PyQGIS.</p></li>
<li><p>Fixing topological errors in a vector layer.</p></li>
</ul>
</section>
</section>
<section id="get-the-data">
<h2>Get the data<a class="headerlink" href="#get-the-data" title="Μόνιμος σύνδεσμος σε αυτήν την κεφαλίδα">¶</a></h2>
<p><a class="reference external" href="http://www.geofabrik.de/">Geofabrik</a> provides daily updated shapefiles of
<a class="reference external" href="http://www.openstreetmap.org/">OpenStreetMap</a> datasets.</p>
<p>We will use <a class="reference external" href="http://download.geofabrik.de/australia-oceania.html">shapefiles for Fiji</a> for this exercise.
Download the <a class="reference external" href="http://download.geofabrik.de/australia-oceania/fiji-latest.shp.zip">fiji-latest.shp.zip</a> and
unzip it to a folder on your disk.</p>
<p>Data Source <a class="reference internal" href="credits.html#geofabrik" id="id1"><span>[GEOFABRIK]</span></a></p>
</section>
<section id="procedure">
<h2>Procedure<a class="headerlink" href="#procedure" title="Μόνιμος σύνδεσμος σε αυτήν την κεφαλίδα">¶</a></h2>
<ol class="arabic simple">
<li><p>We will first run through the process of cleaning the shapefile manually to
note the commands that we will use in the python script. Launch QGIS and go
to <span class="menuselection">Layer ‣ Add Layer ‣ Add Vector Layer</span>.</p></li>
</ol>
<img alt="../_images/1201.png" class="align-center" src="../_images/1201.png" />
<ol class="arabic simple" start="2">
<li><p>Browse to the folder containing the unzipped shapefiles and select the
<code class="docutils literal notranslate"><span class="pre">roads.shp</span></code> file and click <span class="guilabel">Open</span>.</p></li>
</ol>
<img alt="../_images/2164.png" class="align-center" src="../_images/2164.png" />
<ol class="arabic simple" start="3">
<li><p>First we must re-project the roads layer to a Projected CRS. This will allow
us to use <em>meters</em> as units when performing analysis instead of degrees.
Open <span class="menuselection">Processing ‣ Toolbox</span>.</p></li>
</ol>
<img alt="../_images/392.png" class="align-center" src="../_images/392.png" />
<ol class="arabic simple" start="4">
<li><p>Search for the <span class="guilabel">Reproject layer</span> tool. Double-click it to launch
the dialog.</p></li>
</ol>
<img alt="../_images/464.png" class="align-center" src="../_images/464.png" />
<ol class="arabic simple" start="5">
<li><p>In the <span class="guilabel">Reproject layer</span> dialog, select the <code class="docutils literal notranslate"><span class="pre">roads</span></code> layer as
<span class="guilabel">Input layer</span>. We will use <code class="docutils literal notranslate"><span class="pre">EPSG:3460</span> <span class="pre">Fiji</span> <span class="pre">1986</span> <span class="pre">/</span> <span class="pre">Fiji</span> <span class="pre">Map</span> <span class="pre">Grid</span></code>
CRS as the <span class="guilabel">Target CRS</span>. Click <span class="guilabel">Run</span>.</p></li>
</ol>
<img alt="../_images/561.png" class="align-center" src="../_images/561.png" />
<ol class="arabic simple" start="6">
<li><p>Once the process finishes, you will see the reprojected layer loaded in
QGIS. Go to <span class="menuselection">Processing ‣ History and Log..</span>.</p></li>
</ol>
<img alt="../_images/658.png" class="align-center" src="../_images/658.png" />
<ol class="arabic simple" start="7">
<li><p>In the <span class="guilabel">History and Log</span> dialog, expand the <span class="guilabel">Algorithm</span>
folder and select the latest entry. You will see the full processing command
shown in the bottom panel. Note this command for use in our script.</p></li>
</ol>
<img alt="../_images/757.png" class="align-center" src="../_images/757.png" />
<ol class="arabic simple" start="8">
<li><p>Back in the main QGIS Window, click at the <span class="guilabel">CRS</span> button in the
bottom-right corner.</p></li>
</ol>
<img alt="../_images/855.png" class="align-center" src="../_images/855.png" />
<ol class="arabic simple" start="9">
<li><p>In the <span class="guilabel">Project Properties | CRS</span> dialog, check the
<span class="guilabel">Enable on-the-fly CRS transformation</span> and select <code class="docutils literal notranslate"><span class="pre">EPSG:3460</span> <span class="pre">Fiji</span>
<span class="pre">1986</span> <span class="pre">/</span> <span class="pre">Fiji</span> <span class="pre">Map</span> <span class="pre">Grid</span></code> as the CRS. This will ensure that our original and
reprojected layers will line up correctly.</p></li>
</ol>
<img alt="../_images/954.png" class="align-center" src="../_images/954.png" />
<ol class="arabic simple" start="10">
<li><p>Now we will run the cleaning operation. GRASS has a very powerful set of
topological cleaning tools. These are available in QGIS via the <code class="docutils literal notranslate"><span class="pre">v.clean</span></code>
algorithm. Search for this algorithm in the <span class="guilabel">Processing Toolbox</span>
and double-click it to launch the dialog.</p></li>
</ol>
<img alt="../_images/1062.png" class="align-center" src="../_images/1062.png" />
<ol class="arabic simple" start="11">
<li><p>You can read more about various tools and options in the <span class="guilabel">Help</span>
tab. For this tutorial, we will be using the <code class="docutils literal notranslate"><span class="pre">snap</span></code> tool to remove
duplicate vertices that are within 1 meter of each other. Select
<code class="docutils literal notranslate"><span class="pre">Reprojected</span> <span class="pre">layer</span></code> as the <span class="guilabel">Layer to clean</span>. Choose <code class="docutils literal notranslate"><span class="pre">snap</span></code> as
the <span class="guilabel">Cleaning tool</span>.  Enter <code class="docutils literal notranslate"><span class="pre">1.00</span></code> as the
<span class="guilabel">Threshold</span>. Leave the other fields blank and click
<span class="guilabel">Run</span>.</p></li>
</ol>
<img alt="../_images/11101.png" class="align-center" src="../_images/11101.png" />
<ol class="arabic simple" start="12">
<li><p>Once the processing finishes, you will see 2 new layers added to QGIS. The
<code class="docutils literal notranslate"><span class="pre">Cleaned</span> <span class="pre">vector</span> <span class="pre">layer</span></code> is the layer with topological errors corrected.
You will also have a <code class="docutils literal notranslate"><span class="pre">Errors</span> <span class="pre">layer</span></code> which will highlight the features
which were repaired. You can use the errors layer as a guide and zoom in to
see vertices that were removed.</p></li>
</ol>
<img alt="../_images/1263.png" class="align-center" src="../_images/1263.png" />
<ol class="arabic simple" start="13">
<li><p>Go to <span class="menuselection">Processing ‣ History and Log</span> dialog and note the
full processing command for later use.</p></li>
</ol>
<img alt="../_images/1360.png" class="align-center" src="../_images/1360.png" />
<ol class="arabic simple" start="14">
<li><p>We are ready to start coding now. See the <strong>A Text Editor or a Python IDE</strong>
section in the <a class="reference internal" href="building_a_python_plugin.html"><span class="doc">Δημιουργία ενός πρόσθετου στην Python.</span></a> tutorial for instructions to
setup your text editor or IDE. For running standalone python scripts that
use QGIS, we must set various configuration options. A good way to run
standalone scripts is to launch them via a <code class="docutils literal notranslate"><span class="pre">.bat</span></code> file. This file will
first set the correct configuration options and then call the python
script. Create a new file named <code class="docutils literal notranslate"><span class="pre">launch.bat</span></code> and enter the following
text. Change the values according to your QGIS configuration. Don’t forget
to replace the username with your own username in the path to the python
script.  The paths in this file will be the same on your system if you
installed QGIS via the <code class="docutils literal notranslate"><span class="pre">OSGeo4W</span> <span class="pre">Installer</span></code>. Save the file on your
Desktop.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Σημείωση</p>
<p>Linux and Mac users will need to create a shell script to set the paths
and environment variables.</p>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>REM Change OSGEO4W_ROOT to point to the base install folder
SET OSGEO4W_ROOT=C:\OSGeo4W64
SET QGISNAME=qgis
SET QGIS=%OSGEO4W_ROOT%\apps\%QGISNAME%
set QGIS_PREFIX_PATH=%QGIS%
REM Gdal Setup
set GDAL_DATA=%OSGEO4W_ROOT%\share\gdal\
REM Python Setup
set PATH=%OSGEO4W_ROOT%\bin;%QGIS%\bin;%PATH%
SET PYTHONHOME=%OSGEO4W_ROOT%\apps\Python27
set PYTHONPATH=%QGIS%\python;%PYTHONPATH%

REM Launch python job
python c:\Users\Ujaval\Desktop\download_and_clean.py
pause
</pre></div>
</div>
<img alt="../_images/1457.png" class="align-center" src="../_images/1457.png" />
<ol class="arabic simple" start="15">
<li><p>Create a new python file and enter the following code. Name the file as
<code class="docutils literal notranslate"><span class="pre">download_and_clean.py</span></code> and save it on your Desktop.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="o">*</span>
<span class="nb">print</span> <span class="s1">&#39;Hello QGIS!&#39;</span>
</pre></div>
</div>
<img alt="../_images/1554.png" class="align-center" src="../_images/1554.png" />
<ol class="arabic simple" start="16">
<li><p>Switch to your Desktop and locate the <code class="docutils literal notranslate"><span class="pre">launch.bat</span></code> icon. Double-click it
to launch a new command window and run the script. If you see <code class="docutils literal notranslate"><span class="pre">Hello</span>
<span class="pre">QGIS!</span></code> printed in the command window, your configuration and setup worked
fine. If you see errors or do not see the text, check your <code class="docutils literal notranslate"><span class="pre">launch.bat</span></code>
file and make sure all the paths match the locations on your system.</p></li>
</ol>
<img alt="../_images/1651.png" class="align-center" src="../_images/1651.png" />
<ol class="arabic simple" start="17">
<li><p>Back in your text editor, modify the <code class="docutils literal notranslate"><span class="pre">download_and_clean.py</span></code> script to
add the following code. This is the bootstrap code to initialize QGIS.
These are unnecessary if you are running the script within QGIS. But since
we are running it outside QGIS, we need to add these at the beginning. Make
sure you replace the username with your username. After making these
changes, save the file and run <code class="docutils literal notranslate"><span class="pre">launch.bat</span></code> again. If you see <code class="docutils literal notranslate"><span class="pre">Hello</span>
<span class="pre">QGIS!</span></code> printed, you are all set to do add the processing logic to the
script.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># Initialize QGIS Application</span>
<span class="n">QgsApplication</span><span class="o">.</span><span class="n">setPrefixPath</span><span class="p">(</span><span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">OSGeo4W64</span><span class="se">\\</span><span class="s2">apps</span><span class="se">\\</span><span class="s2">qgis&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">QgsApplication</span><span class="p">([],</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">QgsApplication</span><span class="o">.</span><span class="n">initQgis</span><span class="p">()</span>

<span class="c1"># Add the path to Processing framework</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;c:</span><span class="se">\\</span><span class="s1">Users</span><span class="se">\\</span><span class="s1">Ujaval</span><span class="se">\\</span><span class="s1">.qgis2</span><span class="se">\\</span><span class="s1">python</span><span class="se">\\</span><span class="s1">plugins&#39;</span><span class="p">)</span>

<span class="c1"># Import and initialize Processing framework</span>
<span class="kn">from</span> <span class="nn">processing.core.Processing</span> <span class="kn">import</span> <span class="n">Processing</span>
<span class="n">Processing</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="kn">import</span> <span class="nn">processing</span>

<span class="nb">print</span> <span class="s1">&#39;Hello QGIS!&#39;</span>
</pre></div>
</div>
<img alt="../_images/1747.png" class="align-center" src="../_images/1747.png" />
<ol class="arabic simple" start="18">
<li><p>Recall the first processing command that we had saved from the log. This
was the command to re-project a layer. Paste the command to your script and
add the surrounding code as follows. Note that processing commands return
the path to the output layers as a dictionary. We are storing this as the
<code class="docutils literal notranslate"><span class="pre">ret</span></code> value and printing the path to the reprojected layer.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">roads_shp_path</span> <span class="o">=</span> <span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">Users</span><span class="se">\\</span><span class="s2">Ujaval</span><span class="se">\\</span><span class="s2">Downloads</span><span class="se">\\</span><span class="s2">fiji-latest.shp</span><span class="se">\\</span><span class="s2">roads.shp&quot;</span>
<span class="n">ret</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">runalg</span><span class="p">(</span><span class="s1">&#39;qgis:reprojectlayer&#39;</span><span class="p">,</span> <span class="n">roads_shp_path</span><span class="p">,</span> <span class="s1">&#39;EPSG:3460&#39;</span><span class="p">,</span>
<span class="kc">None</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;OUTPUT&#39;</span><span class="p">]</span>
<span class="nb">print</span> <span class="n">output</span>
</pre></div>
</div>
<img alt="../_images/1845.png" class="align-center" src="../_images/1845.png" />
<ol class="arabic simple" start="19">
<li><p>Run the script via <code class="docutils literal notranslate"><span class="pre">launch.bat</span></code> and you will see the path to the newly
created reprojected layer.</p></li>
</ol>
<img alt="../_images/1937.png" class="align-center" src="../_images/1937.png" />
<ol class="arabic simple" start="20">
<li><p>Now add the code for cleaning the topology. Since this is our final output,
we will add the output file paths as the last 2 arguments for the
<code class="docutils literal notranslate"><span class="pre">grass.v.clean</span></code> algorithm. If you left these blank, the output will be
created in a temporary directory.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">processing</span><span class="o">.</span><span class="n">runalg</span><span class="p">(</span><span class="s2">&quot;grass:v.clean&quot;</span><span class="p">,</span>
                  <span class="n">output</span><span class="p">,</span>
                  <span class="mi">1</span><span class="p">,</span>
                  <span class="mi">1</span><span class="p">,</span>
                  <span class="kc">None</span><span class="p">,</span>
                  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                  <span class="mf">0.0001</span><span class="p">,</span>
                  <span class="s1">&#39;C:</span><span class="se">\\</span><span class="s1">Users</span><span class="se">\\</span><span class="s1">Ujaval</span><span class="se">\\</span><span class="s1">Desktop</span><span class="se">\\</span><span class="s1">clean.shp&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;C:\Users</span><span class="se">\\</span><span class="s1">Ujaval</span><span class="se">\\</span><span class="s1">Desktop</span><span class="se">\\</span><span class="s1">errors.shp&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/2032.png" class="align-center" src="../_images/2032.png" />
<ol class="arabic simple" start="21">
<li><p>Run the script and you will see 2 new shapefiles created on your Desktop.
This completes the processing part of the script. Let’s add the code to
download the data from the original website and unzip it automatically. We
will also store the path to the unzipped file in a variable that we can
pass to the processing algorithm later. We will need to import some
additional modules for doing this. (See the end of the tutorial for the
full script with all the changes)</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">urllib</span>
<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">import</span> <span class="nn">tempfile</span>

<span class="n">temp_dir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>
<span class="n">download_url</span> <span class="o">=</span> <span class="s1">&#39;http://download.geofabrik.de/australia-oceania/fiji-latest.shp.zip&#39;</span>
<span class="nb">print</span> <span class="s1">&#39;Downloading file&#39;</span>
<span class="nb">zip</span><span class="p">,</span> <span class="n">headers</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">download_url</span><span class="p">)</span>
<span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="nb">zip</span><span class="p">)</span> <span class="k">as</span> <span class="n">zf</span><span class="p">:</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">zf</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;roads&#39;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">zf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">filename</span> <span class="o">==</span> <span class="s1">&#39;roads.shp&#39;</span><span class="p">:</span>
                <span class="n">roads_shp_path</span> <span class="o">=</span> <span class="n">file_path</span>
</pre></div>
</div>
<img alt="../_images/2165.png" class="align-center" src="../_images/2165.png" />
<ol class="arabic simple" start="22">
<li><p>Run the completed script. Everytime you run the script, a fresh copy of the
data will be downloaded and processed.</p></li>
</ol>
<img alt="../_images/2231.png" class="align-center" src="../_images/2231.png" />
<ol class="arabic simple" start="23">
<li><p>To automate running on this script on a daily basis, we can use the <code class="docutils literal notranslate"><span class="pre">Task</span>
<span class="pre">Scheduler</span></code> in Windows. Launch the Task Scheduler and click
<span class="guilabel">Create Basic Task</span>.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Σημείωση</p>
<p>Linux and Mac users can use cron jobs to schedule  tasks.</p>
</div>
<img alt="../_images/2329.png" class="align-center" src="../_images/2329.png" />
<ol class="arabic simple" start="24">
<li><p>Name the task as <code class="docutils literal notranslate"><span class="pre">Daily</span> <span class="pre">Download</span> <span class="pre">and</span> <span class="pre">Cleanup</span></code> and click <span class="guilabel">Next</span>.</p></li>
</ol>
<img alt="../_images/2428.png" class="align-center" src="../_images/2428.png" />
<ol class="arabic simple" start="25">
<li><p>Select <code class="docutils literal notranslate"><span class="pre">Daily</span></code> as the <span class="guilabel">Trigger</span> and click <span class="guilabel">Next</span></p></li>
</ol>
<img alt="../_images/2524.png" class="align-center" src="../_images/2524.png" />
<ol class="arabic simple" start="26">
<li><p>Select a time as per your liking and click <span class="guilabel">Next</span>.</p></li>
</ol>
<img alt="../_images/2622.png" class="align-center" src="../_images/2622.png" />
<ol class="arabic simple" start="27">
<li><p>Choose <code class="docutils literal notranslate"><span class="pre">Start</span> <span class="pre">a</span> <span class="pre">program</span></code> as the <span class="guilabel">Action</span> and click
<span class="guilabel">Next</span>.</p></li>
</ol>
<img alt="../_images/2722.png" class="align-center" src="../_images/2722.png" />
<ol class="arabic simple" start="28">
<li><p>Click <span class="guilabel">Browse</span> and locate the <code class="docutils literal notranslate"><span class="pre">launch.bat</span></code> script. Click
<span class="guilabel">Next</span>.</p></li>
</ol>
<img alt="../_images/2820.png" class="align-center" src="../_images/2820.png" />
<ol class="arabic simple" start="29">
<li><p>Click <span class="guilabel">Finish</span> at the last screen to schedule the task. Now the
script will automatically launch at the specified time to give you a fresh
copy of cleaned data everyday.</p></li>
</ol>
<img alt="../_images/2917.png" class="align-center" src="../_images/2917.png" />
<p>Below is the full <code class="docutils literal notranslate"><span class="pre">download_and_clean.py</span></code> script for your reference.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">urllib</span>
<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">import</span> <span class="nn">tempfile</span>

<span class="c1"># Initialize QGIS Application</span>
<span class="n">QgsApplication</span><span class="o">.</span><span class="n">setPrefixPath</span><span class="p">(</span><span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">OSGeo4W64</span><span class="se">\\</span><span class="s2">apps</span><span class="se">\\</span><span class="s2">qgis&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">QgsApplication</span><span class="p">([],</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">QgsApplication</span><span class="o">.</span><span class="n">initQgis</span><span class="p">()</span>

<span class="c1"># Add the path to Processing framework  </span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;c:</span><span class="se">\\</span><span class="s1">Users</span><span class="se">\\</span><span class="s1">Ujaval</span><span class="se">\\</span><span class="s1">.qgis2</span><span class="se">\\</span><span class="s1">python</span><span class="se">\\</span><span class="s1">plugins&#39;</span><span class="p">)</span>

<span class="c1"># Import and initialize Processing framework</span>
<span class="kn">from</span> <span class="nn">processing.core.Processing</span> <span class="kn">import</span> <span class="n">Processing</span>
<span class="n">Processing</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="kn">import</span> <span class="nn">processing</span>

<span class="c1"># Download and unzip the latest shapefile</span>
<span class="n">temp_dir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>
<span class="n">download_url</span> <span class="o">=</span> <span class="s1">&#39;http://download.geofabrik.de/australia-oceania/fiji-latest.shp.zip&#39;</span>
<span class="nb">print</span> <span class="s1">&#39;Downloading file&#39;</span>
<span class="nb">zip</span><span class="p">,</span> <span class="n">headers</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">download_url</span><span class="p">)</span>
<span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="nb">zip</span><span class="p">)</span> <span class="k">as</span> <span class="n">zf</span><span class="p">:</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">zf</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;roads&#39;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">zf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">filename</span> <span class="o">==</span> <span class="s1">&#39;roads.shp&#39;</span><span class="p">:</span>
                <span class="n">roads_shp_path</span> <span class="o">=</span> <span class="n">file_path</span>

<span class="nb">print</span> <span class="s1">&#39;Downloaded file to </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">roads_shp_path</span>

<span class="c1"># Reproject the Roads layer</span>
<span class="nb">print</span> <span class="s1">&#39;Reprojecting the roads layer&#39;</span>

<span class="n">ret</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">runalg</span><span class="p">(</span><span class="s1">&#39;qgis:reprojectlayer&#39;</span><span class="p">,</span> <span class="n">roads_shp_path</span><span class="p">,</span> <span class="s1">&#39;EPSG:3460&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;OUTPUT&#39;</span><span class="p">]</span>

<span class="c1"># Clean the Roads layer</span>
<span class="nb">print</span> <span class="s1">&#39;Cleaning the roads layer&#39;</span>

<span class="n">processing</span><span class="o">.</span><span class="n">runalg</span><span class="p">(</span><span class="s2">&quot;grass:v.clean&quot;</span><span class="p">,</span>
                  <span class="n">output</span><span class="p">,</span>
                  <span class="mi">1</span><span class="p">,</span>
                  <span class="mi">1</span><span class="p">,</span>
                  <span class="kc">None</span><span class="p">,</span>
                  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                  <span class="mf">0.0001</span><span class="p">,</span>
                  <span class="s1">&#39;C:</span><span class="se">\\</span><span class="s1">Users</span><span class="se">\\</span><span class="s1">Ujaval</span><span class="se">\\</span><span class="s1">Desktop</span><span class="se">\\</span><span class="s1">clean.shp&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;C:\Users</span><span class="se">\\</span><span class="s1">Ujaval</span><span class="se">\\</span><span class="s1">Desktop</span><span class="se">\\</span><span class="s1">errors.shp&#39;</span><span class="p">)</span>
<span class="nb">print</span> <span class="s1">&#39;Success&#39;</span>
</pre></div>
</div>
</section>
</section>





  <div id="disqus_thread"></div>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


    </div>
      
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2021, Ujaval Gandhi.<br/>
      Τελευταία ενημέρωση στις Σεπ 03, 2022.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.0.1.<br/>
    </p>
  </div>
</footer>
<div class="container">
  <p>This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/deed.en_US">Creative Commons Attribution 4.0 International License</a></p>
</div>
<!-- Twitter Button -->
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<!-- Disqus comments widget -->
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'qgistutorials'; // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  }());
</script>

<script type="text/javascript">
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

<!-- Script fpr language switching. Largely adapted from https://github.com/pcav/faunalia-website -->
<script>
    var currentPage = 'docs/running_qgis_jobs.html'; // coming from sphinx, always without starting '/'
    var currentLang = 'en';
    $(document).ready(function(){

        var search = new RegExp('\/[a-zA-Z_]{2,8}\/'+ currentPage, 'gi');
        var langPlusPage = window.location.href.match(search);
        // it's possible this is a index.html page called without 'index.html', try without the currentPage
        if (langPlusPage==undefined){
            search = new RegExp('\/[a-zA-Z_]{2,8}\/$', 'gi');
            langPlusPage = window.location.href.match(search);
        }

        // it's possible this is an index.html page called without 'index.html', try removing index.html
        if (langPlusPage==undefined){
            currentPage = currentPage.replace('index.html','')
            search = new RegExp('\/[a-zA-Z_]{2,8}\/'+ currentPage, 'gi');
            langPlusPage = window.location.href.match(search);
        }
        // still no langPlugPage: stop, because the language swicher will misbehave 

        if (langPlusPage == undefined || langPlusPage.length != 1){
            alert('You hit an error, please report back to us.');
            return;
        }
        langPlusPage = langPlusPage[0];
        currentLang = langPlusPage.replace(currentPage, '');

        $("#languages").val(currentLang.replace(/\//g,'')); // currentLang is something like '/nl/'

        $("#languages").change(function() {
            gotoLang($(this).val());
        });

    });

    // load current page in a different language
    function gotoLang(lang){
        var currentUrl = window.location.href;
        var newUrl = currentUrl.replace(currentLang, '/'+lang+'/');
        window.location.href = newUrl;
    }
</script>

  </body>
</html>