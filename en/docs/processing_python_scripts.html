<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Writing Python Scripts for Processing Framework &#8212; QGIS Tutorials and Tips</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=0bf093e7" />
    <script src="../_static/documentation_options.js?v=29a6c3e3"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="search" title="Search" href="../search.html" />

<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>


<!-- Cookie Notice -->
<!-- Script from https://github.com/AOEpeople/cookie-notice -->
<script type="text/javascript" src="../_static/cookie.notice.min.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-B1WQ7B80XJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-B1WQ7B80XJ');
</script>


  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          QGIS Tutorials and Tips</a>
        <span class="navbar-text navbar-version pull-left"><b>v1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Tutorials List <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/making_a_map.html">Making a Map (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/working_with_attributes.html">Working with Attributes (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/importing_spreadsheets_csv.html">Importing Spreadsheets or CSV files (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/basic_vector_styling.html">Basic Vector Styling (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/calculating_line_lengths.html">Calculating Line Lengths and Statistics (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/raster_styling_and_analysis.html">Basic Raster Styling and Analysis (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/raster_mosaicing_and_clipping.html">Raster Mosaicing and Clipping (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/working_with_terrain.html">Working with Terrain Data (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/working_with_wms.html">Working with WMS Data (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/working_with_projections.html">Working with Projections (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/georeferencing_basics.html">Georeferencing Topo Sheets and Scanned Maps (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/advanced_georeferencing.html">Georeferencing Aerial Imagery (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/digitizing_basics.html">Digitizing Map Data (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/performing_table_joins.html">Performing Table Joins (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/performing_spatial_joins.html">Performing Spatial Joins (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/performing_spatial_queries.html">Performing Spatial Queries (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/nearest_neighbor_analysis.html">Nearest Neighbor Analysis (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/sampling_raster_data.html">Sampling Raster Data using Points or Polygons (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/calculating_raster_area.html">Calculating Raster Area (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/creating_heatmaps.html">Creating Heatmaps (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/animating_time_series.html">Animating Time Series Data (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/handling_invalid_geometries.html">Handling Invalid Geometries (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/advanced_raster_analysis.html">Advanced Raster Analysis (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/interpolating_point_data.html">Interpolating Point Data (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/batch_processing.html">Batch Processing using Processing Framework (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/processing_graphical_modeler.html">Automating Complex Workflows using Processing Modeler (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/automating_map_creation.html">Automating Map Creation with Print Layout Atlas (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/multi_criteria_overlay.html">Multi Criteria Overlay Analysis (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/vector_styling_expressions.html">Basic Filtering and Styling with Expressions (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/basic_network_analysis.html">Basic Network Visualization and Routing (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/origin_destination_matrix.html">Locating Nearest Facility with Origin-Destination Matrix (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/service_area_analysis.html">Service Area Analysis using Openrouteservice (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/travel_time_analysis.html">Travel Time Analysis with Uber Movement (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/areal_mean_rainfall.html">Calculating Areal Mean Rainfall (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/colorized_river_basin_map.html">Creating a Colorized River Basin Map (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/creating_landuse_map.html">Creating a Landuse Map (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/calculating_intersection_density.html">Calculating Street Intersection Density (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/landuse_buffer.html">Determining Landuse Buffer Zones (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/solidwaste_mapping.html">Mapping Waste Disposal Volumes (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/getting_started_with_pyqgis.html">Getting Started With Python Programming (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/processing_algorithms_pyqgis.html">Running Processing Algorithms via Python (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/custom_python_functions.html">Using Custom Python Expression Functions (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/processing_python_scripts.html">Writing Python Scripts for Processing Framework (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/building_a_python_plugin.html">Building a Python Plugin (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/processing_python_plugin.html">Building a Processing Plugin (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="running_qgis_jobs.html">Running and Scheduling QGIS Processing Jobs</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/web_mapping_with_qgis2web.html">Web Mapping with QGIS2Web (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="creating_basemaps_with_qtiles.html">Creating Basemaps with QTiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/using_plugins.html">Using Plugins (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="downloading_osm_data.html">Searching and Downloading OpenStreetMap Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="learning_resources.html">QGIS Learning Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="credits.html">Data Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="batch_processing.html">Batch Processing using Processing Framework (QGIS2)</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            

            

            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><h4>Author</h4>
<p>Ujaval Gandhi</p>
<a href="https://twitter.com/intent/follow?screen_name=spatialthoughts" class="twitter-follow-button" data-show-count="false">Follow @spatialthoughts</a>
<hr>
<p>Want to learn QGIS in a structured way? Check out <a href="https://spatialthoughts.com/" target="_blank">Spatial Thoughts</a> for more learning materials and instructor-led online programs with QGIS.org certification.</p>

<hr>
<p>These tutorials are also available in many other languages. Please see <a href="https://www.qgistutorials.com/en/docs/introduction.html#translations" target="_blank">translations</a> page.
</p>
        </div>
      </div>
    <div class="body col-md-9 content" role="main">
      

  <section id="writing-python-scripts-for-processing-framework">
<h1>Writing Python Scripts for Processing Framework<a class="headerlink" href="#writing-python-scripts-for-processing-framework" title="Link to this heading">¶</a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>A new version of this tutorial is available at <a class="reference internal" href="3/processing_python_scripts.html"><span class="doc">Writing Python Scripts for Processing Framework (QGIS3)</span></a></p>
</div>
<p>One can write standalone pyqgis scripts that can be run via the Python Console
in QGIS. With a few tweaks, you can make your standalone scripts run via the
Processing Framework. This has several advantages. First, taking user input and
writing output files is far easier because Processing Framework offers standardized
user interface for these. Second, having your script in the Processing Toolbox also
allows it to be part of any Processing Model or be run as a Batch job with
multiple inputs. This tutorial will show how to write a custom python script
that can be part of the Processing Framework in QGIS.</p>
<section id="overview-of-the-task">
<h2>Overview of the task<a class="headerlink" href="#overview-of-the-task" title="Link to this heading">¶</a></h2>
<p>Our script will perform a dissolve operation based on a field chosen by the
user. It will also sum up values of another field for the dissolved features.
In the example, we will dissolve a World shapefile based on a <code class="docutils literal notranslate"><span class="pre">SUBREGION</span></code>
attribute and sum up <code class="docutils literal notranslate"><span class="pre">POP_EST</span></code> field to calculate total population in the
dissolved region.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are looking to do a Dissolve operation along with Statistics, you can
use the excellent <code class="docutils literal notranslate"><span class="pre">DissolveWithStats</span></code> plugin. This script is a
demonstration how to implement similar functionality via a Processing
script.</p>
</div>
</section>
<section id="get-the-data">
<h2>Get the data<a class="headerlink" href="#get-the-data" title="Link to this heading">¶</a></h2>
<p>We will use the <a class="reference external" href="http://www.naturalearthdata.com/downloads/10m-cultural-vectors/10m-admin-0-countries/">Admin 0 - Countries</a>
dataset from Natural Earth.</p>
<p>Download the <a class="reference external" href="http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/cultural/ne_10m_admin_0_countries.zip">Admin 0 - countries shapefile.</a>.</p>
<p>Data Source <a class="reference internal" href="credits.html#naturalearth" id="id1"><span>[NATURALEARTH]</span></a></p>
<p>For convenience, you may directly download a copy of the dataset from the links
below:</p>
<p><a class="reference external" href="http://www.qgistutorials.com/downloads/ne_10m_admin_0_countries.zip">ne_10_admin_0_countries.zip</a></p>
</section>
<section id="procedure">
<h2>Procedure<a class="headerlink" href="#procedure" title="Link to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>Open QGIS and go to <span class="menuselection">Layers ‣ Add Vector ‣ Add Vector
Layer</span>. Browse to the downloaded <code class="docutils literal notranslate"><span class="pre">ne_10_admin_0_countries.zip</span></code> file and
load the <code class="docutils literal notranslate"><span class="pre">ne_10_admin_0_countries</span></code> layer. Go to <span class="menuselection">Processing
‣ Toolbox</span>.</p></li>
</ol>
<img alt="../_images/1203.png" class="align-center" src="../_images/1203.png" />
<ol class="arabic simple" start="2">
<li><p>Expand the <span class="guilabel">Scripts</span> group in the <span class="guilabel">Processing Toolbox</span>
and select <span class="guilabel">Create a new script</span>.</p></li>
</ol>
<img alt="../_images/2168.png" class="align-center" src="../_images/2168.png" />
<ol class="arabic simple" start="3">
<li><p>For a python script to be recognized as a Processing script, the beginning
of the script must be the specifications of the input and outputs. This will
be used to construct the user interface to run the script. You can learn
more about the format of these lines from <a class="reference external" href="https://docs.qgis.org/2.8/en/docs/user_manual/processing/scripts.html">QGIS Processing Documentation</a>.
Enter the following lines in the <span class="guilabel">Script editor</span>. Here we are
specifying 3 user inputs: <code class="docutils literal notranslate"><span class="pre">dissolve_layer</span></code>, <code class="docutils literal notranslate"><span class="pre">dissolve_field</span></code> and
<code class="docutils literal notranslate"><span class="pre">sum_field</span></code>. Note that we are adding <code class="docutils literal notranslate"><span class="pre">dissolve_layer</span></code> after both the
field input definitions. This means that input will be pre-populated with
choice of fields from the <code class="docutils literal notranslate"><span class="pre">dissolve_layer</span></code>. We also specify the
<code class="docutils literal notranslate"><span class="pre">output_layer</span></code> as the output vector layer. Click <span class="guilabel">Save</span> button.</p></li>
</ol>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>##dissolve_layer=vector
##dissolve_field=field dissolve_layer
##sum_field=field dissolve_layer
##output_layer=output vector
</pre></div>
</div>
<img alt="../_images/3107.png" class="align-center" src="../_images/3107.png" />
<ol class="arabic simple" start="4">
<li><p>Name the script <code class="docutils literal notranslate"><span class="pre">dissolve_with_sum</span></code> and save it at the default location
under <span class="menuselection">.qgis2 ‣ processing ‣ scripts</span> folder.</p></li>
</ol>
<img alt="../_images/469.png" class="align-center" src="../_images/469.png" />
<ol class="arabic simple" start="5">
<li><p>Back in the <span class="guilabel">Script editor</span>, click <span class="guilabel">Run algorithm</span>
button to preview the user interface.</p></li>
</ol>
<img alt="../_images/563.png" class="align-center" src="../_images/563.png" />
<ol class="arabic simple" start="6">
<li><p>You can see that just by adding a few lines, we have a nice user interface
for the user to specify the inputs. It is also consistent with all other
Processing algorithms, so there is no learning curve involved in using your
custom algorithm.</p></li>
</ol>
<img alt="../_images/660.png" class="align-center" src="../_images/660.png" />
<ol class="arabic simple" start="7">
<li><p>In the <span class="guilabel">Script editor</span>, enter the following code. You will notice
that we are using some special methods such as <code class="docutils literal notranslate"><span class="pre">processing.getObject()</span></code>
and <code class="docutils literal notranslate"><span class="pre">processing.features()</span></code>. These are convenience wrappers that make it
easy to work with data. You can learn more about these from <a class="reference external" href="https://docs.qgis.org/2.8/en/docs/user_manual/processing/console.html#additional-functions-for-handling-data">Additional
functions for handling data</a>
section of QGIS Processing Documentation. Click <span class="guilabel">Save</span> to save the
newly entered code and then the <span class="guilabel">X</span> button to close the editor.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This script uses python list comprehensions extensively. Take a look at this
<a class="reference external" href="https://docs.python.org/2/tutorial/datastructures.html#list-comprehensions">list comprehension tutorial</a>
to get familiar with the syntax.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">PyQt4.QtCore</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">inlayer</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">getObject</span><span class="p">(</span><span class="n">dissolve_layer</span><span class="p">)</span>
<span class="n">dissolve_field_index</span> <span class="o">=</span> <span class="n">inlayer</span><span class="o">.</span><span class="n">fieldNameIndex</span><span class="p">(</span><span class="n">dissolve_field</span><span class="p">)</span>
<span class="n">sum_field_index</span> <span class="o">=</span> <span class="n">inlayer</span><span class="o">.</span><span class="n">fieldNameIndex</span><span class="p">(</span><span class="n">sum_field</span><span class="p">)</span>

<span class="c1"># Find unique values present in the dissolve field</span>
<span class="n">unique_values</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">f</span><span class="p">[</span><span class="n">dissolve_field</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span>
<span class="n">processing</span><span class="o">.</span><span class="n">features</span><span class="p">(</span><span class="n">inlayer</span><span class="p">)])</span>

<span class="nb">print</span> <span class="n">unique_values</span>
</pre></div>
</div>
<img alt="../_images/759.png" class="align-center" src="../_images/759.png" />
<ol class="arabic simple" start="8">
<li><p>While writing code, it is important to be able to see errors and debug your
code. Your processing scripts can be debugged easily via the built-in Python
Console. In the main QGIS window, go to <span class="menuselection">Plugins ‣ Python
Console</span>. Once the console is open, find your script in the
<span class="guilabel">Processing Toolbox</span> and double-click it to launch it.</p></li>
</ol>
<img alt="../_images/857.png" class="align-center" src="../_images/857.png" />
<ol class="arabic simple" start="9">
<li><p>Select <code class="docutils literal notranslate"><span class="pre">SUBREGION</span></code> as the <span class="guilabel">dissolve field</span>. You may choose any
field as the <span class="guilabel">sum field</span> as the script doesn’t have any code yet
to deal with it. Click <span class="guilabel">Run</span>.</p></li>
</ol>
<img alt="../_images/956.png" class="align-center" src="../_images/956.png" />
<ol class="arabic simple" start="10">
<li><p>You will see an error dialog. This is expected since the script is
incomplete and doesn’t generate any output yet.</p></li>
</ol>
<img alt="../_images/1064.png" class="align-center" src="../_images/1064.png" />
<ol class="arabic simple" start="11">
<li><p>In the main QGIS windows, you will see the debug output from the script
printed in the console. This is useful way to add print statements and see
intermediate variable values.</p></li>
</ol>
<img alt="../_images/11103.png" class="align-center" src="../_images/11103.png" />
<ol class="arabic simple" start="12">
<li><p>Let’s go back to editing the script by right-clicking the script and select
<span class="guilabel">Edit script</span>.</p></li>
</ol>
<img alt="../_images/1265.png" class="align-center" src="../_images/1265.png" />
<ol class="arabic simple" start="13">
<li><p>Enter the following code to complete the script. Note that we are using the
existing dissolve algorithm in QGIS via processing using
<code class="docutils literal notranslate"><span class="pre">processing.runalg()</span></code> method.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a dictionary to hold values from the sum field</span>
<span class="n">sum_unique_values</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">attrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">attributes</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">processing</span><span class="o">.</span><span class="n">features</span><span class="p">(</span><span class="n">inlayer</span><span class="p">)]</span>

<span class="k">for</span> <span class="n">unique_value</span> <span class="ow">in</span> <span class="n">unique_values</span><span class="p">:</span>
    <span class="n">val_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">f_attr</span><span class="p">[</span><span class="n">sum_field_index</span><span class="p">]</span> <span class="k">for</span> <span class="n">f_attr</span> <span class="ow">in</span> <span class="n">attrs</span> <span class="k">if</span> <span class="n">f_attr</span><span class="p">[</span><span class="n">dissolve_field_index</span><span class="p">]</span> <span class="o">==</span> <span class="n">unique_value</span><span class="p">]</span>
    <span class="n">sum_unique_values</span><span class="p">[</span><span class="n">unique_value</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">val_list</span><span class="p">)</span>

<span class="c1"># Run the regular Dissolve algorithm</span>
<span class="n">processing</span><span class="o">.</span><span class="n">runalg</span><span class="p">(</span><span class="s2">&quot;qgis:dissolve&quot;</span><span class="p">,</span> <span class="n">dissolve_layer</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
    <span class="n">dissolve_field</span><span class="p">,</span> <span class="n">output_layer</span><span class="p">)</span>

<span class="c1"># Add a new attribute called &#39;SUM&#39; in the output layer</span>
<span class="n">outlayer</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">getObject</span><span class="p">(</span><span class="n">output_layer</span><span class="p">)</span>
<span class="n">provider</span> <span class="o">=</span> <span class="n">outlayer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span>
<span class="n">provider</span><span class="o">.</span><span class="n">addAttributes</span><span class="p">([</span><span class="n">QgsField</span><span class="p">(</span><span class="s1">&#39;SUM&#39;</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">Double</span><span class="p">)])</span>
<span class="n">outlayer</span><span class="o">.</span><span class="n">updateFields</span><span class="p">()</span>

<span class="c1"># Set the value of the &#39;SUM&#39; field for each feature</span>
<span class="n">outlayer</span><span class="o">.</span><span class="n">startEditing</span><span class="p">()</span>
<span class="n">new_field_index</span> <span class="o">=</span> <span class="n">outlayer</span><span class="o">.</span><span class="n">fieldNameIndex</span><span class="p">(</span><span class="s1">&#39;SUM&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">processing</span><span class="o">.</span><span class="n">features</span><span class="p">(</span><span class="n">outlayer</span><span class="p">):</span>
  <span class="n">outlayer</span><span class="o">.</span><span class="n">changeAttributeValue</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">id</span><span class="p">(),</span> <span class="n">new_field_index</span><span class="p">,</span> <span class="n">sum_unique_values</span><span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="n">dissolve_field</span><span class="p">]])</span>
<span class="n">outlayer</span><span class="o">.</span><span class="n">commitChanges</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/1362.png" class="align-center" src="../_images/1362.png" />
<ol class="arabic simple" start="14">
<li><p>Run the algorithm by selecting <code class="docutils literal notranslate"><span class="pre">SUBREGION</span></code> as the <span class="guilabel">dissolve
field</span> and <code class="docutils literal notranslate"><span class="pre">POP_EST</span></code> as the <span class="guilabel">sum field</span>. Click <span class="guilabel">Run</span>.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The processing algorithm may take upto 10 minutes to finish depending on
your system.</p>
</div>
<img alt="../_images/1459.png" class="align-center" src="../_images/1459.png" />
<ol class="arabic simple" start="15">
<li><p>Once the processing finishes, you can use the <span class="guilabel">Identify</span> tool and
click on any polygon. You will see the newly added <code class="docutils literal notranslate"><span class="pre">SUM</span></code> field with the
<code class="docutils literal notranslate"><span class="pre">POP_EST</span></code> values from all original polygons added up.</p></li>
</ol>
<img alt="../_images/1554.png" class="align-center" src="../_images/1554.png" />
<ol class="arabic simple" start="16">
<li><p>You will note that all other fields in the output are still present. When
you dissolve many features to create a single feature, it doesn’t make
sense to keep the original fields in the output. Go back to the
<span class="guilabel">Script editor</span> and add the following code to delete all fields
except the <code class="docutils literal notranslate"><span class="pre">SUM</span></code> field and the field that was used to dissolve the
original layer. Click <span class="guilabel">Save</span> button and close the window.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Delete all fields except dissolve field and the newly created &#39;SUM&#39; field.</span>
<span class="n">outlayer</span><span class="o">.</span><span class="n">startEditing</span><span class="p">()</span>

<span class="n">fields_to_delete</span> <span class="o">=</span> <span class="p">[</span><span class="n">fid</span> <span class="k">for</span> <span class="n">fid</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">provider</span><span class="o">.</span><span class="n">fields</span><span class="p">()))</span> <span class="k">if</span> <span class="n">fid</span> <span class="o">!=</span> <span class="n">new_field_index</span> <span class="ow">and</span> <span class="n">fid</span> <span class="o">!=</span> <span class="n">dissolve_field_index</span><span class="p">]</span>
<span class="n">provider</span><span class="o">.</span><span class="n">deleteAttributes</span><span class="p">(</span><span class="n">fields_to_delete</span><span class="p">)</span>
<span class="n">outlayer</span><span class="o">.</span><span class="n">updateFields</span><span class="p">()</span>

<span class="n">outlayer</span><span class="o">.</span><span class="n">commitChanges</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/1651.png" class="align-center" src="../_images/1651.png" />
<ol class="arabic simple" start="17">
<li><p>One of the hidden features of the Processing Framework is that all
algorithms can work on selected features of a layer. This is very helpful
when you want to run an algorithm on the subset of a layer. As our script
uses <code class="docutils literal notranslate"><span class="pre">processing.features()</span></code> method to read features, it will respect the
current selection. To demonstrate that, let’s make a selection first. Click
on the <span class="guilabel">Select features using an expression</span> button.</p></li>
</ol>
<img alt="../_images/1748.png" class="align-center" src="../_images/1748.png" />
<ol class="arabic simple" start="18">
<li><p>Enter the following expression to select features from North and South
America and click <span class="guilabel">Select</span>.</p></li>
</ol>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&quot;CONTINENT&quot; = &#39;North America&#39; OR &quot;CONTINENT&quot; = &#39;South America&#39;
</pre></div>
</div>
<img alt="../_images/1845.png" class="align-center" src="../_images/1845.png" />
<ol class="arabic simple" start="19">
<li><p>You will see the selected features highlighted in yellow. Right-click the
<code class="docutils literal notranslate"><span class="pre">dissolve_with_sum</span></code> script and select <span class="guilabel">Execute</span>.</p></li>
</ol>
<img alt="../_images/1937.png" class="align-center" src="../_images/1937.png" />
<ol class="arabic simple" start="20">
<li><p>Select the inputs as before and click <span class="guilabel">Run</span>.</p></li>
</ol>
<img alt="../_images/2032.png" class="align-center" src="../_images/2032.png" />
<ol class="arabic simple" start="22">
<li><p>A new <code class="docutils literal notranslate"><span class="pre">output</span> <span class="pre">layer</span></code> will be added to QGIS. This will contain dissolved
geometries only from the selected features in the input layer. You will
also note that the <code class="docutils literal notranslate"><span class="pre">output</span> <span class="pre">layer</span></code> will contain only 2 fields as expected.</p></li>
</ol>
<img alt="../_images/2169.png" class="align-center" src="../_images/2169.png" />
<ol class="arabic simple" start="23">
<li><p>One last but important remmaining work is to document our algorithm. The
Processing Framework has nice tools to write and access help. Go to the
<span class="guilabel">Script editor</span> and click the <span class="guilabel">Edit script help</span>
button.</p></li>
</ol>
<img alt="../_images/2232.png" class="align-center" src="../_images/2232.png" />
<ol class="arabic simple" start="24">
<li><p>Fill in the details for different elements and click <span class="guilabel">OK</span>. Now a
detailed help will be available to all users of your script in the
<span class="guilabel">Help</span> tab when they launch the algorithm.</p></li>
</ol>
<img alt="../_images/2329.png" class="align-center" src="../_images/2329.png" />
<p>Below is the complete script for reference. You may modify it to suit your
needs.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">##dissolve_layer=vector</span>
<span class="c1">##dissolve_field=field dissolve_layer</span>
<span class="c1">##sum_field=field dissolve_layer</span>
<span class="c1">##output_layer=output vector</span>

<span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">PyQt4.QtCore</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">inlayer</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">getObject</span><span class="p">(</span><span class="n">dissolve_layer</span><span class="p">)</span>
<span class="n">dissolve_field_index</span> <span class="o">=</span> <span class="n">inlayer</span><span class="o">.</span><span class="n">fieldNameIndex</span><span class="p">(</span><span class="n">dissolve_field</span><span class="p">)</span>
<span class="n">sum_field_index</span> <span class="o">=</span> <span class="n">inlayer</span><span class="o">.</span><span class="n">fieldNameIndex</span><span class="p">(</span><span class="n">sum_field</span><span class="p">)</span>

<span class="c1"># Find unique values present in the dissolve field</span>
<span class="n">unique_values</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">f</span><span class="p">[</span><span class="n">dissolve_field</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">processing</span><span class="o">.</span><span class="n">features</span><span class="p">(</span><span class="n">inlayer</span><span class="p">)])</span>

<span class="c1"># Create a dictionary to hold values from the sum field</span>
<span class="n">sum_unique_values</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">attrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">attributes</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">processing</span><span class="o">.</span><span class="n">features</span><span class="p">(</span><span class="n">inlayer</span><span class="p">)]</span>
 
<span class="k">for</span> <span class="n">unique_value</span> <span class="ow">in</span> <span class="n">unique_values</span><span class="p">:</span>
    <span class="n">val_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">f_attr</span><span class="p">[</span><span class="n">sum_field_index</span><span class="p">]</span> <span class="k">for</span> <span class="n">f_attr</span> <span class="ow">in</span> <span class="n">attrs</span> <span class="k">if</span> <span class="n">f_attr</span><span class="p">[</span><span class="n">dissolve_field_index</span><span class="p">]</span> <span class="o">==</span> <span class="n">unique_value</span><span class="p">]</span>
    <span class="n">sum_unique_values</span><span class="p">[</span><span class="n">unique_value</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">val_list</span><span class="p">)</span>

<span class="c1"># Run the regular Dissolve algorithm</span>
<span class="n">processing</span><span class="o">.</span><span class="n">runalg</span><span class="p">(</span><span class="s2">&quot;qgis:dissolve&quot;</span><span class="p">,</span> <span class="n">dissolve_layer</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
    <span class="n">dissolve_field</span><span class="p">,</span> <span class="n">output_layer</span><span class="p">)</span>

<span class="c1"># Add a new attribute called &#39;SUM&#39; in the output layer</span>
<span class="n">outlayer</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">getObject</span><span class="p">(</span><span class="n">output_layer</span><span class="p">)</span>
<span class="n">provider</span> <span class="o">=</span> <span class="n">outlayer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span>
<span class="n">provider</span><span class="o">.</span><span class="n">addAttributes</span><span class="p">([</span><span class="n">QgsField</span><span class="p">(</span><span class="s1">&#39;SUM&#39;</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">Double</span><span class="p">)])</span>
<span class="n">outlayer</span><span class="o">.</span><span class="n">updateFields</span><span class="p">()</span>

<span class="c1"># Set the value of the &#39;SUM&#39; field for each feature</span>
<span class="n">outlayer</span><span class="o">.</span><span class="n">startEditing</span><span class="p">()</span>
<span class="n">new_field_index</span> <span class="o">=</span> <span class="n">outlayer</span><span class="o">.</span><span class="n">fieldNameIndex</span><span class="p">(</span><span class="s1">&#39;SUM&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">processing</span><span class="o">.</span><span class="n">features</span><span class="p">(</span><span class="n">outlayer</span><span class="p">):</span>
  <span class="n">outlayer</span><span class="o">.</span><span class="n">changeAttributeValue</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">id</span><span class="p">(),</span> <span class="n">new_field_index</span><span class="p">,</span> <span class="n">sum_unique_values</span><span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="n">dissolve_field</span><span class="p">]])</span>
<span class="n">outlayer</span><span class="o">.</span><span class="n">commitChanges</span><span class="p">()</span>

<span class="c1"># Delete all fields except dissolve field and the newly created &#39;SUM&#39; field</span>
<span class="n">outlayer</span><span class="o">.</span><span class="n">startEditing</span><span class="p">()</span>
<span class="n">fields_to_delete</span> <span class="o">=</span> <span class="p">[</span><span class="n">fid</span> <span class="k">for</span> <span class="n">fid</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">provider</span><span class="o">.</span><span class="n">fields</span><span class="p">()))</span> <span class="k">if</span> <span class="n">fid</span> <span class="o">!=</span> <span class="n">new_field_index</span> <span class="ow">and</span> <span class="n">fid</span> <span class="o">!=</span> <span class="n">dissolve_field_index</span><span class="p">]</span>
<span class="n">provider</span><span class="o">.</span><span class="n">deleteAttributes</span><span class="p">(</span><span class="n">fields_to_delete</span><span class="p">)</span>
<span class="n">outlayer</span><span class="o">.</span><span class="n">updateFields</span><span class="p">()</span>
<span class="n">outlayer</span><span class="o">.</span><span class="n">commitChanges</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>





  <!-- Comment Section Powered by utterances -->
<div id="comments">
  <hr />
  <p>If you want to give feedback or share your experience with this tutorial, please comment below. (requires GitHub account)</p>
<script src="https://utteranc.es/client.js"
        repo="spatialthoughts/qgis-tutorials"
        issue-term="title"
        label="comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
</div>


    </div>
      
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2023, Ujaval Gandhi.<br/>
      Last updated on Mar 26, 2024.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 7.2.6.<br/>
    </p>
  </div>
</footer>
<div class="container">
  <p>This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/deed.en_US">Creative Commons Attribution 4.0 International License</a></p>
</div>
<!-- Twitter Button -->
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<!-- Disqus comments widget -->
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'qgistutorials'; // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  }());
</script>

<script type="text/javascript">
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

<!-- Script fpr language switching. Largely adapted from https://github.com/pcav/faunalia-website -->
<script>
    var currentPage = 'docs/processing_python_scripts.html'; // coming from sphinx, always without starting '/'
    var currentLang = 'en';
    $(document).ready(function(){

        var search = new RegExp('\/[a-zA-Z_]{2,8}\/'+ currentPage, 'gi');
        var langPlusPage = window.location.href.match(search);
        // it's possible this is a index.html page called without 'index.html', try without the currentPage
        if (langPlusPage==undefined){
            search = new RegExp('\/[a-zA-Z_]{2,8}\/$', 'gi');
            langPlusPage = window.location.href.match(search);
        }

        // it's possible this is an index.html page called without 'index.html', try removing index.html
        if (langPlusPage==undefined){
            currentPage = currentPage.replace('index.html','')
            search = new RegExp('\/[a-zA-Z_]{2,8}\/'+ currentPage, 'gi');
            langPlusPage = window.location.href.match(search);
        }
        // still no langPlugPage: stop, because the language swicher will misbehave 

        if (langPlusPage == undefined || langPlusPage.length != 1){
            alert('You hit an error, please report back to us.');
            return;
        }
        langPlusPage = langPlusPage[0];
        currentLang = langPlusPage.replace(currentPage, '');

        $("#languages").val(currentLang.replace(/\//g,'')); // currentLang is something like '/nl/'

        $("#languages").change(function() {
            gotoLang($(this).val());
        });

    });

    // load current page in a different language
    function gotoLang(lang){
        var currentUrl = window.location.href;
        var newUrl = currentUrl.replace(currentLang, '/'+lang+'/');
        window.location.href = newUrl;
    }
</script>

  </body>
</html>