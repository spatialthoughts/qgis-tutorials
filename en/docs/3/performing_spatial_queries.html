<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Performing Spatial Queries (QGIS3) &#8212; QGIS Tutorials and Tips</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/bootstrap-sphinx.css?v=0bf093e7" />
    <script src="../../_static/documentation_options.js?v=29a6c3e3"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Nearest Neighbor Analysis (QGIS3)" href="nearest_neighbor_analysis.html" />
    <link rel="prev" title="Performing Spatial Joins (QGIS3)" href="performing_spatial_joins.html" />

<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../../_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>


<!-- Cookie Notice -->
<!-- Script from https://github.com/AOEpeople/cookie-notice -->
<script type="text/javascript" src="../../_static/cookie.notice.min.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-B1WQ7B80XJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-B1WQ7B80XJ');
</script>


  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          QGIS Tutorials and Tips</a>
        <span class="navbar-text navbar-version pull-left"><b>v1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Tutorials List <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="making_a_map.html">Making a Map (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="working_with_attributes.html">Working with Attributes (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="importing_spreadsheets_csv.html">Importing Spreadsheets or CSV files (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic_vector_styling.html">Basic Vector Styling (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="calculating_line_lengths.html">Calculating Line Lengths and Statistics (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="raster_styling_and_analysis.html">Basic Raster Styling and Analysis (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="raster_mosaicing_and_clipping.html">Raster Mosaicing and Clipping (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="working_with_terrain.html">Working with Terrain Data (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="working_with_wms.html">Working with WMS Data (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="working_with_projections.html">Working with Projections (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="georeferencing_basics.html">Georeferencing Topo Sheets and Scanned Maps (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced_georeferencing.html">Georeferencing Aerial Imagery (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="digitizing_basics.html">Digitizing Map Data (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="performing_table_joins.html">Performing Table Joins (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="performing_spatial_joins.html">Performing Spatial Joins (QGIS3)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Performing Spatial Queries (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="nearest_neighbor_analysis.html">Nearest Neighbor Analysis (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="sampling_raster_data.html">Sampling Raster Data using Points or Polygons (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="calculating_raster_area.html">Calculating Raster Area (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="creating_heatmaps.html">Creating Heatmaps (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="animating_time_series.html">Animating Time Series Data (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="handling_invalid_geometries.html">Handling Invalid Geometries (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced_raster_analysis.html">Advanced Raster Analysis (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="interpolating_point_data.html">Interpolating Point Data (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="batch_processing.html">Batch Processing using Processing Framework (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="processing_graphical_modeler.html">Automating Complex Workflows using Processing Modeler (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="automating_map_creation.html">Automating Map Creation with Print Layout Atlas (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="multi_criteria_overlay.html">Multi Criteria Overlay Analysis (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="vector_styling_expressions.html">Basic Filtering and Styling with Expressions (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="block_world_styling.html">Creating a Block World Map (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="river_styling_expressions.html">Styling a River Network with Expressions (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="contour_3d_styling.html">Styling Contours in 3D (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="isometric_buildings.html">Creating Isometric Buildings (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="interactive_canvas_maps.html">Making Interactive Canvas Maps (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="interactive_reveal_maps.html">Making Interactive Reveal Maps (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="cartogram_animation.html">Creating an Animated Cartogram (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic_network_analysis.html">Basic Network Visualization and Routing (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="origin_destination_matrix.html">Locating Nearest Facility with Origin-Destination Matrix (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="service_area_analysis.html">Service Area Analysis using Openrouteservice (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="travel_time_analysis.html">Travel Time Analysis with Uber Movement (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="areal_mean_rainfall.html">Calculating Areal Mean Rainfall (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="colorized_river_basin_map.html">Creating a Colorized River Basin Map (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="creating_landuse_map.html">Creating a Landuse Map (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="calculating_intersection_density.html">Calculating Street Intersection Density (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="landuse_buffer.html">Determining Landuse Buffer Zones (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="solidwaste_mapping.html">Mapping Waste Disposal Volumes (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started_with_pyqgis.html">Getting Started With Python Programming (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="processing_algorithms_pyqgis.html">Running Processing Algorithms via Python (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom_python_functions.html">Using Custom Python Expression Functions (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="processing_python_scripts.html">Writing Python Scripts for Processing Framework (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="building_a_python_plugin.html">Building a Python Plugin (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="processing_python_plugin.html">Building a Processing Plugin (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../running_qgis_jobs.html">Running and Scheduling QGIS Processing Jobs</a></li>
<li class="toctree-l1"><a class="reference internal" href="web_mapping_with_qgis2web.html">Web Mapping with QGIS2Web (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../creating_basemaps_with_qtiles.html">Creating Basemaps with QTiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="using_plugins.html">Using Plugins (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../downloading_osm_data.html">Searching and Downloading OpenStreetMap Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../learning_resources.html">QGIS Learning Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../credits.html">Data Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../batch_processing.html">Batch Processing using Processing Framework (QGIS2)</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="performing_spatial_joins.html" title="Previous Chapter: Performing Spatial Joins (QGIS3)"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Performing Sp...</span>
    </a>
  </li>
  <li>
    <a href="nearest_neighbor_analysis.html" title="Next Chapter: Nearest Neighbor Analysis (QGIS3)"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Nearest Neigh... &raquo;</span>
    </a>
  </li>
              
            
            

            

            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><h4>Author</h4>
<p><a href="https://www.linkedin.com/in/spatialthoughts/"><img src="../../_static/ujaval.png">Ujaval Gandhi</a></p>

<hr>
<p>Want to learn QGIS in a structured way? Check out <a href="https://spatialthoughts.com/" target="_blank">Spatial Thoughts</a> for more learning materials and instructor-led online programs with QGIS.org certification.</p>

<hr>
<p>These tutorials are also available in many other languages. Please see <a href="https://www.qgistutorials.com/en/docs/introduction.html#translations" target="_blank">translations</a> page.
</p>
        </div>
      </div>
    <div class="body col-md-9 content" role="main">
      

  <section id="performing-spatial-queries-qgis3">
<h1>Performing Spatial Queries (QGIS3)<a class="headerlink" href="#performing-spatial-queries-qgis3" title="Link to this heading">¶</a></h1>
<p>Spatial queries are core to many types of GIS analysis. Spatial queries allows you to select features in a layer by their spatial relationships (intersect, contain, touch etc.) with features from another layer. In QGIS, this functionality is available via the <strong>Select by Location</strong> and <strong>Extract by Location</strong> Processing tools.</p>
<section id="overview-of-the-task">
<h2>Overview of the task<a class="headerlink" href="#overview-of-the-task" title="Link to this heading">¶</a></h2>
<p>We will be working with 2 data layers for the city of Melbourne, Australia. Given the data layers for the pubs and bars in the city and locations of all metro stations, we want to find out all bars and pubs within 500 meters of a metro station.</p>
<section id="other-skills-you-will-learn">
<h3>Other skills you will learn<a class="headerlink" href="#other-skills-you-will-learn" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>Choosing an appropriate projection and re-projecting vector data.</p></li>
<li><p>Creating buffers.</p></li>
<li><p>Working with the geopackage (.gpkg) data format.</p></li>
</ul>
</section>
</section>
<section id="get-the-data">
<h2>Get the data<a class="headerlink" href="#get-the-data" title="Link to this heading">¶</a></h2>
<p>City of Melbourne’s <a class="reference external" href="https://data.melbourne.vic.gov.au/">Open Data Platform</a> provides many GIS-ready datasets for the city.</p>
<p>Download the <a class="reference external" href="https://data.melbourne.vic.gov.au/Transport-Movement/Metro-Train-Stations-with-Accessibility-Informatio/mgkp-67ad">Metro Train Stations with Accessibility Information</a> dataset by Metro Trains Melbourne. Export the data in the <em>Original</em> format.</p>
<img alt="../../_images/data117.png" class="align-center" src="../../_images/data117.png" />
<p>Download the <a class="reference external" href="https://data.melbourne.vic.gov.au/Economy/Bars-and-pubs-with-patron-capacity/mffi-m9yn">Bars and pubs, with patron capacity</a> dataset by City of Melbourne’s Census of Land Use and Employment (CLUE). Export the data as a <em>CSV</em>.</p>
<img alt="../../_images/data27.png" class="align-center" src="../../_images/data27.png" />
<p>For convenience, you may directly download a copy of datasets from the link below:</p>
<p><a class="reference external" href="https://www.qgistutorials.com/downloads/metro_stations_accessbility.zip">metro_stations_accessbility.zip</a></p>
<p><a class="reference external" href="https://www.qgistutorials.com/downloads/Bars_and_pubs__with_patron_capacity.csv">Bars_and_pubs__with_patron_capacity</a></p>
<p>Data Source: <a class="reference internal" href="../credits.html#cityofmelbourne" id="id2"><span>[CITYOFMELBOURNE]</span></a></p>
</section>
<section id="procedure">
<h2>Procedure<a class="headerlink" href="#procedure" title="Link to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>Locate the <code class="docutils literal notranslate"><span class="pre">metro_stations_accessbility.zip</span></code> file in the QGIS Browser and expand it. Select the <code class="docutils literal notranslate"><span class="pre">metro_stations_accessbility.shp</span></code> file and drag it to the canvas. A new layer <code class="docutils literal notranslate"><span class="pre">metro_stations_accessbility</span></code> will be loaded in the <span class="guilabel">Layers</span> panel.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/1137.png" class="align-center" src="../../_images/1137.png" />
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>The data layer for bars and pubs is in the CSV format. To load it in QGIS, go to <span class="menuselection">Layer ‣ Add Layer ‣ Add Delimited Text Layer…</span>. ( See <a class="reference internal" href="importing_spreadsheets_csv.html"><span class="doc">Importing Spreadsheets or CSV files (QGIS3)</span></a> for more details on importing CSV files)</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/2108.png" class="align-center" src="../../_images/2108.png" />
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>In the <span class="guilabel">Data Source Manager | Delimited Text</span> dialog, browse and select the downloaded <code class="docutils literal notranslate"><span class="pre">Bars_and_pubs__with_patron_capacity.csv</span></code> file as <span class="guilabel">File name</span>. The <span class="guilabel">X field</span> and <span class="guilabel">Y field</span> columns should be auto selected to <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">coordinate</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">coordinate</span></code> respectively. Click <span class="guilabel">Add</span>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/356.png" class="align-center" src="../../_images/356.png" />
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>QGIS saves the last-selected options for this dialog, so if you previously configured this dialog with other options, they may still be selected. Specifically, make sure the <span class="guilabel">Record and Fields Options</span> section has <span class="guilabel">Number of header lines to discard</span> option set to <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
</div>
<ol class="arabic simple" start="4">
<li><p>You will see a new <code class="docutils literal notranslate"><span class="pre">Bars_and_pubs__with_patron_capacity</span></code> layer added to the <span class="guilabel">Layers</span> panel. Both of the input layers are in the Geograhpic Coordinate Reference System (CRS) <code class="docutils literal notranslate"><span class="pre">EPSG:4326</span> <span class="pre">WGS84</span></code>. For performing spatial analysis, it is recommended to use a Projected Coordinate Reference System (CRS). So we will now re-project both the layers to an appropriate regional CRS that minimizes distortions and allows us to work in units of distance such as meters instead of degrees. Go to <span class="menuselection">Processing ‣ Toolbox</span>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/428.png" class="align-center" src="../../_images/428.png" />
</div></blockquote>
<ol class="arabic simple" start="5">
<li><p>Search and locate the <span class="menuselection">Vector general ‣ Reproject layer</span> tool. Double-click to launch it.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/526.png" class="align-center" src="../../_images/526.png" />
</div></blockquote>
<ol class="arabic simple" start="6">
<li><p>Select <code class="docutils literal notranslate"><span class="pre">Bars_and_pubs__with_patron_capacity</span></code> as the <span class="guilabel">Input layer</span>. Click the <span class="guilabel">Select CRS</span> button next to <span class="guilabel">Target CRS</span>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/626.png" class="align-center" src="../../_images/626.png" />
</div></blockquote>
<ol class="arabic simple" start="7">
<li><p>When selecting a projected coordinate system for your analysis, the first place to look is for a regional CRS for the area of interest. For Australia, the <a class="reference external" href="https://www.ga.gov.au/scientific-topics/positioning-navigation/geodesy/datums-projections/grid2020">Map Grid of Australia (MGA) 2020</a> is a UTM-based grid system that is used for local and regional mapping. Melbourne falls in the UTM Zone 55, so we can select the <cite>GDA 2020 / MGA zone 55 EPSG:7855`</cite> CRS.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/725.png" class="align-center" src="../../_images/725.png" />
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are not sure of the a local CRS for the region that you are working in, selecting a CRS for the UTM zone based on the WGS84 datum is a safe choice. You can find out the UTM zone number of your region using <a class="reference external" href="http://www.dmap.co.uk/utmworld.htm">UTM Grid Zones of the World</a>.</p>
</div>
<ol class="arabic simple" start="8">
<li><p>Next, click the <span class="guilabel">…</span> button next to <span class="guilabel">Reprojected</span> and select <code class="docutils literal notranslate"><span class="pre">Save</span> <span class="pre">to</span> <span class="pre">GeoPackage</span></code>. <a class="reference external" href="https://www.geopackage.org/">Geopackage</a> is the recommended open data format spatial data and is the default data exchange format for QGIS3. A single GeoPackage <code class="docutils literal notranslate"><span class="pre">.gpkg</span></code> file can contain multiple vector and raster layers.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/825.png" class="align-center" src="../../_images/825.png" />
</div></blockquote>
<ol class="arabic simple" start="9">
<li><p>Name the geopackage as <code class="docutils literal notranslate"><span class="pre">spatialquery</span></code> and click <span class="guilabel">Save</span>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/925.png" class="align-center" src="../../_images/925.png" />
</div></blockquote>
<ol class="arabic simple" start="10">
<li><p>When prompted for a layer name, enter <code class="docutils literal notranslate"><span class="pre">bars_and_pubs</span></code> and click <span class="guilabel">OK</span>. Click <span class="guilabel">Run</span> to reproject the layer.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/1032.png" class="align-center" src="../../_images/1032.png" />
</div></blockquote>
<ol class="arabic simple" start="11">
<li><p>The window will switch to the <span class="guilabel">Log</span> tab and you will see the algorithm run and create the new output layer <code class="docutils literal notranslate"><span class="pre">bars_and_pubs</span></code>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/1138.png" class="align-center" src="../../_images/1138.png" />
</div></blockquote>
<ol class="arabic simple" start="12">
<li><p>Now we will reproject the <code class="docutils literal notranslate"><span class="pre">metro_stations_accessbility</span></code> layer. Switch back to the <span class="guilabel">Paramters</span> tab in the <span class="guilabel">Reproject layer</span> window. Select <code class="docutils literal notranslate"><span class="pre">metro_stations_accessbility</span></code> as the <span class="guilabel">Input layer</span>. Keep the same <span class="guilabel">Target CRS</span>.  Next, click the <span class="guilabel">…</span> button next to <span class="guilabel">Reprojected</span> and select <code class="docutils literal notranslate"><span class="pre">Save</span> <span class="pre">to</span> <span class="pre">GeoPackage</span></code>. Select the same output file <code class="docutils literal notranslate"><span class="pre">spatialquery</span></code> (Remember that a single geopackage file can contain multiple layers, so we will save the new layer to the same geopackage file). Enter <code class="docutils literal notranslate"><span class="pre">metro_stations</span></code> as the <span class="guilabel">Layer name</span>. Click <span class="guilabel">Run</span>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/1233.png" class="align-center" src="../../_images/1233.png" />
</div></blockquote>
<ol class="arabic simple" start="13">
<li><p>Back in the main QGIS window, you will see 2 new layers loaded in the <span class="guilabel">Layers</span> panel: <code class="docutils literal notranslate"><span class="pre">bars_and_pubs</span></code> and <code class="docutils literal notranslate"><span class="pre">metro_stations</span></code>. You may turn off the visibility for original layers. Now, we are ready to do the spatial query. As we are interested in selecting bars and pubs within 500m of the metro stations, the first step is to create a buffer around the metro stations that represents our search area. Search and locate the <span class="menuselection">Vector geometry ‣ Buffer</span> tool in the <span class="guilabel">Processing Toolbox</span> and double-click to launch it.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/1331.png" class="align-center" src="../../_images/1331.png" />
</div></blockquote>
<ol class="arabic simple" start="14">
<li><p>In the <span class="guilabel">Buffer</span> dialog, select <code class="docutils literal notranslate"><span class="pre">metro_stations</span></code> as the <span class="guilabel">Input layer</span>. Set <code class="docutils literal notranslate"><span class="pre">500</span></code> meters as the <span class="guilabel">Distance</span>. Save the output to the same <code class="docutils literal notranslate"><span class="pre">spatialquery</span></code> geopackage and enter <code class="docutils literal notranslate"><span class="pre">metro_stations_buffers</span></code> as the <span class="guilabel">Layer name</span>. Click <span class="guilabel">Run</span>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/1429.png" class="align-center" src="../../_images/1429.png" />
</div></blockquote>
<ol class="arabic simple" start="15">
<li><p>You will see a new <code class="docutils literal notranslate"><span class="pre">metro_stations_buffers</span></code> layers loaded in the <span class="guilabel">Layers</span> panel. Now we can find out which points from the <code class="docutils literal notranslate"><span class="pre">bars_and_pubs</span></code> layer falls within the polygons from the <code class="docutils literal notranslate"><span class="pre">metro_stations_buffers</span></code> layer. Locate the <span class="menuselection">Vector selection ‣ Extract by Location</span> tool from the <span class="guilabel">Processing Toolbox</span> and double-click to launch it.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/1524.png" class="align-center" src="../../_images/1524.png" />
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><em>Extract by location</em> will create a new layer with the matching features from the spatial query. If you just want to select features, use the <em>Select by location</em> tool.</p>
</div>
<ol class="arabic simple" start="16">
<li><p>In the <span class="guilabel">Extract by location</span> dialog, select <code class="docutils literal notranslate"><span class="pre">bars_and_pubs</span></code> as the <span class="guilabel">Extract features from</span>. Check <code class="docutils literal notranslate"><span class="pre">Intersect</span></code> as the <span class="guilabel">geometry predicate</span>. Set <code class="docutils literal notranslate"><span class="pre">metro_stations_buffers</span></code> as <span class="guilabel">By comparing to the features from</span>. Save the output to the <code class="docutils literal notranslate"><span class="pre">spatialquery</span></code> geopackage as the layer <code class="docutils literal notranslate"><span class="pre">selected</span></code>. Click <span class="guilabel">Run</span>.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/1623.png" class="align-center" src="../../_images/1623.png" />
</div></blockquote>
<ol class="arabic simple" start="17">
<li><p>Once the processing finishes, you will see the <code class="docutils literal notranslate"><span class="pre">selected</span></code> layers added to the <span class="guilabel">Layers</span> panel. Note that this layer only contains points from the <code class="docutils literal notranslate"><span class="pre">bars_and_pubs</span></code> that fall within the buffer polygons.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/1724.png" class="align-center" src="../../_images/1724.png" />
</div></blockquote>
<ol class="arabic simple" start="18">
<li><p>Our analysis is complete. You may notice that the buffer polygons look oval-shaped. This is because our Project CRS is still set to <strong>EPSG:4326 WGS84</strong>. To better visualize the results, you can go to <span class="menuselection">Project ‣ Properties ‣ CRS</span> and select <code class="docutils literal notranslate"><span class="pre">GDA</span> <span class="pre">2020</span> <span class="pre">/</span> <span class="pre">MGA</span> <span class="pre">zone</span> <span class="pre">55</span> <span class="pre">EPSG:7855</span></code> which we used for the analysis. Once set to this CRS, the buffer will appear in the correct shape.</p></li>
</ol>
<blockquote>
<div><img alt="../../_images/1821.png" class="align-center" src="../../_images/1821.png" />
</div></blockquote>
</section>
</section>





  <!-- Comment Section Powered by utterances -->
<div id="comments">
  <hr />
  <p>If you want to give feedback or share your experience with this tutorial, please comment below. (requires GitHub account)</p>
<script src="https://utteranc.es/client.js"
        repo="spatialthoughts/qgis-tutorials"
        issue-term="title"
        label="comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
</div>


    </div>
      
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2023, Ujaval Gandhi.<br/>
      Last updated on Nov 16, 2024.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 7.2.6.<br/>
    </p>
  </div>
</footer>
<div class="container">
  <p>This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/deed.en_US">Creative Commons Attribution 4.0 International License</a></p>
</div>

<!-- Script fpr language switching. Largely adapted from https://github.com/pcav/faunalia-website -->
<script>
    var currentPage = 'docs/3/performing_spatial_queries.html'; // coming from sphinx, always without starting '/'
    var currentLang = 'en';
    $(document).ready(function(){

        var search = new RegExp('\/[a-zA-Z_]{2,8}\/'+ currentPage, 'gi');
        var langPlusPage = window.location.href.match(search);
        // it's possible this is a index.html page called without 'index.html', try without the currentPage
        if (langPlusPage==undefined){
            search = new RegExp('\/[a-zA-Z_]{2,8}\/$', 'gi');
            langPlusPage = window.location.href.match(search);
        }

        // it's possible this is an index.html page called without 'index.html', try removing index.html
        if (langPlusPage==undefined){
            currentPage = currentPage.replace('index.html','')
            search = new RegExp('\/[a-zA-Z_]{2,8}\/'+ currentPage, 'gi');
            langPlusPage = window.location.href.match(search);
        }
        // still no langPlugPage: stop, because the language swicher will misbehave 

        if (langPlusPage == undefined || langPlusPage.length != 1){
            alert('You hit an error, please report back to us.');
            return;
        }
        langPlusPage = langPlusPage[0];
        currentLang = langPlusPage.replace(currentPage, '');

        $("#languages").val(currentLang.replace(/\//g,'')); // currentLang is something like '/nl/'

        $("#languages").change(function() {
            gotoLang($(this).val());
        });

    });

    // load current page in a different language
    function gotoLang(lang){
        var currentUrl = window.location.href;
        var newUrl = currentUrl.replace(currentLang, '/'+lang+'/');
        window.location.href = newUrl;
    }
</script>

  </body>
</html>