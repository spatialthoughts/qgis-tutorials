<!DOCTYPE html>

<html lang="pt_BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Construindo um complemento com Python &#8212; QGIS Tutorials and Tips</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/translations.js"></script>
    <link rel="search" title="Buscar" href="../search.html" />

<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js "></script>


<!-- Cookie Notice -->
<!-- Script from https://github.com/AOEpeople/cookie-notice -->
<script type="text/javascript" src="../_static/cookie.notice.min.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-B1WQ7B80XJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-B1WQ7B80XJ');
</script>


  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><span><img src="../_static/logo.png"></span>
          QGIS Tutorials and Tips</a>
        <span class="navbar-text navbar-version pull-left"><b>v1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Tutorials List <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introdução</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/making_a_map.html">Elaborando um Mapa (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/working_with_attributes.html">Working with Attributes (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/importing_spreadsheets_csv.html">Importando planilhas ou arquivos .CSV (QGIS 3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/basic_vector_styling.html">Estilo Vetorial Básico (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/calculating_line_lengths.html">Calculating Line Lengths and Statistics (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/raster_styling_and_analysis.html">Basic Raster Styling and Analysis (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/raster_mosaicing_and_clipping.html">Raster Mosaicing and Clipping (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/working_with_terrain.html">Working with Terrain Data (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/working_with_wms.html">Working with WMS Data (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/working_with_projections.html">Working with Projections (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/georeferencing_basics.html">Georeferencing Topo Sheets and Scanned Maps (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/advanced_georeferencing.html">Georreferenciamento de imagens aéreas (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/digitizing_basics.html">Digitizing Map Data (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/performing_table_joins.html">Performing Table Joins (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/performing_spatial_joins.html">Performing Spatial Joins (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/performing_spatial_queries.html">Performing Spatial Queries (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/nearest_neighbor_analysis.html">Nearest Neighbor Analysis (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/sampling_raster_data.html">Sampling Raster Data using Points or Polygons (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/calculating_raster_area.html">Calculating Raster Area (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/creating_heatmaps.html">Creating Heatmaps (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/animating_time_series.html">Animating Time Series Data (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/handling_invalid_geometries.html">Handling Invalid Geometries (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/advanced_raster_analysis.html">Advanced Raster Analysis (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/interpolating_point_data.html">Interpolating Point Data (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/calculating_intersection_density.html">Calculating Street Intersection Density (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/batch_processing.html">Batch Processing using Processing Framework (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/processing_graphical_modeler.html">Automating Complex Workflows using Processing Modeler (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/automating_map_creation.html">Automating Map Creation with Print Layout Atlas (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/multi_criteria_overlay.html">Análise de sobreposição de múltiplos critérios (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/basic_network_analysis.html">Basic Network Visualization and Routing (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/origin_destination_matrix.html">Locating Nearest Facility with Origin-Destination Matrix (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/service_area_analysis.html">Service Area Analysis using Openrouteservice (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/travel_time_analysis.html">Travel Time Analysis with Uber Movement (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/areal_mean_rainfall.html">Calculating Areal Mean Rainfall (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/getting_started_with_pyqgis.html">Getting Started With Python Programming (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/processing_algorithms_pyqgis.html">Running Processing Algorithms via Python (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/custom_python_functions.html">Using Custom Python Expression Functions (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/processing_python_scripts.html">Escrever Scripts de Python para o Framework do Processing (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/building_a_python_plugin.html">Construindo um complemento com Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/processing_python_plugin.html">Building a Processing Plugin (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="running_qgis_jobs.html">Running and Scheduling QGIS Processing Jobs</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/web_mapping_with_qgis2web.html">Web Mapping with QGIS2Web (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="creating_basemaps_with_qtiles.html">Criando Mapas Base utilizando QTiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/using_plugins.html">Using Plugins (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="downloading_osm_data.html">Searching and Downloading OpenStreetMap Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="learning_resources.html">QGIS Learning Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="credits.html">Créditos</a></li>
<li class="toctree-l1"><a class="reference internal" href="batch_processing.html">Batch Processing using Processing Framework (QGIS2)</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            

            

            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><h4>Author</h4>
<p>Ujaval Gandhi</p>
<a href="https://twitter.com/intent/follow?screen_name=spatialthoughts" class="twitter-follow-button" data-show-count="false">Follow @spatialthoughts</a>
<hr>
<p>Want to learn QGIS in a structured way? Check out <a href="https://spatialthoughts.com/" target="_blank">Spatial Thoughts</a> for more learning materials and instructor-led online programs with QGIS.org certification.</p>


<h4>Change Language</h4>
<form role="form" class="sidebar-form sidebar-left">
<select id="languages" class="form-control select-mini">
  <option value="en">English</option>
  <option value="zh_TW">Chinese (Taiwan)</option>
  <option value="nl">Dutch</option>
  <option value="fi_FI">Finnish</option>
  <option value="fr">French</option>
  <option value="de">German</option>
  <option value="el">Greek</option>
  <option value="id">Indonesian</option>
  <option value="it">Italian</option>
  <option value="ko">Korean</option>
  <option value="fa">Persian</option>
  <option value="pt_BR">Portuguese</option>
  <option value="ro">Romanian</option>
  <option value="ru">Russian</option>
  <option value="sl">Slovenian</option>
  <option value="es">Spanish</option>
  <option value="th">Thai</option>
  <option value="tr">Turkish</option>
  <option value="uk">Ukrainian</option>
  <option value="vi">Vietnamese</option>
</select>
</form>
        </div>
      </div>
    <div class="body col-md-9 content" role="main">
      

  <section id="building-a-python-plugin">
<h1>Construindo um complemento com Python<a class="headerlink" href="#building-a-python-plugin" title="Link permanente para este título">¶</a></h1>
<div class="admonition warning">
<p class="admonition-title">Aviso</p>
<p>A new version of this tutorial is available at <a class="reference internal" href="3/building_a_python_plugin.html"><span class="doc">Construindo um complemento com Python</span></a></p>
</div>
<p>Complementos são uma ótima maneira de estender a funcionalidade do QGIS. Você pode escrever complementos usando Python que podem variar desde adicionar um botão simples até kits de ferramentas sofisticadas. Este tutorial irá descrever o processo envolvido na criação de seu ambiente de desenvolvimento, o desenho da interface do usuário para um plugin e escrever o código para interagir com o QGIS. Por favor, reveja o <span class="xref std std-doc">getting_started_with_pyqgis`tutorial getting_started_with_pyqgis</span> para se familiarizar com o básico.</p>
<section id="overview-of-the-task">
<h2>Visão geral da tarefa<a class="headerlink" href="#overview-of-the-task" title="Link permanente para este título">¶</a></h2>
<p>Vamos desenvolver um plugin simples chamado <code class="docutils literal notranslate"><span class="pre">Salvar</span> <span class="pre">Atributos</span></code> que permitirá aos usuários escolher uma camada vetorial e escrever seus atributos para um arquivo CSV.</p>
</section>
<section id="get-the-tools">
<h2>Obter as Ferramentas<a class="headerlink" href="#get-the-tools" title="Link permanente para este título">¶</a></h2>
<section id="qt-creator">
<h3>Qt Creator<a class="headerlink" href="#qt-creator" title="Link permanente para este título">¶</a></h3>
<p><a class="reference external" href="http://www.qt.io/">Qt</a>  é um framework de desenvolvimento de software que é usado para desenvolver aplicações que rodam no Windows, Mac, Linux, assim como diversos sistemas operacionais móveis. o QGIS é escrito usando o framework Qt. Para o desenvolvimento de plugins, vamos usar um aplicativo chamado <a href="#id1"><span class="problematic" id="id2">``</span></a>Qt Creator &lt;<a class="reference external" href="http://doc.qt.io/qtcreator/index.html">http://doc.qt.io/qtcreator/index.html</a>&gt;`_ para projetar a interface para o nosso plugin.</p>
<p>Faça o download e instale o software Qt Creator pelo <a class="reference external" href="http://sourceforge.net/projects/qtcreator.mirror/files/latest/download">SourgeForge</a></p>
</section>
<section id="python-bindings-for-qt">
<h3>Ligações Python para o Qt<a class="headerlink" href="#python-bindings-for-qt" title="Link permanente para este título">¶</a></h3>
<p>Uma vez que estamos a desenvolver um plugin em Python, é preciso instalar os vínculos python para o Qt. O método para a instalação destes dependerá da plataforma que você está usando. Para a construção de plugins precisamos do ferramenta de linha de comando <code class="docutils literal notranslate"><span class="pre">pyrcc4</span></code>.</p>
<p><strong>Windows</strong></p>
<p>Faça o download do instalador <a class="reference external" href="http://trac.osgeo.org/osgeo4w/">OSGeo4W rede</a> e escolha <span class="guilabel">Express Desktop install</span>. Instale o pacote <code class="docutils literal notranslate"><span class="pre">QGIS</span></code>. Após a instalação, você será capaz de acessar a ferramenta <code class="docutils literal notranslate"><span class="pre">pyrcc4</span></code> via <span class="guilabel">OSGeo4W Shell</span>.</p>
<p><strong>Mac</strong></p>
<p>Instale o gerenciador de pacotes <a class="reference external" href="http://brew.sh">Homebrew</a>. Instale o pacote <code class="docutils literal notranslate"><span class="pre">PyQt</span></code> executando o seguinte comando:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>brew install pyqt
</pre></div>
</div>
<p><strong>Linux</strong></p>
<p>Dependendo da sua distribuição, encontre e instale o <code class="docutils literal notranslate"><span class="pre">pacote</span> <span class="pre">python-qt4</span></code>. No Ubuntu e distribuições baseadas no Debian, você pode executar o seguinte comando:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo apt-get install python-qt4
</pre></div>
</div>
</section>
<section id="a-text-editor-or-a-python-ide">
<h3>Um editor de texto ou um IDE Python<a class="headerlink" href="#a-text-editor-or-a-python-ide" title="Link permanente para este título">¶</a></h3>
<p>Qualquer tipo de desenvolvimento de software requer um bom editor de texto. Se você já tem um editor de texto favorito ou um IDE (Integrated Development Environment), você pode usá-lo para este tutorial. Caso contrário, cada plataforma oferece uma ampla variedade de opções gratuitas ou pagas para editores de texto. Escolha o que se adapta às suas necessidades.</p>
<p>Este tutorial usa o editor Notepad++ no Windows.</p>
<p><strong>Windows</strong></p>
<p><a class="reference external" href="http://notepad-plus-plus.org/">Notepad++</a> é um bom editor para o windows. Baixe e ibnstale o Notepad++ em &lt;<a class="reference external" href="http://notepad-plus-plus.org/repository/6.x/6.7.5/npp.6.7.5.Installer.exe">http://notepad-plus-plus.org/repository/6.x/6.7.5/npp.6.7.5.Installer.exe</a>&gt;`_.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Se você usa o Notepad++, faz-se de verificar <span class="guilabel">Replace by space</span> at  <span class="menuselection">Settings ‣ Preferences ‣ Tab Settings</span>. Python é muito sensível sobre o espaço em branco e esta configuração irá garantir como as tabulações e espaços são tratados adequadamente.</p>
</div>
</section>
<section id="plugin-builder-plugin">
<h3>Complemento para construir um complemento<a class="headerlink" href="#plugin-builder-plugin" title="Link permanente para este título">¶</a></h3>
<p>Existe um complemento no QGIS útil chamado `` Plugin Builder`` que cria todos os arquivos necessários e o código clichê para um plugin. Encontre e instale o complemento <code class="docutils literal notranslate"><span class="pre">Plugin</span> <span class="pre">Builder</span></code>. Veja <a class="reference internal" href="using_plugins.html"><span class="doc">Using Plugins</span></a> para obter mais detalhes sobre como instalar complementos.</p>
</section>
<section id="plugins-reloader-plugin">
<h3>Complemento para recarregar complementos<a class="headerlink" href="#plugins-reloader-plugin" title="Link permanente para este título">¶</a></h3>
<p>Este é um outro complemento auxiliar que permite o desenvolvimento iterativo de complementos. Usando este complemento, você pode alterar o código de um complemento e tê-lo refletido no QGIS sem ter que reiniciar o QGIS a cada vez. Encontre e instale o complemento `` Plugin Reloader``. Veja <span class="xref std std-ref">using_plugins</span> para obter mais detalhes sobre como instalar plugins.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>O complemento Recarregar complementos é um plugin experimental. Certifique-se de ter verificado <span class="guilabel">Exibir também complementos experimentais</span> nas <span class="guilabel">configurações do gerenciador de complementos</span> se você não encontrá-lo.</p>
</div>
</section>
</section>
<section id="procedure">
<h2>Procedimento<a class="headerlink" href="#procedure" title="Link permanente para este título">¶</a></h2>
<ol class="arabic simple">
<li><p>Abra o QGIS. Vá até <span class="menuselection">Complementos‣ Plugin Builder ‣ Plugin Builder</span>.</p></li>
</ol>
<img alt="../_images/1156.png" class="align-center" src="../_images/1156.png" />
<ol class="arabic simple" start="2">
<li><p>Você vai ver o  <span class="guilabel">QGIS Plugin Builder</span>  com um formulário. Você pode preencher o formulário com detalhes relativos ao nosso complemento. A <span class="guilabel">Class name</span>  será o nome da classe Python contendo a lógica do plugin. Esta será também o nome da pasta que contém todos os arquivos do plugin. Digite <code class="docutils literal notranslate"><span class="pre">SaveAttributes</span></code> como o nome da classe. A <span class="guilabel">Plugin name</span> é o nome sob o qual o seu plugin será exibido no <span class="guilabel">Gerenciador de complementos</span>. Digite o nome como <code class="docutils literal notranslate"><span class="pre">Save</span> <span class="pre">Attributes</span></code>. Adicione uma descrição no campo  <span class="guilabel">Description</span>. O <span class="guilabel">Module name</span> será o nome do arquivo python principal para o plugin. Inseri-lo como <code class="docutils literal notranslate"><span class="pre">save_attributes</span></code>. Deixe os números de versão como estão. A <span class="guilabel">Text for menu item</span>  de menu será como os usuários vão encontrar o seu plugin no menu do QGIS. Inseri-lo como <code class="docutils literal notranslate"><span class="pre">Save</span> <span class="pre">Attributes</span> <span class="pre">as</span> <span class="pre">CSV</span></code>. Digite seu nome e endereço de e-mail nos campos apropriados. O campo <span class="guilabel">Menu</span>  vai decidir onde seu complemento será adicionado no QGIS. O nosso complemento é para dados vetoriais, selecione <code class="docutils literal notranslate"><span class="pre">Vector</span></code>. Verifique a caixa <span class="guilabel">Flag the plugin as experimental</span> na parte inferior. Clique em <span class="guilabel">OK`</span>.</p></li>
</ol>
<img alt="../_images/2128.png" class="align-center" src="../_images/2128.png" />
<ol class="arabic simple" start="3">
<li><p>Em seguida, você será solicitado a escolher um diretório para o seu plugin. Você precisa navegar para a pasta de complementos python do QGIS no seu computador e selecionar <span class="guilabel">Select Folder</span>. Normalmente, o diretório <code class="docutils literal notranslate"><span class="pre">.qgis2/</span></code> está localizado em seu diretório pessoal. O local da pasta <code class="docutils literal notranslate"><span class="pre">plugin</span></code> vai depender de sua plataforma como segue: (Substitua <code class="docutils literal notranslate"><span class="pre">username</span></code> com o seu nome de login)</p></li>
</ol>
<p><strong>Windows</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>c:\Users\username\.qgis2\python\plugins
</pre></div>
</div>
<p><strong>Mac</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/Users/username/.qgis2/python/plugins
</pre></div>
</div>
<p><strong>Linux</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/home/username/.qgis2/python/plugins
</pre></div>
</div>
<img alt="../_images/360.png" class="align-center" src="../_images/360.png" />
<ol class="arabic simple" start="4">
<li><p>Você verá um diálogo de confirmação uma vez que seu modelo de complemento for criado. Observe o caminho para a pasta do complemento.</p></li>
</ol>
<img alt="../_images/437.png" class="align-center" src="../_images/437.png" />
<ol class="arabic simple" start="5">
<li><p>Antes de podermos usar o complemento recém-criado, é preciso compilar o arquivo <code class="docutils literal notranslate"><span class="pre">resources.qrc</span></code> que foi criado pelo Plugin Builder. Inicie o :guilabel: <cite>OSGeo4W Shell</cite> em janelas ou em um terminal no Mac ou Linux.</p></li>
</ol>
<img alt="../_images/535.png" class="align-center" src="../_images/535.png" />
<ol class="arabic simple" start="6">
<li><p>Navegue até a pasta de complementos em que a saída do <code class="docutils literal notranslate"><span class="pre">Plugin</span> <span class="pre">Builder</span></code> foi criada. Você pode usar o comando <code class="docutils literal notranslate"><span class="pre">cd</span></code> seguido do caminho para o diretório.</p></li>
</ol>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cd c:\Users\username\.qgis2\python\plugins\SaveAttributes
</pre></div>
</div>
<img alt="../_images/634.png" class="align-center" src="../_images/634.png" />
<ol class="arabic simple" start="7">
<li><p>Uma vez que você está no diretório, tipo `` make``. Isto irá executar o comando `` pyrcc4`` que tínhamos instalado como parte de ligações Qt para Python.</p></li>
</ol>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>make
</pre></div>
</div>
<img alt="../_images/734.png" class="align-center" src="../_images/734.png" />
<ol class="arabic simple" start="8">
<li><p>Agora estamos prontos para ter um primeiro olhar para o novo complemento que criamos. Feche o QGIS e abra-o novamente. vá para <span class="menuselection">Plugins ‣ Gerenciar e instalar complementos</span> e permita que o complemento <code class="docutils literal notranslate"><span class="pre">Salvar</span> <span class="pre">Attributes</span></code> no <span class="guilabel">guia Installed</span>. Você vai notar que há um novo ícone na barra de ferramentas e uma nova entrada de menu em <span class="menuselection">Vector ‣ Save Atributos -&gt; Save Atributos como CSV`</span>. Selecione-o para iniciar o diálogo do complemento.</p></li>
</ol>
<img alt="../_images/833.png" class="align-center" src="../_images/833.png" />
<ol class="arabic simple" start="9">
<li><p>Você vai notar uma nova caixa de diálogo em branco chamada <span class="guilabel">Save Attributes</span>. Feche este diálogo.</p></li>
</ol>
<img alt="../_images/934.png" class="align-center" src="../_images/934.png" />
<ol class="arabic simple" start="10">
<li><p>Agora vamos projetar sua caixa de diálogo e adicionar alguns elementos da interface do usuário para ele. Abra o programa <code class="docutils literal notranslate"><span class="pre">Qt</span> <span class="pre">Creator</span></code> e  <span class="guilabel">File –&gt; Open File or Project…</span>.</p></li>
</ol>
<img alt="../_images/1041.png" class="align-center" src="../_images/1041.png" />
<ol class="arabic simple" start="11">
<li><p>Navegue até o diretório do complemento e selecione o arquivo <code class="docutils literal notranslate"><span class="pre">save_attributes_dialog_base.ui</span></code>. Clique em <span class="guilabel">Open</span>.</p></li>
</ol>
<img alt="../_images/1157.png" class="align-center" src="../_images/1157.png" />
<ol class="arabic simple" start="12">
<li><p>Você verá a caixa de diálogo em branco do plugin. Você pode arrastar e soltar elementos do painel do lado esquerdo da caixa de diálogo. Nós vamos adicionar um  <span class="guilabel">Combo Box</span> do tipo <span class="guilabel">Input Widget</span>. Arraste-o para a janela do complemento.</p></li>
</ol>
<img alt="../_images/1244.png" class="align-center" src="../_images/1244.png" />
<ol class="arabic simple" start="13">
<li><p>Redimensionar a caixa de combinação e ajuste seu tamanho. Agora arraste <span class="guilabel">Display Widget</span> no diálogo.</p></li>
</ol>
<img alt="../_images/1342.png" class="align-center" src="../_images/1342.png" />
<ol class="arabic simple" start="14">
<li><p>Clique no texto do rótulo e digite <code class="docutils literal notranslate"><span class="pre">Select</span> <span class="pre">a</span> <span class="pre">layer</span></code>.</p></li>
</ol>
<img alt="../_images/1439.png" class="align-center" src="../_images/1439.png" />
<ol class="arabic simple" start="15">
<li><p>Salve este arquivo, vá para  <span class="menuselection">File ‣ Save save_attributes_dialog_base.ui</span>. Observe que o nome do objeto da caixa de combinação é <code class="docutils literal notranslate"><span class="pre">comboBox</span></code>. Para interagir com este objeto usando o código python, teremos que se referir a ele por este nome.</p></li>
</ol>
<img alt="../_images/1537.png" class="align-center" src="../_images/1537.png" />
<ol class="arabic simple" start="16">
<li><p>Vamos recarregar nosso complemento para que possamos ver as mudanças na janela de diálogo. vá para <span class="menuselection">Plugin ‣ Plugin Reloader ‣ Choose a plugin to be reloaded</span>.</p></li>
</ol>
<img alt="../_images/1635.png" class="align-center" src="../_images/1635.png" />
<ol class="arabic simple" start="17">
<li><p>Selecione <code class="docutils literal notranslate"><span class="pre">SaveAttributes</span></code> no`diálogo  <span class="guilabel">Configure Plugin reloader</span>.</p></li>
</ol>
<img alt="../_images/1732.png" class="align-center" src="../_images/1732.png" />
<ol class="arabic simple" start="18">
<li><p>Agora clique no botão <span class="guilabel">Save Attributes as CSV</span>. Você verá a caixa de diálogo recém-projetada.</p></li>
</ol>
<img alt="../_images/1830.png" class="align-center" src="../_images/1830.png" />
<ol class="arabic simple" start="19">
<li><p>Vamos adicionar alguma lógica para o complemento que irá preencher a caixa de combinação com as camadas carregadas no QGIS. Vá para o diretório do complemento e carregue o arquivo <code class="docutils literal notranslate"><span class="pre">save_attributes.py</span></code> em um editor de texto. Role para baixo e encontre ométodo <code class="docutils literal notranslate"><span class="pre">run(self)</span></code>. Este método será chamado quando você clica no botão da barra de ferramentas ou seleciona o item de menu do complemento. Adicione o seguinte código no início do método. Este código obtém as camadas carregadas no QGIS e as adiciona para o objeto <code class="docutils literal notranslate"><span class="pre">comboBox</span></code> a partir do diálogo plugin.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">layers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">legendInterface</span><span class="p">()</span><span class="o">.</span><span class="n">layers</span><span class="p">()</span>
<span class="n">layer_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>
     <span class="n">layer_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">name</span><span class="p">())</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">comboBox</span><span class="o">.</span><span class="n">addItems</span><span class="p">(</span><span class="n">layer_list</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/1922.png" class="align-center" src="../_images/1922.png" />
<ol class="arabic simple" start="20">
<li><p>Volte na janela principal do QGIS, recarregue o complemento, vá para  <span class="menuselection">Plugins ‣ Plugin Reloader ‣ Reload plugin: SaveAttributes</span>. Alternativamente, você pode pressionar <kbd class="kbd docutils literal notranslate">F5</kbd>. Para testar essa nova funcionalidade, é preciso carregar algumas camadas no QGIS. Depois de carregar alguns dados, inicie o plugin, vá para <span class="menuselection">Vector ‣ Save Attributes ‣ Save Attributes as CSV</span>.</p></li>
</ol>
<img alt="../_images/2019.png" class="align-center" src="../_images/2019.png" />
<ol class="arabic simple" start="21">
<li><p>Você vai ver que a nossa caixa de combinação é agora preenchida com os nomes das camadas que estão carregadas no QGIS.</p></li>
</ol>
<img alt="../_images/2129.png" class="align-center" src="../_images/2129.png" />
<ol class="arabic simple" start="22">
<li><p>Vamos adicionar outros elementos de interface de usuário restantes. Alterne de volta para o <code class="docutils literal notranslate"><span class="pre">Qt</span> <span class="pre">Creator</span></code> e carregue o arquivo <code class="docutils literal notranslate"><span class="pre">save_attributes_dialog_base.ui</span></code>. Adicione um <code class="docutils literal notranslate"><span class="pre">Label</span></code> <span class="guilabel">Display Widget</span> e altere o texto para <code class="docutils literal notranslate"><span class="pre">Select</span> <span class="pre">output</span> <span class="pre">file</span></code>. Adicionar um <code class="docutils literal notranslate"><span class="pre">LineEdit</span></code> tipo <span class="guilabel">Input Widget</span> que irá mostrar o caminho do arquivo de saída que o usuário escolheu. Em seguida, adicione um <code class="docutils literal notranslate"><span class="pre">Push</span> <span class="pre">Button</span></code> tipo <span class="guilabel">Button</span>  e mude o rótulo do botão para <code class="docutils literal notranslate"><span class="pre">...</span></code>. Observe os nomes de objeto dos widgets que teremos de usar para interagir com eles. Salve o arquivo.</p></li>
</ol>
<img alt="../_images/2221.png" class="align-center" src="../_images/2221.png" />
<ol class="arabic simple" start="23">
<li><p>Vamos agora adicionar o código python para abrir um navegador de arquivos quando o usuário clicar no botão <code class="docutils literal notranslate"><span class="pre">...</span></code> e mostrar o caminho selecionado no widget. Abra o arquivo <code class="docutils literal notranslate"><span class="pre">save_attributes.py</span></code> em um editor de texto. Adicione <code class="docutils literal notranslate"><span class="pre">QFileDialog</span></code> à nossa lista de importações no topo do arquivo.</p></li>
</ol>
<img alt="../_images/2319.png" class="align-center" src="../_images/2319.png" />
<ol class="arabic simple" start="24">
<li><p>Adicione um novo método chamado <code class="docutils literal notranslate"><span class="pre">select_output_file</span></code> com o seguinte código. Este código irá abrir um navegador de arquivos e preencher a linha de edição com o caminho do arquivo que o usuário escolher.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">select_output_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="p">,</span> <span class="s2">&quot;Select output file &quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s1">&#39;*.txt&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/2419.png" class="align-center" src="../_images/2419.png" />
<ol class="arabic simple" start="25">
<li><p>Agora precisamos adicionar o código para que quando o botão <cite>…</cite> for clicado, o método <code class="docutils literal notranslate"><span class="pre">select_output_file</span></code> seja chamado. Role até o método <code class="docutils literal notranslate"><span class="pre">__init__</span></code> e adicione as seguintes linhas na parte inferior. Este código irá limpar o texto carregado anteriormente (se houver) na linha de edição e também conectar o método <code class="docutils literal notranslate"><span class="pre">select_output_file</span></code> ao sinal <code class="docutils literal notranslate"><span class="pre">clicked</span></code> do widget de botão.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">pushButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">select_output_file</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/2517.png" class="align-center" src="../_images/2517.png" />
<ol class="arabic simple" start="26">
<li><p>Volte no QGIS, recarregue o plugin e abra odiálogo <span class="guilabel">Save Attributes`</span>. Se tudo correu bem, você será capaz de clicar no botão <code class="docutils literal notranslate"><span class="pre">...</span></code> e selecionar um arquivo de texto de saída do seu disco.</p></li>
</ol>
<img alt="../_images/2615.png" class="align-center" src="../_images/2615.png" />
<ol class="arabic simple" start="27">
<li><p>Quando você clica em <span class="guilabel">OK</span> no diálogo do complemento, nada acontece. Isso é porque nós não adicionamos a lógica para puxar informações de atributos da camada e escrevê-lo para o arquivo de texto. Temos agora todas as peças no lugar para fazer exatamente isso. Encontre o lugar no método <code class="docutils literal notranslate"><span class="pre">run</span></code> onde se diz <code class="docutils literal notranslate"><span class="pre">pass</span></code>. Substitua-o com o código abaixo. A explicação para este código pode ser encontrada em <a class="reference internal" href="getting_started_with_pyqgis.html"><span class="doc">Começando a Programar com o Phyton</span></a>.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>

<span class="n">selectedLayerIndex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">comboBox</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
<span class="n">selectedLayer</span> <span class="o">=</span> <span class="n">layers</span><span class="p">[</span><span class="n">selectedLayerIndex</span><span class="p">]</span>
<span class="n">fields</span> <span class="o">=</span> <span class="n">selectedLayer</span><span class="o">.</span><span class="n">pendingFields</span><span class="p">()</span>
<span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">()</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">]</span>

<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">selectedLayer</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">():</span>
    <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">unicode</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fieldnames</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">unicode_line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">unicode_line</span><span class="p">)</span>
<span class="n">output_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/2715.png" class="align-center" src="../_images/2715.png" />
<ol class="arabic simple" start="28">
<li><p>Agora nosso complementoestá pronto. Recarregue o complemenbto e experimente-lo. Você vai descobrir que o arquivo de texto de saída que você escolheu terão os atributos da camada vetorial. Você pode fechar o diretório do complemento e compartilhá-lo com seus usuários. Eles podem descompactar o conteúdo do seu complemento e experimentar o seu complemento. Se este foi um verdadeiro complemento, você iria enviá-lo para o <a class="reference external" href="https://plugins.qgis.org/">QGIS Plugin Repository</a> de modo que todos os usuários do QGIS serão capazes de encontrar e fazer o download do plugin.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Este complemento é apenas para demonstração. Não publique este complemento ou envie-o para o repositório QGIS.</p>
</div>
<p>Abaixo está o arquivo <code class="docutils literal notranslate"><span class="pre">save_attributes.py</span></code> para tê-lo como uma referência.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">/***************************************************************************</span>
<span class="sd"> SaveAttributes</span>
<span class="sd">                                 A QGIS plugin</span>
<span class="sd"> This plugin saves the attribute of the selected vector layer as a CSV file.</span>
<span class="sd">                              -------------------</span>
<span class="sd">        begin                : 2015-04-20</span>
<span class="sd">        git sha              : $Format:%H$</span>
<span class="sd">        copyright            : (C) 2015 by Ujaval Gandhi</span>
<span class="sd">        email                : ujaval@spatialthoughts.com</span>
<span class="sd"> ***************************************************************************/</span>

<span class="sd">/***************************************************************************</span>
<span class="sd"> *                                                                         *</span>
<span class="sd"> *   This program is free software; you can redistribute it and/or modify  *</span>
<span class="sd"> *   it under the terms of the GNU General Public License as published by  *</span>
<span class="sd"> *   the Free Software Foundation; either version 2 of the License, or     *</span>
<span class="sd"> *   (at your option) any later version.                                   *</span>
<span class="sd"> *                                                                         *</span>
<span class="sd"> ***************************************************************************/</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">PyQt4.QtCore</span> <span class="kn">import</span> <span class="n">QSettings</span><span class="p">,</span> <span class="n">QTranslator</span><span class="p">,</span> <span class="n">qVersion</span><span class="p">,</span> <span class="n">QCoreApplication</span>
<span class="kn">from</span> <span class="nn">PyQt4.QtGui</span> <span class="kn">import</span> <span class="n">QAction</span><span class="p">,</span> <span class="n">QIcon</span><span class="p">,</span> <span class="n">QFileDialog</span>
<span class="c1"># Initialize Qt resources from file resources.py</span>
<span class="kn">import</span> <span class="nn">resources_rc</span>
<span class="c1"># Import the code for the dialog</span>
<span class="kn">from</span> <span class="nn">save_attributes_dialog</span> <span class="kn">import</span> <span class="n">SaveAttributesDialog</span>
<span class="kn">import</span> <span class="nn">os.path</span>


<span class="k">class</span> <span class="nc">SaveAttributes</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;QGIS Plugin Implementation.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iface</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor.</span>

<span class="sd">        :param iface: An interface instance that will be passed to this class</span>
<span class="sd">            which provides the hook by which you can manipulate the QGIS</span>
<span class="sd">            application at run time.</span>
<span class="sd">        :type iface: QgsInterface</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Save reference to the QGIS interface</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">iface</span>
        <span class="c1"># initialize plugin directory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plugin_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
        <span class="c1"># initialize locale</span>
        <span class="n">locale</span> <span class="o">=</span> <span class="n">QSettings</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;locale/userLocale&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">locale_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plugin_dir</span><span class="p">,</span>
            <span class="s1">&#39;i18n&#39;</span><span class="p">,</span>
            <span class="s1">&#39;SaveAttributes_</span><span class="si">{}</span><span class="s1">.qm&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">locale</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">locale_path</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">translator</span> <span class="o">=</span> <span class="n">QTranslator</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">translator</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">locale_path</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">qVersion</span><span class="p">()</span> <span class="o">&gt;</span> <span class="s1">&#39;4.3.3&#39;</span><span class="p">:</span>
                <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">installTranslator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">translator</span><span class="p">)</span>

        <span class="c1"># Create the dialog (after translation) and keep reference</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span> <span class="o">=</span> <span class="n">SaveAttributesDialog</span><span class="p">()</span>

        <span class="c1"># Declare instance attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;&amp;Save Attributes&#39;</span><span class="p">)</span>
        <span class="c1"># TODO: We are going to let the user set this up in a future iteration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">addToolBar</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;SaveAttributes&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;SaveAttributes&#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">pushButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">select_output_file</span><span class="p">)</span>
        

    <span class="c1"># noinspection PyMethodMayBeStatic</span>
    <span class="k">def</span> <span class="nf">tr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the translation for a string using Qt translation API.</span>

<span class="sd">        We implement this ourselves since we do not inherit QObject.</span>

<span class="sd">        :param message: String for translation.</span>
<span class="sd">        :type message: str, QString</span>

<span class="sd">        :returns: Translated version of message.</span>
<span class="sd">        :rtype: QString</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># noinspection PyTypeChecker,PyArgumentList,PyCallByClass</span>
        <span class="k">return</span> <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s1">&#39;SaveAttributes&#39;</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">add_action</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">icon_path</span><span class="p">,</span>
        <span class="n">text</span><span class="p">,</span>
        <span class="n">callback</span><span class="p">,</span>
        <span class="n">enabled_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">add_to_menu</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">add_to_toolbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">status_tip</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">whats_this</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a toolbar icon to the toolbar.</span>

<span class="sd">        :param icon_path: Path to the icon for this action. Can be a resource</span>
<span class="sd">            path (e.g. &#39;:/plugins/foo/bar.png&#39;) or a normal file system path.</span>
<span class="sd">        :type icon_path: str</span>

<span class="sd">        :param text: Text that should be shown in menu items for this action.</span>
<span class="sd">        :type text: str</span>

<span class="sd">        :param callback: Function to be called when the action is triggered.</span>
<span class="sd">        :type callback: function</span>

<span class="sd">        :param enabled_flag: A flag indicating if the action should be enabled</span>
<span class="sd">            by default. Defaults to True.</span>
<span class="sd">        :type enabled_flag: bool</span>

<span class="sd">        :param add_to_menu: Flag indicating whether the action should also</span>
<span class="sd">            be added to the menu. Defaults to True.</span>
<span class="sd">        :type add_to_menu: bool</span>

<span class="sd">        :param add_to_toolbar: Flag indicating whether the action should also</span>
<span class="sd">            be added to the toolbar. Defaults to True.</span>
<span class="sd">        :type add_to_toolbar: bool</span>

<span class="sd">        :param status_tip: Optional text to show in a popup when mouse pointer</span>
<span class="sd">            hovers over the action.</span>
<span class="sd">        :type status_tip: str</span>

<span class="sd">        :param parent: Parent widget for the new action. Defaults None.</span>
<span class="sd">        :type parent: QWidget</span>

<span class="sd">        :param whats_this: Optional text to show in the status bar when the</span>
<span class="sd">            mouse pointer hovers over the action.</span>

<span class="sd">        :returns: The action that was created. Note that the action is also</span>
<span class="sd">            added to self.actions list.</span>
<span class="sd">        :rtype: QAction</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">icon</span> <span class="o">=</span> <span class="n">QIcon</span><span class="p">(</span><span class="n">icon_path</span><span class="p">)</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="n">icon</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="n">action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>
        <span class="n">action</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">enabled_flag</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">status_tip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">action</span><span class="o">.</span><span class="n">setStatusTip</span><span class="p">(</span><span class="n">status_tip</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">whats_this</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">action</span><span class="o">.</span><span class="n">setWhatsThis</span><span class="p">(</span><span class="n">whats_this</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">add_to_toolbar</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">add_to_menu</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">addPluginToVectorMenu</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">menu</span><span class="p">,</span>
                <span class="n">action</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">action</span>

    <span class="k">def</span> <span class="nf">initGui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create the menu entries and toolbar icons inside the QGIS GUI.&quot;&quot;&quot;</span>

        <span class="n">icon_path</span> <span class="o">=</span> <span class="s1">&#39;:/plugins/SaveAttributes/icon.png&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_action</span><span class="p">(</span>
            <span class="n">icon_path</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;Save Attributes as CSV&#39;</span><span class="p">),</span>
            <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">,</span>
            <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">())</span>


    <span class="k">def</span> <span class="nf">unload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Removes the plugin menu item and icon from QGIS GUI.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">removePluginVectorMenu</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;&amp;Save Attributes&#39;</span><span class="p">),</span>
                <span class="n">action</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">removeToolBarIcon</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="c1"># remove the toolbar</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span>

    <span class="k">def</span> <span class="nf">select_output_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="p">,</span> <span class="s2">&quot;Select output file &quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s1">&#39;*.txt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run method that performs all the real work&quot;&quot;&quot;</span>
        <span class="n">layers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">legendInterface</span><span class="p">()</span><span class="o">.</span><span class="n">layers</span><span class="p">()</span>
        <span class="n">layer_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>
                <span class="n">layer_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">name</span><span class="p">())</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">comboBox</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">comboBox</span><span class="o">.</span><span class="n">addItems</span><span class="p">(</span><span class="n">layer_list</span><span class="p">)</span>
        <span class="c1"># show the dialog</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="c1"># Run the dialog event loop</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
        <span class="c1"># See if OK was pressed</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
            <span class="c1"># Do something useful here - delete the line containing pass and</span>
            <span class="c1"># substitute with your code.</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">lineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="n">output_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
           
            <span class="n">selectedLayerIndex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">comboBox</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
            <span class="n">selectedLayer</span> <span class="o">=</span> <span class="n">layers</span><span class="p">[</span><span class="n">selectedLayerIndex</span><span class="p">]</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="n">selectedLayer</span><span class="o">.</span><span class="n">pendingFields</span><span class="p">()</span>
            <span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">()</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">]</span>
            
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">selectedLayer</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">():</span>
                <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">unicode</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fieldnames</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">unicode_line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
                <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">unicode_line</span><span class="p">)</span>
            <span class="n">output_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>





  <div id="disqus_thread"></div>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


    </div>
      
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2021, Ujaval Gandhi.<br/>
      Última atualização em ago. 30, 2022.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.0.1.<br/>
    </p>
  </div>
</footer>
<div class="container">
  <p>This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/deed.en_US">Creative Commons Attribution 4.0 International License</a></p>
</div>
<!-- Twitter Button -->
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<!-- Disqus comments widget -->
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'qgistutorials'; // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  }());
</script>

<script type="text/javascript">
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

<!-- Script fpr language switching. Largely adapted from https://github.com/pcav/faunalia-website -->
<script>
    var currentPage = 'docs/building_a_python_plugin.html'; // coming from sphinx, always without starting '/'
    var currentLang = 'en';
    $(document).ready(function(){

        var search = new RegExp('\/[a-zA-Z_]{2,8}\/'+ currentPage, 'gi');
        var langPlusPage = window.location.href.match(search);
        // it's possible this is a index.html page called without 'index.html', try without the currentPage
        if (langPlusPage==undefined){
            search = new RegExp('\/[a-zA-Z_]{2,8}\/$', 'gi');
            langPlusPage = window.location.href.match(search);
        }

        // it's possible this is an index.html page called without 'index.html', try removing index.html
        if (langPlusPage==undefined){
            currentPage = currentPage.replace('index.html','')
            search = new RegExp('\/[a-zA-Z_]{2,8}\/'+ currentPage, 'gi');
            langPlusPage = window.location.href.match(search);
        }
        // still no langPlugPage: stop, because the language swicher will misbehave 

        if (langPlusPage == undefined || langPlusPage.length != 1){
            alert('You hit an error, please report back to us.');
            return;
        }
        langPlusPage = langPlusPage[0];
        currentLang = langPlusPage.replace(currentPage, '');

        $("#languages").val(currentLang.replace(/\//g,'')); // currentLang is something like '/nl/'

        $("#languages").change(function() {
            gotoLang($(this).val());
        });

    });

    // load current page in a different language
    function gotoLang(lang){
        var currentUrl = window.location.href;
        var newUrl = currentUrl.replace(currentLang, '/'+lang+'/');
        window.location.href = newUrl;
    }
</script>

  </body>
</html>