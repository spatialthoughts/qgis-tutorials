<!DOCTYPE html>

<html lang="sr" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Pisanje Pajton skripti za okvir za obradu (QGIS3) &#8212; QGIS Tutorials and Tips</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/bootstrap-sphinx.css?v=0bf093e7" />
    <script src="../../_static/documentation_options.js?v=7e8936b6"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/translations.js?v=552f857c"></script>
    <link rel="search" title="Претрага" href="../../search.html" />
    <link rel="next" title="Kreiranje dodatka za Pajton (QGIS3)" href="building_a_python_plugin.html" />
    <link rel="prev" title="Korišćenje prilagođenih Pajton izraznih funkcija (QGIS3)" href="custom_python_functions.html" />

<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../../_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>


<!-- Cookie Notice -->
<!-- Script from https://github.com/AOEpeople/cookie-notice -->
<script type="text/javascript" src="../../_static/cookie.notice.min.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-B1WQ7B80XJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-B1WQ7B80XJ');
</script>


  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          QGIS Tutorials and Tips</a>
        <span class="navbar-text navbar-version pull-left"><b>v1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Tutorials List <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Uvod</a></li>
<li class="toctree-l1"><a class="reference internal" href="making_a_map.html">Pravljenje mape (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="working_with_attributes.html">Rad sa atributima (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="importing_spreadsheets_csv.html">Uvoz tabela ili CSV datoteka (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic_vector_styling.html">Osnovno stilizovanje vektora (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="calculating_line_lengths.html">Izračunavanje dužina linija i statistika (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="raster_styling_and_analysis.html">Osnovno stilizovanje i analiza rastera (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="raster_mosaicing_and_clipping.html">Rastersko mozaičko kreiranje i isecanje (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="working_with_terrain.html">Rad sa podacima o terenu (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="working_with_wms.html">Rad sa WMS podacima (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="working_with_projections.html">Rad sa projekcijama (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="georeferencing_basics.html">Georeferenciranje topografskih listova i skeniranih mapa (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced_georeferencing.html">Georeferenciranje aerosnimaka (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="digitizing_basics.html">Digitalizacija podataka mapa (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="performing_table_joins.html">Spajanje tabela (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="performing_spatial_joins.html">Izvršavanje prostornih spajanja (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="performing_spatial_queries.html">Izvršavanje prostornih upita (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="nearest_neighbor_analysis.html">Analiza najbližeg suseda (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="sampling_raster_data.html">Uzorkovanje rasterskih podataka korišćenjem tačaka ili poligona (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="calculating_raster_area.html">Izračunavanje površine rastera (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="creating_heatmaps.html">Kreiranje toplotnih mapa (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="animating_time_series.html">Animiranje podataka vremenskih serija (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="handling_invalid_geometries.html">Rukovanje nevažećim geometrijama (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced_raster_analysis.html">Napredna rasterska analiza (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="interpolating_point_data.html">Interpoliranje podataka o tačkama (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="batch_processing.html">Paketna obrada pomoću okvira za obradu (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="processing_graphical_modeler.html">Automatizacija složenih tokova rada pomoću Processing Modeler-a (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="automating_map_creation.html">Automatizacija kreiranja mapa pomoću Atlasa za štampanje (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="multi_criteria_overlay.html">Analiza višekriterijumskog preklapanja (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="vector_styling_expressions.html">Osnovno filtriranje i stilizovanje pomoću izraza (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="block_world_styling.html">Kreiranje mape sveta u bloku (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="river_styling_expressions.html">Stilizovanje rečne mreže pomoću izraza (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="contour_3d_styling.html">Stilizovanje kontura u 3D (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="isometric_buildings.html">Kreiranje izometrijskih zgrada (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="interactive_canvas_maps.html">Izrada interaktivnih mapa na platnu (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="interactive_reveal_maps.html">Izrada interaktivnih mapa otkrivanja (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="cartogram_animation.html">Kreiranje animiranog kartograma (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic_network_analysis.html">Osnovna vizuelizacija i rutiranje mreže (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="origin_destination_matrix.html">Lociranje najbližeg objekta pomoću matrice porekla i odredišta (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="service_area_analysis.html">Analiza područja usluge korišćenjem Openrouteservice (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="travel_time_analysis.html">Analiza vremena putovanja pomoću Uber kretanja (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="areal_mean_rainfall.html">Izračunavanje srednje površinske količine padavina (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="colorized_river_basin_map.html">Kreiranje karte rečnog sliva u boji (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="creating_landuse_map.html">Kreiranje mape korišćenja zemljišta (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="calculating_intersection_density.html">Izračunavanje gustine raskrsnica ulica (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="landuse_buffer.html">Određivanje zaštitnih zona korišćenja zemljišta (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="solidwaste_mapping.html">Mapiranje količina odloženog otpada (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started_with_pyqgis.html">Početak programiranja u Pajtonu (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="processing_algorithms_pyqgis.html">Pokretanje algoritama za obradu putem Pajtona (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom_python_functions.html">Korišćenje prilagođenih Pajton izraznih funkcija (QGIS3)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Pisanje Pajton skripti za okvir za obradu (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="building_a_python_plugin.html">Kreiranje dodatka za Pajton (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="processing_python_plugin.html">Izrada dodatka za obradu (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../running_qgis_jobs.html">Pokretanje i zakazivanje QGIS zadataka obrade</a></li>
<li class="toctree-l1"><a class="reference internal" href="web_mapping_with_qgis2web.html">Veb mapiranje pomoću QGIS2Web (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../creating_basemaps_with_qtiles.html">Kreiranje osnovnih mapa pomoću QTiles-a</a></li>
<li class="toctree-l1"><a class="reference internal" href="using_plugins.html">Korišćenje dodataka (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../downloading_osm_data.html">Pretraživanje i preuzimanje podataka OpenStreetMap-a</a></li>
<li class="toctree-l1"><a class="reference internal" href="../learning_resources.html">QGIS resursi za učenje</a></li>
<li class="toctree-l1"><a class="reference internal" href="../credits.html">Krediti za podatke</a></li>
<li class="toctree-l1"><a class="reference internal" href="../batch_processing.html">Paketna obrada pomoću Processing Framework-a (QGIS2)</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="custom_python_functions.html" title="Previous Chapter: Korišćenje prilagođenih Pajton izraznih funkcija (QGIS3)"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Korišćenje p...</span>
    </a>
  </li>
  <li>
    <a href="building_a_python_plugin.html" title="Next Chapter: Kreiranje dodatka za Pajton (QGIS3)"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Kreiranje dod... &raquo;</span>
    </a>
  </li>
              
            
            

            

            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><h4>Author</h4>
<p><a href="https://www.linkedin.com/in/spatialthoughts/"><img src="../../_static/ujaval.png">Ujaval Gandhi</a></p>

<hr>
<p>Want to learn QGIS in a structured way? Check out <a href="https://spatialthoughts.com/" target="_blank">Spatial Thoughts</a> for more learning materials and instructor-led online programs with QGIS.org certification.</p>

<hr>
<p>These tutorials are also available in many other languages. Please see <a href="https://www.qgistutorials.com/en/docs/introduction.html#translations" target="_blank">translations</a> page.
</p>
        </div>
      </div>
    <div class="body col-md-9 content" role="main">
      

  <section id="writing-python-scripts-for-processing-framework-qgis3">
<h1>Pisanje Pajton skripti za okvir za obradu (QGIS3)<a class="headerlink" href="#writing-python-scripts-for-processing-framework-qgis3" title="Link to this heading">¶</a></h1>
<p>Moguće je pisati samostalne pyqgis skripte koje se mogu pokrenuti preko Python konzole u QGIS-u. Uz nekoliko podešavanja, možete naterati svoje samostalne skripte da se pokreću preko Processing Framework-a. Ovo ima nekoliko prednosti. Prvo, uzimanje korisničkog unosa i pisanje izlaznih datoteka je mnogo lakše jer Processing Framework nudi standardizovani korisnički interfejs za njih. Drugo, prisustvo vaše skripte u Processing Toolbox-u joj takođe omogućava da bude deo bilo kog modela obrade ili da se pokreće kao paketni zadatak sa više unosa. Ovaj tutorijal će pokazati kako napisati prilagođenu python skriptu koja može biti deo Processing Framework-a u QGIS-u.</p>
<div class="admonition note">
<p class="admonition-title">Белешка</p>
<p>API za obradu je potpuno redizajniran u QGIS3. Molimo pogledajte <a class="reference external" href="https://raw.githubusercontent.com/qgis/QGIS/master/doc/porting_processing.dox">ovaj vodič</a> za najbolje prakse i savete.</p>
</div>
<section id="overview-of-the-task">
<h2>Pregled zadatka<a class="headerlink" href="#overview-of-the-task" title="Link to this heading">¶</a></h2>
<p>Naš skript će izvršiti operaciju rastvoravanja na osnovu polja koje je korisnik izabrao. Takođe će sumirati vrednosti drugog polja za rastvorene karakteristike. U primeru, rastvorićemo svetski shapefile na osnovu atributa „CONTINENT“ i sumirati polje „POP_EST“ da bismo izračunali ukupnu populaciju u rastvorenom regionu.</p>
</section>
<section id="get-the-data">
<h2>Dobijte podatke<a class="headerlink" href="#get-the-data" title="Link to this heading">¶</a></h2>
<p>Koristićemo skup podataka <a class="reference external" href="https://www.naturalearthdata.com/downloads/10m-cultural-vectors/10m-admin-0-countries/">Admin 0 - Countries</a> iz Natural Earth-a.</p>
<p>Preuzmite datoteku <a class="reference external" href="https://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/cultural/ne_10m_admin_0_countries.zip">Admin 0 - countries shapefile.</a>.</p>
<p>Izvor podataka <a class="reference internal" href="../credits.html#naturalearth" id="id1"><span>[NATURALEARTH]</span></a></p>
<p>Radi lakšeg snalaženja, možete direktno preuzeti geopaket koji sadrži gornji sloj odozdo:</p>
<p><a class="reference external" href="https://www.qgistutorials.com/downloads/ne_global.gpkg">ne_global.gpkg</a></p>
</section>
<section id="procedure">
<h2>Procedura<a class="headerlink" href="#procedure" title="Link to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>U QGIS panelu pregledača, pronađite direktorijum u koji ste sačuvali preuzete podatke. Proširite datoteku <code class="docutils literal notranslate"><span class="pre">zip</span></code> ili <code class="docutils literal notranslate"><span class="pre">gpkg</span></code> i izaberite sloj <code class="docutils literal notranslate"><span class="pre">ne_10m_admin_0_countries</span></code>. Prevucite sloj na platno.</p></li>
</ol>
<img alt="../../_images/1146.png" class="align-center" src="../../_images/1146.png" />
<ol class="arabic simple" start="2">
<li><p>Idite na <span class="menuselection">Obrada ‣ Alatke</span>. Kliknite na dugme <span class="guilabel">Skripte</span> u traci sa alatkama i izaberite <span class="guilabel">Kreiraj novu skriptu iz šablona</span>.</p></li>
</ol>
<img alt="../../_images/2125.png" class="align-center" src="../../_images/2125.png" />
<ol class="arabic simple" start="3">
<li><p>Šablon sadrži sav osnovni kod koji je potreban da bi ga Processing Framework prepoznao kao skriptu za obradu i upravljao ulazima/izlazima. Hajde da počnemo sa prilagođavanjem primernog šablona našim potrebama. Prvo promenite naziv klase iz <code class="docutils literal notranslate"><span class="pre">ExampleProcessingAlgorithm</span></code> u <code class="docutils literal notranslate"><span class="pre">DissolveProcessingAlgorithm</span></code>. Ovo ime takođe treba ažurirati u metodi <code class="docutils literal notranslate"><span class="pre">createInstance</span></code>. Dodajte dokumentacioni string klasi koji objašnjava šta algoritam radi.</p></li>
</ol>
<img alt="../../_images/360.png" class="align-center" src="../../_images/360.png" />
<ol class="arabic simple" start="4">
<li><p>Kako se pomerate nadole, videćete metode koje dodeljuju ime, grupu, opis itd. skripti. Promenite povratne vrednosti za metod <em>name</em> na <code class="docutils literal notranslate"><span class="pre">dissolve_with_sum</span></code>, metod <em>displayName</em> na <code class="docutils literal notranslate"><span class="pre">Dissolve</span> <span class="pre">with</span> <span class="pre">Sum</span></code>, metod <em>group</em> i metod <em>groupId</em> na <code class="docutils literal notranslate"><span class="pre">scripts</span></code>. Promenite povratnu vrednost metode <em>shortHelpString</em> na opis koji će se prikazati korisniku. Kliknite na dugme <span class="guilabel">Sačuvaj</span>.</p></li>
</ol>
<img alt="../../_images/434.png" class="align-center" src="../../_images/434.png" />
<ol class="arabic simple" start="5">
<li><p>Nazovite skriptu <code class="docutils literal notranslate"><span class="pre">dissolve_with_sum</span></code> i sačuvajte je na podrazumevanoj lokaciji u folderu <span class="menuselection">profiles ‣ default ‣ processing ‣ scripts</span>.</p></li>
</ol>
<img alt="../../_images/530.png" class="align-center" src="../../_images/530.png" />
<ol class="arabic simple" start="6">
<li><p>Sada ćemo definisati ulaze za skriptu. Šablon već sadrži definiciju vektorskog sloja „INPUT“ i sloja „OUTPUT“. Dodaćemo 2 nova ulaza koja omogućavaju korisniku da izabere „DISSOLVE_FIELD“ i „SUM_FIELD“. Dodajte novi uvoz na vrhu i sledeći kod u metodi „initAlgorithm“. Kliknite na dugme <span class="guilabel">Run</span> da biste pregledali promene.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="n">QgsProcessingParameterField</span>

<span class="bp">self</span><span class="o">.</span><span class="n">addParameter</span><span class="p">(</span>
        <span class="n">QgsProcessingParameterField</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">DISSOLVE_FIELD</span><span class="p">,</span>
                <span class="s1">&#39;Choose Dissolve Field&#39;</span><span class="p">,</span>
                <span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">INPUT</span><span class="p">))</span>

<span class="bp">self</span><span class="o">.</span><span class="n">addParameter</span><span class="p">(</span>
        <span class="n">QgsProcessingParameterField</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">SUM_FIELD</span><span class="p">,</span>
                <span class="s1">&#39;Choose Sum Field&#39;</span><span class="p">,</span>
                <span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">INPUT</span><span class="p">))</span>
</pre></div>
</div>
<img alt="../../_images/6a.png" class="align-center" src="../../_images/6a.png" />
<img alt="../../_images/6b.png" class="align-center" src="../../_images/6b.png" />
<ol class="arabic simple" start="7">
<li><p>Videćete dijalog <span class="guilabel">Dissolve with Sum</span> sa našim novodefinisanim ulazima. Izaberite sloj <code class="docutils literal notranslate"><span class="pre">ne_10m_admin_0_countries</span></code> kao <span class="guilabel">Input layer`</span>. Pošto su i <span class="guilabel">Dissolve Field</span> i <span class="guilabel">Sum Fields</span> filtrirani na osnovu ulaznog sloja, biće unapred popunjeni postojećim poljima iz ulaznog sloja. Kliknite na dugme <span class="guilabel">Close</span>.</p></li>
</ol>
<img alt="../../_images/729.png" class="align-center" src="../../_images/729.png" />
<ol class="arabic simple" start="8">
<li><p>Sada definišemo našu prilagođenu logiku za obradu podataka u metodi <code class="docutils literal notranslate"><span class="pre">processAlgorithm</span></code>. Ovoj metodi se prosleđuje rečnik pod nazivom <code class="docutils literal notranslate"><span class="pre">parameters</span></code>. On sadrži ulaze koje je korisnik izabrao. Postoje pomoćne metode koje vam omogućavaju da uzmete ove ulaze i kreirate odgovarajuće objekte. Prvo dobijamo naše ulaze koristeći metode <code class="docutils literal notranslate"><span class="pre">parameterAsSource</span></code> i <code class="docutils literal notranslate"><span class="pre">parameterAsString</span></code>. Zatim želimo da kreiramo stok karakteristika gde ćemo pisati izlaz. QGIS3 ima novu klasu pod nazivom <code class="docutils literal notranslate"><span class="pre">QgsFeatureSink</span></code>, što je preferirani način za kreiranje objekata koji mogu da prihvate nove karakteristike. Izlazu su potrebna samo 2 polja - jedno za vrednost rastvorenog polja i drugo za zbir izabranog polja.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">PyQt5.QtCore</span> <span class="kn">import</span> <span class="n">QVariant</span>
<span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="n">QgsField</span><span class="p">,</span> <span class="n">QgsFields</span>

<span class="n">source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterAsSource</span><span class="p">(</span>
        <span class="n">parameters</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">INPUT</span><span class="p">,</span>
        <span class="n">context</span><span class="p">)</span>
<span class="n">dissolve_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterAsString</span><span class="p">(</span>
        <span class="n">parameters</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DISSOLVE_FIELD</span><span class="p">,</span>
        <span class="n">context</span><span class="p">)</span>
<span class="n">sum_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterAsString</span><span class="p">(</span>
        <span class="n">parameters</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SUM_FIELD</span><span class="p">,</span>
        <span class="n">context</span><span class="p">)</span>

<span class="n">fields</span> <span class="o">=</span> <span class="n">QgsFields</span><span class="p">()</span>
<span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QgsField</span><span class="p">(</span><span class="n">dissolve_field</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">String</span><span class="p">))</span>
<span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QgsField</span><span class="p">(</span><span class="s1">&#39;SUM_&#39;</span> <span class="o">+</span> <span class="n">sum_field</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">Double</span><span class="p">))</span>

<span class="p">(</span><span class="n">sink</span><span class="p">,</span> <span class="n">dest_id</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterAsSink</span><span class="p">(</span>
        <span class="n">parameters</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">OUTPUT</span><span class="p">,</span>
        <span class="n">context</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">source</span><span class="o">.</span><span class="n">wkbType</span><span class="p">(),</span> <span class="n">source</span><span class="o">.</span><span class="n">sourceCrs</span><span class="p">())</span>
</pre></div>
</div>
<img alt="../../_images/8a.png" class="align-center" src="../../_images/8a.png" />
<img alt="../../_images/8b.png" class="align-center" src="../../_images/8b.png" />
<ol class="arabic simple" start="9">
<li><p>Sada ćemo pripremiti ulazne funkcije i kreirati rečnik koji će čuvati jedinstvene vrednosti iz polja za rastvaranje - dissolve_field i zbir vrednosti iz polja za sumu - sum_field. Obratite pažnju na upotrebu metode „feedback.pushInfo()“ za komunikaciju statusa sa korisnikom.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">feedback</span><span class="o">.</span><span class="n">pushInfo</span><span class="p">(</span><span class="s1">&#39;Extracting unique values from dissolve_field and computing sum&#39;</span><span class="p">)</span>

<span class="n">features</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">()</span>
<span class="n">unique_values</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">dissolve_field</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">features</span><span class="p">)</span>

<span class="c1"># Get Indices of dissolve field and sum field</span>
<span class="n">dissolveIdx</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">fields</span><span class="p">()</span><span class="o">.</span><span class="n">indexFromName</span><span class="p">(</span><span class="n">dissolve_field</span><span class="p">)</span>
<span class="n">sumIdx</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">fields</span><span class="p">()</span><span class="o">.</span><span class="n">indexFromName</span><span class="p">(</span><span class="n">sum_field</span><span class="p">)</span>

<span class="c1"># Find all unique values for the given dissolve_field and</span>
<span class="c1"># sum the corresponding values from the sum_field</span>
<span class="n">sum_unique_values</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">attrs</span> <span class="o">=</span> <span class="p">[{</span><span class="n">dissolve_field</span><span class="p">:</span> <span class="n">f</span><span class="p">[</span><span class="n">dissolveIdx</span><span class="p">],</span> <span class="n">sum_field</span><span class="p">:</span> <span class="n">f</span><span class="p">[</span><span class="n">sumIdx</span><span class="p">]}</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">source</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">()]</span>
<span class="k">for</span> <span class="n">unique_value</span> <span class="ow">in</span> <span class="n">unique_values</span><span class="p">:</span>
        <span class="n">val_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">f_attr</span><span class="p">[</span><span class="n">sum_field</span><span class="p">]</span> <span class="k">for</span> <span class="n">f_attr</span> <span class="ow">in</span> <span class="n">attrs</span> <span class="k">if</span> <span class="n">f_attr</span><span class="p">[</span><span class="n">dissolve_field</span><span class="p">]</span> <span class="o">==</span> <span class="n">unique_value</span><span class="p">]</span>
        <span class="n">sum_unique_values</span><span class="p">[</span><span class="n">unique_value</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">val_list</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/929.png" class="align-center" src="../../_images/929.png" />
<ol class="arabic simple" start="10">
<li><p>Zatim ćemo pozvati ugrađeni algoritam za obradu <code class="docutils literal notranslate"><span class="pre">native:dissolve</span></code> na ulaznom sloju da bismo generisali rastvorene geometrije. Kada dobijemo rastvorene geometrije, iteriramo kroz izlaz algoritma za rastvorivanje i kreiramo nove karakteristike koje će biti dodate izlazu. Na kraju vraćamo <code class="docutils literal notranslate"><span class="pre">dest_id</span></code> FeatureSink kao izlaz. Sada je skripta spremna. Kliknite na dugme <span class="guilabel">Run</span>.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Белешка</p>
<p>Obratite pažnju na upotrebu „parameters[self.INPUT]“ za direktno preuzimanje ulaznog sloja iz rečnika parametara, bez definisanja istog kao izvora. Pošto prosleđujemo ulazni objekat algoritmu bez ikakve radnje sa njim, nije potrebno definisati ga kao izvor.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="n">QgsFeature</span>

<span class="c1"># Running the processing dissolve algorithm</span>
<span class="n">feedback</span><span class="o">.</span><span class="n">pushInfo</span><span class="p">(</span><span class="s1">&#39;Dissolving features&#39;</span><span class="p">)</span>
<span class="n">dissolved_layer</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;native:dissolve&quot;</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">&#39;INPUT&#39;</span><span class="p">:</span> <span class="n">parameters</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">INPUT</span><span class="p">],</span>
        <span class="s1">&#39;FIELD&#39;</span><span class="p">:</span> <span class="n">dissolve_field</span><span class="p">,</span>
        <span class="s1">&#39;OUTPUT&#39;</span><span class="p">:</span> <span class="s1">&#39;memory:&#39;</span>
        <span class="p">},</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span> <span class="n">feedback</span><span class="o">=</span><span class="n">feedback</span><span class="p">)[</span><span class="s1">&#39;OUTPUT&#39;</span><span class="p">]</span>

<span class="c1"># Read the dissolved layer and create output features</span>
<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">dissolved_layer</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">():</span>
        <span class="n">new_feature</span> <span class="o">=</span>  <span class="n">QgsFeature</span><span class="p">()</span>
        <span class="c1"># Set geometry to dissolved geometry</span>
        <span class="n">new_feature</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">geometry</span><span class="p">())</span>
        <span class="c1"># Set attributes from sum_unique_values dictionary that we had computed</span>
        <span class="n">new_feature</span><span class="o">.</span><span class="n">setAttributes</span><span class="p">([</span><span class="n">f</span><span class="p">[</span><span class="n">dissolve_field</span><span class="p">],</span> <span class="n">sum_unique_values</span><span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="n">dissolve_field</span><span class="p">]]])</span>
        <span class="n">sink</span><span class="o">.</span><span class="n">addFeature</span><span class="p">(</span><span class="n">new_feature</span><span class="p">,</span> <span class="n">QgsFeatureSink</span><span class="o">.</span><span class="n">FastInsert</span><span class="p">)</span>

<span class="k">return</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">OUTPUT</span><span class="p">:</span> <span class="n">dest_id</span><span class="p">}</span>
</pre></div>
</div>
<img alt="../../_images/10a.png" class="align-center" src="../../_images/10a.png" />
<img alt="../../_images/10b.png" class="align-center" src="../../_images/10b.png" />
<ol class="arabic simple" start="11">
<li><p>U dijalogu <span class="guilabel">Dissolve with Sum</span>, izaberite <code class="docutils literal notranslate"><span class="pre">ne_10m_admin_0_countries</span></code> kao <span class="guilabel">Ulazni sloj</span>, <code class="docutils literal notranslate"><span class="pre">CONTINENT</span></code> kao <span class="guilabel">Polje za rastvorivanje</span> i <code class="docutils literal notranslate"><span class="pre">POP_EST</span></code> kao <span class="guilabel">Polje za sumiranje</span>. Kliknite na <span class="guilabel">Pokreni</span>.</p></li>
</ol>
<img alt="../../_images/1147.png" class="align-center" src="../../_images/1147.png" />
<ol class="arabic simple" start="12">
<li><p>Kada je obrada završena, kliknite na dugme <span class="guilabel">Zatvori</span> i prebacite se na glavni QGIS prozor.</p></li>
</ol>
<img alt="../../_images/1238.png" class="align-center" src="../../_images/1238.png" />
<ol class="arabic simple" start="13">
<li><p>Videćete rastvoreni izlazni sloj sa po jednom karakteristikom za svaki kontinent i ukupnom populacijom sabranom iz pojedinačnih zemalja koje pripadaju tom kontinentu.</p></li>
</ol>
<img alt="../../_images/1336.png" class="align-center" src="../../_images/1336.png" />
<ol class="arabic simple" start="14">
<li><p>Još jedna prednost pisanja skripte za obradu je to što su metode unutar Processing Framework-a svesne izbora sloja i automatski filtriraju vaše ulaze da bi koristile samo odabrane karakteristike. To se dešava zato što definišemo naš ulaz kao „QgsProcessingParameterFeatureSource“. Izvor karakteristika omogućava korišćenje BILO KOJEG objekta koji sadrži vektorske karakteristike, ne samo vektorskog sloja, tako da kada postoje odabrane karakteristike u vašem sloju i zatražite od Processing-a da koristi odabrane karakteristike, ulaz se prosleđuje vašem skriptu kao objekat „QgsProcessingFeatureSource“ koji sadrži odabrane karakteristike, a ne ceo vektorski sloj. Evo kratke demonstracije ove funkcionalnosti. Recimo da želimo da rastvorimo samo određene kontinente. Hajde da napravimo izbor koristeći alatku <span class="guilabel">Izaberi karakteristiku pomoću izraza</span>.</p></li>
</ol>
<img alt="../../_images/1433.png" class="align-center" src="../../_images/1433.png" />
<ol class="arabic simple" start="15">
<li><p>Unesite sledeći izraz da biste izabrali obeležja iz Severne i Južne Amerike i kliknite na <span class="guilabel">Izaberi</span>.</p></li>
</ol>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&quot;CONTINENT&quot; = &#39;North America&#39; OR &quot;CONTINENT&quot; = &#39;South America&#39;
</pre></div>
</div>
<img alt="../../_images/1529.png" class="align-center" src="../../_images/1529.png" />
<ol class="arabic simple" start="16">
<li><p>Videćete izabrane karakteristike označene žutom bojom. Pronađite skriptu „dissolve_with_sum“ i dvaput kliknite na nju da biste je pokrenuli.</p></li>
</ol>
<img alt="../../_images/1627.png" class="align-center" src="../../_images/1627.png" />
<ol class="arabic simple" start="17">
<li><p>U dijalogu <span class="guilabel">Dissolve with Sum</span>, izaberite <code class="docutils literal notranslate"><span class="pre">ne_10m_admin_0_countries</span></code> kao <span class="guilabel">Input layer</span>. Ovaj put, obavezno označite polje <span class="guilabel">Samo selected features</span>. Izaberite <code class="docutils literal notranslate"><span class="pre">SUBREGION</span></code> kao <span class="guilabel">Dissolve field</span> i <code class="docutils literal notranslate"><span class="pre">POP_EST</span></code> kao <span class="guilabel">Sum field</span>.</p></li>
</ol>
<img alt="../../_images/1729.png" class="align-center" src="../../_images/1729.png" />
<ol class="arabic simple" start="18">
<li><p>Kada se obrada završi, kliknite na <span class="guilabel">Zatvori</span> i vratite se na glavni QGIS prozor. Primetićete novi sloj sa samo odabranim objekatima rastvorenim. Kliknite na dugme <span class="guilabel">Identifikuj</span> i kliknite na objekat da biste proverili i potvrdili da je skripta ispravno radila.</p></li>
</ol>
<img alt="../../_images/1825.png" class="align-center" src="../../_images/1825.png" />
<p>Ispod je kompletan skript za referencu. Možete ga izmeniti prema svojim potrebama.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">***************************************************************************</span>
<span class="sd">*                                                                         *</span>
<span class="sd">*   This program is free software; you can redistribute it and/or modify  *</span>
<span class="sd">*   it under the terms of the GNU General Public License as published by  *</span>
<span class="sd">*   the Free Software Foundation; either version 2 of the License, or     *</span>
<span class="sd">*   (at your option) any later version.                                   *</span>
<span class="sd">*                                                                         *</span>
<span class="sd">***************************************************************************</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">PyQt5.QtCore</span> <span class="kn">import</span> <span class="n">QCoreApplication</span><span class="p">,</span> <span class="n">QVariant</span>
<span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="p">(</span><span class="n">QgsProcessing</span><span class="p">,</span>
                       <span class="n">QgsFeatureSink</span><span class="p">,</span>
                       <span class="n">QgsFeature</span><span class="p">,</span>
                       <span class="n">QgsField</span><span class="p">,</span>
                       <span class="n">QgsFields</span><span class="p">,</span>
                       <span class="n">QgsProcessingException</span><span class="p">,</span>
                       <span class="n">QgsProcessingAlgorithm</span><span class="p">,</span>
                       <span class="n">QgsProcessingParameterFeatureSource</span><span class="p">,</span>
                       <span class="n">QgsProcessingParameterFeatureSink</span><span class="p">,</span>
                       <span class="n">QgsProcessingParameterField</span><span class="p">,</span>
                       <span class="p">)</span>
<span class="kn">import</span> <span class="nn">processing</span>


<span class="k">class</span> <span class="nc">DissolveProcessingAlgorithm</span><span class="p">(</span><span class="n">QgsProcessingAlgorithm</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dissolve algorithm that dissolves features based on selected</span>
<span class="sd">    attribute and summarizes the selected field by cumputing the</span>
<span class="sd">    sum of dissolved features.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">INPUT</span> <span class="o">=</span> <span class="s1">&#39;INPUT&#39;</span>
    <span class="n">OUTPUT</span> <span class="o">=</span> <span class="s1">&#39;OUTPUT&#39;</span>
    <span class="n">DISSOLVE_FIELD</span> <span class="o">=</span> <span class="s1">&#39;dissolve_field&#39;</span>
    <span class="n">SUM_FIELD</span> <span class="o">=</span> <span class="s1">&#39;sum_field&#39;</span>

    <span class="k">def</span> <span class="nf">tr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a translatable string with the self.tr() function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s1">&#39;Processing&#39;</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">createInstance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">DissolveProcessingAlgorithm</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the algorithm name, used for identifying the algorithm. This</span>
<span class="sd">        string should be fixed for the algorithm, and must not be localised.</span>
<span class="sd">        The name should be unique within each provider. Names should contain</span>
<span class="sd">        lowercase alphanumeric characters only and no spaces or other</span>
<span class="sd">        formatting characters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;dissolve_with_sum&#39;</span>

    <span class="k">def</span> <span class="nf">displayName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the translated algorithm name, which should be used for any</span>
<span class="sd">        user-visible display of the algorithm name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s1">&#39;Dissolve with Sum&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">group</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the name of the group this algorithm belongs to. This string</span>
<span class="sd">        should be localised.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s1">&#39;scripts&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">groupId</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the unique ID of the group this algorithm belongs to. This</span>
<span class="sd">        string should be fixed for the algorithm, and must not be localised.</span>
<span class="sd">        The group id should be unique within each provider. Group id should</span>
<span class="sd">        contain lowercase alphanumeric characters only and no spaces or other</span>
<span class="sd">        formatting characters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;scripts&#39;</span>

    <span class="k">def</span> <span class="nf">shortHelpString</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a localised short helper string for the algorithm. This string</span>
<span class="sd">        should provide a basic description about what the algorithm does and the</span>
<span class="sd">        parameters and outputs associated with it..</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;Dissolves selected features and creates and sums values of features that were dissolved&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">initAlgorithm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Here we define the inputs and output of the algorithm, along</span>
<span class="sd">        with some other properties.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># We add the input vector features source. It can have any kind of</span>
        <span class="c1"># geometry.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addParameter</span><span class="p">(</span>
            <span class="n">QgsProcessingParameterFeatureSource</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">INPUT</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s1">&#39;Input layer&#39;</span><span class="p">),</span>
                <span class="p">[</span><span class="n">QgsProcessing</span><span class="o">.</span><span class="n">TypeVectorAnyGeometry</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addParameter</span><span class="p">(</span>
            <span class="n">QgsProcessingParameterField</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">DISSOLVE_FIELD</span><span class="p">,</span>
                <span class="s1">&#39;Choose Dissolve Field&#39;</span><span class="p">,</span>
                <span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">INPUT</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addParameter</span><span class="p">(</span>
            <span class="n">QgsProcessingParameterField</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">SUM_FIELD</span><span class="p">,</span>
                <span class="s1">&#39;Choose Sum Field&#39;</span><span class="p">,</span>
                <span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">INPUT</span><span class="p">))</span>
        <span class="c1"># We add a feature sink in which to store our processed features (this</span>
        <span class="c1"># usually takes the form of a newly created vector layer when the</span>
        <span class="c1"># algorithm is run in QGIS).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addParameter</span><span class="p">(</span>
            <span class="n">QgsProcessingParameterFeatureSink</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">OUTPUT</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s1">&#39;Output layer&#39;</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">processAlgorithm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">feedback</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Here is where the processing itself takes place.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterAsSource</span><span class="p">(</span>
            <span class="n">parameters</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">INPUT</span><span class="p">,</span>
            <span class="n">context</span>
        <span class="p">)</span>
        <span class="n">dissolve_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterAsString</span><span class="p">(</span>
            <span class="n">parameters</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DISSOLVE_FIELD</span><span class="p">,</span>
            <span class="n">context</span><span class="p">)</span>
        <span class="n">sum_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterAsString</span><span class="p">(</span>
            <span class="n">parameters</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SUM_FIELD</span><span class="p">,</span>
            <span class="n">context</span><span class="p">)</span>
        
        <span class="n">fields</span> <span class="o">=</span> <span class="n">QgsFields</span><span class="p">()</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QgsField</span><span class="p">(</span><span class="n">dissolve_field</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">String</span><span class="p">))</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QgsField</span><span class="p">(</span><span class="s1">&#39;SUM_&#39;</span> <span class="o">+</span> <span class="n">sum_field</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">Double</span><span class="p">))</span>
        
        <span class="p">(</span><span class="n">sink</span><span class="p">,</span> <span class="n">dest_id</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterAsSink</span><span class="p">(</span>
            <span class="n">parameters</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">OUTPUT</span><span class="p">,</span>
            <span class="n">context</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">source</span><span class="o">.</span><span class="n">wkbType</span><span class="p">(),</span> <span class="n">source</span><span class="o">.</span><span class="n">sourceCrs</span><span class="p">())</span>
        
        <span class="c1"># Create a dictionary to hold the unique values from the </span>
        <span class="c1"># dissolve_field and the sum of the values from the sum_field</span>
        <span class="n">feedback</span><span class="o">.</span><span class="n">pushInfo</span><span class="p">(</span><span class="s1">&#39;Extracting unique values from dissolve_field and computing sum&#39;</span><span class="p">)</span>
        <span class="n">features</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">()</span>
        <span class="n">unique_values</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">dissolve_field</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">features</span><span class="p">)</span>
        <span class="c1"># Get Indices of dissolve field and sum field</span>
        <span class="n">dissolveIdx</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">fields</span><span class="p">()</span><span class="o">.</span><span class="n">indexFromName</span><span class="p">(</span><span class="n">dissolve_field</span><span class="p">)</span>
        <span class="n">sumIdx</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">fields</span><span class="p">()</span><span class="o">.</span><span class="n">indexFromName</span><span class="p">(</span><span class="n">sum_field</span><span class="p">)</span>
        
        <span class="c1"># Find all unique values for the given dissolve_field and</span>
        <span class="c1"># sum the corresponding values from the sum_field</span>
        <span class="n">sum_unique_values</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="p">[{</span><span class="n">dissolve_field</span><span class="p">:</span> <span class="n">f</span><span class="p">[</span><span class="n">dissolveIdx</span><span class="p">],</span> <span class="n">sum_field</span><span class="p">:</span> <span class="n">f</span><span class="p">[</span><span class="n">sumIdx</span><span class="p">]}</span>
                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">source</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">()]</span>
        <span class="k">for</span> <span class="n">unique_value</span> <span class="ow">in</span> <span class="n">unique_values</span><span class="p">:</span>
            <span class="n">val_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">f_attr</span><span class="p">[</span><span class="n">sum_field</span><span class="p">]</span> 
                <span class="k">for</span> <span class="n">f_attr</span> <span class="ow">in</span> <span class="n">attrs</span> <span class="k">if</span> <span class="n">f_attr</span><span class="p">[</span><span class="n">dissolve_field</span><span class="p">]</span> <span class="o">==</span> <span class="n">unique_value</span><span class="p">]</span>
            <span class="n">sum_unique_values</span><span class="p">[</span><span class="n">unique_value</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">val_list</span><span class="p">)</span>
        
        <span class="c1"># Running the processing dissolve algorithm</span>
        <span class="n">feedback</span><span class="o">.</span><span class="n">pushInfo</span><span class="p">(</span><span class="s1">&#39;Dissolving features&#39;</span><span class="p">)</span>
        <span class="n">dissolved_layer</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;native:dissolve&quot;</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;INPUT&#39;</span><span class="p">:</span> <span class="n">parameters</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">INPUT</span><span class="p">],</span>
            <span class="s1">&#39;FIELD&#39;</span><span class="p">:</span> <span class="n">dissolve_field</span><span class="p">,</span>
            <span class="s1">&#39;OUTPUT&#39;</span><span class="p">:</span> <span class="s1">&#39;memory:&#39;</span>
        <span class="p">},</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span> <span class="n">feedback</span><span class="o">=</span><span class="n">feedback</span><span class="p">)[</span><span class="s1">&#39;OUTPUT&#39;</span><span class="p">]</span>
        
        <span class="c1"># Read the dissolved layer and create output features</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">dissolved_layer</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">():</span>
            <span class="n">new_feature</span> <span class="o">=</span>  <span class="n">QgsFeature</span><span class="p">()</span>
            <span class="c1"># Set geometry to dissolved geometry</span>
            <span class="n">new_feature</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">geometry</span><span class="p">())</span>
            <span class="c1"># Set attributes from sum_unique_values dictionary that we had computed</span>
            <span class="n">new_feature</span><span class="o">.</span><span class="n">setAttributes</span><span class="p">([</span><span class="n">f</span><span class="p">[</span><span class="n">dissolve_field</span><span class="p">],</span> <span class="n">sum_unique_values</span><span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="n">dissolve_field</span><span class="p">]]])</span>
            <span class="n">sink</span><span class="o">.</span><span class="n">addFeature</span><span class="p">(</span><span class="n">new_feature</span><span class="p">,</span> <span class="n">QgsFeatureSink</span><span class="o">.</span><span class="n">FastInsert</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">OUTPUT</span><span class="p">:</span> <span class="n">dest_id</span><span class="p">}</span>
</pre></div>
</div>
</section>
</section>



<!-- Turn on comments on only newer tutorials having 3/ in URL -->

  <!-- Comment Section Powered by utterances -->
<div id="comments">
  <hr />
  <p>If you want to give feedback or share your experience with this tutorial, please comment below. (requires GitHub account)</p>
<script src="https://utteranc.es/client.js"
        repo="spatialthoughts/qgis-tutorials"
        issue-term="title"
        label="comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
</div>


    </div>
      
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2025, Ujaval Gandhi.<br/>
      Last updated on сеп 04, 2025.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 8.2.3.<br/>
    </p>
  </div>
</footer>
<div class="container">
  <p>This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/deed.en_US">Creative Commons Attribution 4.0 International License</a>.<br>
  You are free to use the material for any purpose as long as you give appropriate credit to the original author.</p>
</div>

<!-- Script fpr language switching. Largely adapted from https://github.com/pcav/faunalia-website -->
<script>
    var currentPage = 'docs/3/processing_python_scripts.html'; // coming from sphinx, always without starting '/'
    var currentLang = 'en';
    $(document).ready(function(){

        var search = new RegExp('\/[a-zA-Z_]{2,8}\/'+ currentPage, 'gi');
        var langPlusPage = window.location.href.match(search);
        // it's possible this is a index.html page called without 'index.html', try without the currentPage
        if (langPlusPage==undefined){
            search = new RegExp('\/[a-zA-Z_]{2,8}\/$', 'gi');
            langPlusPage = window.location.href.match(search);
        }

        // it's possible this is an index.html page called without 'index.html', try removing index.html
        if (langPlusPage==undefined){
            currentPage = currentPage.replace('index.html','')
            search = new RegExp('\/[a-zA-Z_]{2,8}\/'+ currentPage, 'gi');
            langPlusPage = window.location.href.match(search);
        }
        // still no langPlugPage: stop, because the language swicher will misbehave 

        if (langPlusPage == undefined || langPlusPage.length != 1){
            alert('You hit an error, please report back to us.');
            return;
        }
        langPlusPage = langPlusPage[0];
        currentLang = langPlusPage.replace(currentPage, '');

        $("#languages").val(currentLang.replace(/\//g,'')); // currentLang is something like '/nl/'

        $("#languages").change(function() {
            gotoLang($(this).val());
        });

    });

    // load current page in a different language
    function gotoLang(lang){
        var currentUrl = window.location.href;
        var newUrl = currentUrl.replace(currentLang, '/'+lang+'/');
        window.location.href = newUrl;
    }
</script>

  </body>
</html>