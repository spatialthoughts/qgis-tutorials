<!DOCTYPE html>

<html lang="fa" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>چند ضلعی های همسایه را در یک لایه پیدا کنید &#8212; QGIS Tutorials and Tips</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=0bf093e7" />
    <script src="../_static/documentation_options.js?v=40f7bd05"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/translations.js?v=35c83baa"></script>
    <link rel="search" title="جستجو" href="../search.html" />

<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>


<!-- Cookie Notice -->
<!-- Script from https://github.com/AOEpeople/cookie-notice -->
<script type="text/javascript" src="../_static/cookie.notice.min.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-B1WQ7B80XJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-B1WQ7B80XJ');
</script>


  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          QGIS Tutorials and Tips</a>
        <span class="navbar-text navbar-version pull-left"><b>v1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Tutorials List <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">مقدمه</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/making_a_map.html">Making a Map (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/working_with_attributes.html">Working with Attributes (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/importing_spreadsheets_csv.html">Importing Spreadsheets or CSV files (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/basic_vector_styling.html">استایل برداری پایه (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/calculating_line_lengths.html">محاسبه طول خط و آمار (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/raster_styling_and_analysis.html">استایل‌سازی و تحلیل شطرنجی پایه (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/raster_mosaicing_and_clipping.html">Raster Mosaicing and Clipping (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/working_with_terrain.html">Working with Terrain Data (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/working_with_wms.html">Working with WMS Data (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/working_with_projections.html">کار با پروژکشن</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/georeferencing_basics.html">زمین مرجع کردن نقشه  شیت توپوگرافی اسکن شده (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/advanced_georeferencing.html">زمین مرجع کردن عکس هوایی (QGIS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/digitizing_basics.html">رقومی کردن داده های نقشه (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/performing_table_joins.html">اجرای اتصال جدول (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/performing_spatial_joins.html">اجرای اتصال مکانی (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/performing_spatial_queries.html">Performing Spatial Queries (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/nearest_neighbor_analysis.html">Nearest Neighbor Analysis (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/sampling_raster_data.html">Sampling Raster Data using Points or Polygons (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/calculating_raster_area.html">Calculating Raster Area (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/creating_heatmaps.html">Creating Heatmaps (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/animating_time_series.html">متحرک سازی داده های سری زمانی (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/handling_invalid_geometries.html">Handling Invalid Geometries (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/advanced_raster_analysis.html">تجزیه و تحلیل شطرنجی پیشرفته (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/interpolating_point_data.html">Interpolating Point Data (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/batch_processing.html">Batch Processing using Processing Framework (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/processing_graphical_modeler.html">گردش کار خودکار با استفاده از مدل پردازش (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/automating_map_creation.html">ایجاد خودکار نقشه با اطلس طرح بندی چاپی (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/multi_criteria_overlay.html">تحلیل همپوشانی چندمعیار­ه (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/basic_network_analysis.html">تجسم و مسیریابی شبکه پایه (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/origin_destination_matrix.html">Locating Nearest Facility with Origin-Destination Matrix (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/service_area_analysis.html">Service Area Analysis using Openrouteservice (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/travel_time_analysis.html">Travel Time Analysis with Uber Movement (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/areal_mean_rainfall.html">محاسبه منطقه ای میانگین بارش(QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/colorized_river_basin_map.html">ایجاد یک نقشه حوضه رودخانه رنگی (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/creating_landuse_map.html">ایجاد نقشه کاربری اراضی(QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/calculating_intersection_density.html">محاسبه تراکم تقاطع خیابان(QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/landuse_buffer.html">تعیین مناطق بافر کاربری اراضی (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/solidwaste_mapping.html">نقشه برداری حجم دفع زباله (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/getting_started_with_pyqgis.html">شروع برنامه نویسی پایتون (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/processing_algorithms_pyqgis.html">Running Processing Algorithms via Python (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/custom_python_functions.html">استفاده از بیان توابع عبارتی پایتون (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/processing_python_scripts.html">Writing Python Scripts for Processing Framework (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/building_a_python_plugin.html">ساخت پلاگین پایتون (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/processing_python_plugin.html">Building a Processing Plugin (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="running_qgis_jobs.html">اجرا و برنامه ریزی پردازش وظیفه ای در QGIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/web_mapping_with_qgis2web.html">نقشه برداری وب با QGIS2Web (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="creating_basemaps_with_qtiles.html">Creating Basemaps with QTiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="3/using_plugins.html">Using Plugins (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="downloading_osm_data.html">جستجو و دانلود داده های OpenStreetMap</a></li>
<li class="toctree-l1"><a class="reference internal" href="learning_resources.html">منابع آموزشی QGIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="credits.html">اعتبار داده ها</a></li>
<li class="toctree-l1"><a class="reference internal" href="batch_processing.html">پردازش دسته ای با استفاده از چارچوب پردازش (QGIS2)</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            

            

            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><h4>Author</h4>
<p>Ujaval Gandhi</p>
<a href="https://twitter.com/intent/follow?screen_name=spatialthoughts" class="twitter-follow-button" data-show-count="false">Follow @spatialthoughts</a>
<hr>
<p>Want to learn QGIS in a structured way? Check out <a href="https://spatialthoughts.com/" target="_blank">Spatial Thoughts</a> for more learning materials and instructor-led online programs with QGIS.org certification.</p>

<hr>
<p>These tutorials are also available in many other languages. Please see <a href="https://www.qgistutorials.com/en/docs/introduction.html#translations" target="_blank">translations</a> page.
</p>
        </div>
      </div>
    <div class="body col-md-9 content" role="main">
      

  <section id="find-neighbor-polygons-in-a-layer">
<h1>چند ضلعی های همسایه را در یک لایه پیدا کنید<a class="headerlink" href="#find-neighbor-polygons-in-a-layer" title="Link to this heading">¶</a></h1>
<div class="admonition note">
<p class="admonition-title">توجه</p>
<p>اگر از QGIS3 استفاده می کنید، راه ساده تر و بهتری برای انجام این تحلیل با استفاده از تابع جمع وجود دارد. پست من را ببینید «پیدا کردن چند ضلعی های همسایه با استفاده از تابع جمع خلاصه در QGIS &lt;<a class="reference external" href="https://spatialthoughts.com/2019/05/23/neighbor-polygons-aggregate-qgis/">https://spatialthoughts.com/2019/05/23/neighbor-polygons-aggregate-qgis/</a>&gt;`_</p>
</div>
<p>مواردی وجود دارد که می خواهید همه چند ضلعی های مجاور هر چند ضلعی را در یک لایه پیدا کنید. با کمی اسکریپت پایتون، می‌توانیم این کار و خیلی بیشتر را در QGIS انجام دهیم. در اینجا یک نمونه اسکریپت وجود دارد که می توانید از آن برای یافتن همه چند ضلعی هایی که با هر چند ضلعی در یک لایه مرز مشترک دارند و همچنین نام آنها را به جدول ویژگی اضافه کنید، استفاده کنید. به عنوان یک امتیاز اضافی، اسکریپت همچنین یک ویژگی انتخابی شما را از همه چند ضلعی های همسایه خلاصه می کند.</p>
<section id="overview-of-the-task">
<h2>بررسی اجمالی کار<a class="headerlink" href="#overview-of-the-task" title="Link to this heading">¶</a></h2>
<p>برای نشان دادن نحوه عملکرد اسکریپت، از لایه ای از چند ضلعی های کشور استفاده می کنیم و کشورهایی را که مرز مشترک دارند، پیدا می کنیم. ما همچنین می خواهیم کل جمعیت همسایگان کشور را محاسبه کنیم.</p>
</section>
<section id="get-the-data">
<h2>داده ها را دریافت کنید<a class="headerlink" href="#get-the-data" title="Link to this heading">¶</a></h2>
<p>ما از مجموعه داده &quot;Admin 0 - Countries &lt;<a class="reference external" href="http://www.naturalearthdata.com/downloads/10m-cultural-vectors/10m-admin-0-countries/">http://www.naturalearthdata.com/downloads/10m-cultural-vectors/10m-admin-0-countries/</a>&gt;&quot;_ از Natural Earth استفاده خواهیم کرد.</p>
<p>فایل شکل فایل «Admin 0 - Country» را دانلود کنید. &lt;<a class="reference external" href="http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/cultural/ne_10m_admin_0_countries.zip">http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/cultural/ne_10m_admin_0_countries.zip</a>&gt;`_.</p>
<p>منبع داده <a class="reference internal" href="credits.html#naturalearth" id="id1"><span>[NATURALEARTH]</span></a></p>
</section>
<section id="get-the-script">
<h2>فیلمنامه را دریافت کنید<a class="headerlink" href="#get-the-script" title="Link to this heading">¶</a></h2>
<p>اسکریپت :download:<a href="#id1"><span class="problematic" id="id2">`</span></a>neighbors.py را دانلود کنید و آن را در دیسک خود ذخیره کنید.</p>
</section>
<section id="procedure">
<h2>روش<a class="headerlink" href="#procedure" title="Link to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>لایه «ne_10m_admin_0_countries» را با رفتن به <span class="menuselection">Layer ‣ Add Vector Layer</span> بارگیری کنید.</p></li>
</ol>
<img alt="../_images/1178.png" class="align-center" src="../_images/1178.png" />
<ol class="arabic simple" start="2">
<li><p>اسکریپت از 2 فیلد برای انجام عمل استفاده می کند. یک فیلد نام و یک فیلد که می خواهید خلاصه کنید. از ابزار :guilabel:<a href="#id1"><span class="problematic" id="id2">`</span></a>Identify برای کلیک بر روی هر ویژگی و بررسی ویژگی ها استفاده کنید. در این مورد، فیلد نام <strong>NAME</strong> است و می‌خواهیم برآوردهای جمعیت را از قسمت <strong>POP_EST</strong> جمع‌بندی کنیم.</p></li>
</ol>
<img alt="../_images/2147.png" class="align-center" src="../_images/2147.png" />
<ol class="arabic simple" start="3">
<li><p>به :menuselection:<a href="#id1"><span class="problematic" id="id2">`</span></a>Plugins --&gt; Python Console بروید.</p></li>
</ol>
<img alt="../_images/388.png" class="align-center" src="../_images/388.png" />
<ol class="arabic simple" start="4">
<li><p>در پنجره :guilabel:'Python Console'، روی دکمه :guilabel:'Show Editor' کلیک کنید.</p></li>
</ol>
<img alt="../_images/454.png" class="align-center" src="../_images/454.png" />
<ol class="arabic simple" start="5">
<li><p>در پانل :guilabel:'Editor'، روی دکمه :guilabel:'Open file' کلیک کنید و اسکریپت &quot;neighbors.py&quot; دانلود شده را مرور کنید و روی :guilabel:&quot;Open&quot; کلیک کنید.</p></li>
</ol>
<img alt="../_images/547.png" class="align-center" src="../_images/547.png" />
<ol class="arabic simple" start="6">
<li><p>پس از بارگیری اسکریپت، ممکن است بخواهید مقادیر &quot;_NAME_FIELD&quot; و &quot;_SUM_FIELD&quot; را تغییر دهید تا با ویژگی های لایه خود مطابقت داشته باشد. اگر با لایه «ne_10m_admin_0_countries» کار می‌کنید، می‌توانید آن‌ها را همانطور که هستند رها کنید. اگر تغییری ایجاد کردید، روی دکمه <span class="guilabel">Save</span> در پنل <span class="guilabel">Editor کلیک کنید. اکنون روی دکمه :guilabel:`Run script</span> کلیک کنید تا اسکریپت اجرا شود.</p></li>
</ol>
<img alt="../_images/645.png" class="align-center" src="../_images/645.png" />
<ol class="arabic simple" start="7">
<li><p>پس از اتمام اسکریپت، روی لایه &quot;ne_10m_admin_0_countries&quot; کلیک راست کرده و :guilabel:&quot;Open Attribute Table&quot; را انتخاب کنید.</p></li>
</ol>
<img alt="../_images/745.png" class="align-center" src="../_images/745.png" />
<ol class="arabic simple" start="8">
<li><p>متوجه 2 ویژگی جدید به نام‌های «همسایه» و «جمع» خواهید شد. اینها توسط فیلمنامه اضافه شد.</p></li>
</ol>
<img alt="../_images/844.png" class="align-center" src="../_images/844.png" />
<p>در زیر اسکریپت کامل برای مرجع آورده شده است. شما می توانید آن را مطابق با نیاز خود تغییر دهید.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">################################################################################</span>
<span class="c1"># Copyright 2014 Ujaval Gandhi</span>
<span class="c1">#</span>
<span class="c1">#This program is free software; you can redistribute it and/or</span>
<span class="c1">#modify it under the terms of the GNU General Public License</span>
<span class="c1">#as published by the Free Software Foundation; either version 2</span>
<span class="c1">#of the License, or (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1">#This program is distributed in the hope that it will be useful,</span>
<span class="c1">#but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1">#MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1">#GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1">#You should have received a copy of the GNU General Public License</span>
<span class="c1">#along with this program; if not, write to the Free Software</span>
<span class="c1">#Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.</span>
<span class="c1">#</span>
<span class="c1">################################################################################</span>
<span class="kn">from</span> <span class="nn">qgis.utils</span> <span class="kn">import</span> <span class="n">iface</span>
<span class="kn">from</span> <span class="nn">PyQt4.QtCore</span> <span class="kn">import</span> <span class="n">QVariant</span>

<span class="c1"># Replace the values below with values from your layer.</span>
<span class="c1"># For example, if your identifier field is called &#39;XYZ&#39;, then change the line</span>
<span class="c1"># below to _NAME_FIELD = &#39;XYZ&#39;</span>
<span class="n">_NAME_FIELD</span> <span class="o">=</span> <span class="s1">&#39;NAME&#39;</span>
<span class="c1"># Replace the value below with the field name that you want to sum up.</span>
<span class="c1"># For example, if the # field that you want to sum up is called &#39;VALUES&#39;, then</span>
<span class="c1"># change the line below to _SUM_FIELD = &#39;VALUES&#39;</span>
<span class="n">_SUM_FIELD</span> <span class="o">=</span> <span class="s1">&#39;POP_EST&#39;</span>

<span class="c1"># Names of the new fields to be added to the layer</span>
<span class="n">_NEW_NEIGHBORS_FIELD</span> <span class="o">=</span> <span class="s1">&#39;NEIGHBORS&#39;</span>
<span class="n">_NEW_SUM_FIELD</span> <span class="o">=</span> <span class="s1">&#39;SUM&#39;</span>

<span class="n">layer</span> <span class="o">=</span> <span class="n">iface</span><span class="o">.</span><span class="n">activeLayer</span><span class="p">()</span>

<span class="c1"># Create 2 new fields in the layer that will hold the list of neighbors and sum</span>
<span class="c1"># of the chosen field.</span>
<span class="n">layer</span><span class="o">.</span><span class="n">startEditing</span><span class="p">()</span>
<span class="n">layer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span><span class="o">.</span><span class="n">addAttributes</span><span class="p">(</span>
        <span class="p">[</span><span class="n">QgsField</span><span class="p">(</span><span class="n">_NEW_NEIGHBORS_FIELD</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">String</span><span class="p">),</span>
         <span class="n">QgsField</span><span class="p">(</span><span class="n">_NEW_SUM_FIELD</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">Int</span><span class="p">)])</span>
<span class="n">layer</span><span class="o">.</span><span class="n">updateFields</span><span class="p">()</span>
<span class="c1"># Create a dictionary of all features</span>
<span class="n">feature_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">f</span><span class="o">.</span><span class="n">id</span><span class="p">():</span> <span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">()}</span>

<span class="c1"># Build a spatial index</span>
<span class="n">index</span> <span class="o">=</span> <span class="n">QgsSpatialIndex</span><span class="p">()</span>
<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">feature_dict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
    <span class="n">index</span><span class="o">.</span><span class="n">insertFeature</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="c1"># Loop through all features and find features that touch each feature</span>
<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">feature_dict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
    <span class="nb">print</span> <span class="s1">&#39;Working on </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">f</span><span class="p">[</span><span class="n">_NAME_FIELD</span><span class="p">]</span>
    <span class="n">geom</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span>
    <span class="c1"># Find all features that intersect the bounding box of the current feature.</span>
    <span class="c1"># We use spatial index to find the features intersecting the bounding box</span>
    <span class="c1"># of the current feature. This will narrow down the features that we need</span>
    <span class="c1"># to check neighboring features.</span>
    <span class="n">intersecting_ids</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">boundingBox</span><span class="p">())</span>
    <span class="c1"># Initalize neighbors list and sum</span>
    <span class="n">neighbors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">neighbors_sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">intersecting_id</span> <span class="ow">in</span> <span class="n">intersecting_ids</span><span class="p">:</span>
        <span class="c1"># Look up the feature from the dictionary</span>
        <span class="n">intersecting_f</span> <span class="o">=</span> <span class="n">feature_dict</span><span class="p">[</span><span class="n">intersecting_id</span><span class="p">]</span>

        <span class="c1"># For our purpose we consider a feature as &#39;neighbor&#39; if it touches or</span>
        <span class="c1"># intersects a feature. We use the &#39;disjoint&#39; predicate to satisfy</span>
        <span class="c1"># these conditions. So if a feature is not disjoint, it is a neighbor.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">f</span> <span class="o">!=</span> <span class="n">intersecting_f</span> <span class="ow">and</span>
            <span class="ow">not</span> <span class="n">intersecting_f</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span><span class="o">.</span><span class="n">disjoint</span><span class="p">(</span><span class="n">geom</span><span class="p">)):</span>
            <span class="n">neighbors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">intersecting_f</span><span class="p">[</span><span class="n">_NAME_FIELD</span><span class="p">])</span>
            <span class="n">neighbors_sum</span> <span class="o">+=</span> <span class="n">intersecting_f</span><span class="p">[</span><span class="n">_SUM_FIELD</span><span class="p">]</span>
    <span class="n">f</span><span class="p">[</span><span class="n">_NEW_NEIGHBORS_FIELD</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">neighbors</span><span class="p">)</span>
    <span class="n">f</span><span class="p">[</span><span class="n">_NEW_SUM_FIELD</span><span class="p">]</span> <span class="o">=</span> <span class="n">neighbors_sum</span>
    <span class="c1"># Update the layer with new attribute values.</span>
    <span class="n">layer</span><span class="o">.</span><span class="n">updateFeature</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="n">layer</span><span class="o">.</span><span class="n">commitChanges</span><span class="p">()</span>
<span class="nb">print</span> <span class="s1">&#39;Processing complete.&#39;</span>
</pre></div>
</div>
</section>
</section>





  <!-- Comment Section Powered by utterances -->
<div id="comments">
  <hr />
  <p>If you want to give feedback or share your experience with this tutorial, please comment below. (requires GitHub account)</p>
<script src="https://utteranc.es/client.js"
        repo="spatialthoughts/qgis-tutorials"
        issue-term="title"
        label="comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
</div>


    </div>
      
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2023, Ujaval Gandhi.<br/>
      آخرین بروز رسانی در مارس 13, 2024 .<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 7.2.6.<br/>
    </p>
  </div>
</footer>
<div class="container">
  <p>This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/deed.en_US">Creative Commons Attribution 4.0 International License</a></p>
</div>
<!-- Twitter Button -->
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<!-- Disqus comments widget -->
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'qgistutorials'; // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  }());
</script>

<script type="text/javascript">
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

<!-- Script fpr language switching. Largely adapted from https://github.com/pcav/faunalia-website -->
<script>
    var currentPage = 'docs/find_neighbor_polygons.html'; // coming from sphinx, always without starting '/'
    var currentLang = 'en';
    $(document).ready(function(){

        var search = new RegExp('\/[a-zA-Z_]{2,8}\/'+ currentPage, 'gi');
        var langPlusPage = window.location.href.match(search);
        // it's possible this is a index.html page called without 'index.html', try without the currentPage
        if (langPlusPage==undefined){
            search = new RegExp('\/[a-zA-Z_]{2,8}\/$', 'gi');
            langPlusPage = window.location.href.match(search);
        }

        // it's possible this is an index.html page called without 'index.html', try removing index.html
        if (langPlusPage==undefined){
            currentPage = currentPage.replace('index.html','')
            search = new RegExp('\/[a-zA-Z_]{2,8}\/'+ currentPage, 'gi');
            langPlusPage = window.location.href.match(search);
        }
        // still no langPlugPage: stop, because the language swicher will misbehave 

        if (langPlusPage == undefined || langPlusPage.length != 1){
            alert('You hit an error, please report back to us.');
            return;
        }
        langPlusPage = langPlusPage[0];
        currentLang = langPlusPage.replace(currentPage, '');

        $("#languages").val(currentLang.replace(/\//g,'')); // currentLang is something like '/nl/'

        $("#languages").change(function() {
            gotoLang($(this).val());
        });

    });

    // load current page in a different language
    function gotoLang(lang){
        var currentUrl = window.location.href;
        var newUrl = currentUrl.replace(currentLang, '/'+lang+'/');
        window.location.href = newUrl;
    }
</script>

  </body>
</html>